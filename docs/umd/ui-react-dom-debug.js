var e,t;e=this,t=function(e,t,l){"use strict";const a=e=>typeof e,s="",n=a(s),o=a(!0),r=a(0),i=a(a),d="type",u="default",c="Ids",h="Table",m=h+"s",g=h+c,b="Row",w=b+"Count",f=b+c,p="Cell",C=p+c,v="Value",I=v+"s",y=v+c,T="currentTarget",V="value",k=e=>s+e,S=isFinite,R=(e,t)=>e instanceof t,x=e=>null==e,N=(e,t,l)=>x(e)?l?.():t(e),E=e=>e==n||e==o,L=e=>a(e)==i,z=e=>Array.isArray(e),q=(e,t)=>e.forEach(t),$=(e,t)=>e.map(t),A=e=>e.length,J=(e,t,l)=>e.slice(t,l),M=(e,...t)=>e.push(...t),F=e=>e.shift(),O=Object,P=O.keys,B=O.isFrozen,D=O.freeze,H=e=>R(e,O)&&e.constructor==O,j=(e=[])=>O.fromEntries(e),U=(e,t)=>!x(((e,t)=>N(e,(e=>e[t])))(e,t)),W=(e,t)=>(delete e[t],e),G=(e,t)=>$(O.entries(e),(([e,l])=>t(l,e))),K=e=>H(e)&&0==(e=>A(P(e)))(e),Q=e=>JSON.stringify(e,((e,t)=>R(t,Map)?O.fromEntries([...t]):t)),X=JSON.parse,Y="tinybaseStoreInspector",Z="TinyBase Store Inspector",_=["left","top","bottom","right","full"],ee="state",te="sort",le="open",ae="position",se=le,ne=(...e)=>Q(e),oe='content:url("',re=oe+"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100' stroke-width='4' stroke='white'>",ie='</svg>")',de=oe+"data:image/svg+xml,%3csvg viewBox='0 0 680 680' xmlns='http://www.w3.org/2000/svg' style='width:680px%3bheight:680px'%3e %3cpath stroke='white' stroke-width='80' fill='none' d='M340 617a84 241 90 11.01 0zM131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124zm-12-127a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z' /%3e %3cpath fill='%23d81b60' d='M131 475a94 254 70 10428-124 114 286 70 01-428 124zm0-140a94 254 70 10428-124 114 286 70 01-428 124z' /%3e %3cpath d='M249 619a94 240 90 00308-128 114 289 70 01-308 128zM119 208a94 254 70 00306 38 90 260 90 01-306-38zm221 3a74 241 90 11.01 0z' /%3e%3c/svg%3e\")",ue=$([[20,20,20,60],[20,20,60,20],[20,60,60,20],[60,20,20,60],[30,30,40,40]],(([e,t,l,a])=>re+`<rect x='20' y='20' width='60' height='60' fill='grey'/><rect x='${e}' y='${t}' width='${l}' height='${a}' fill='white'/>`+ie)),ce=re+"<path d='M20 20l60 60M20 80l60-60' />"+ie,he=((e,t="")=>e.join(t))(G({"":"all:initial;font-family:sans-serif;font-size:0.75rem;position:fixed;z-index:999999","*":"all:revert","*::before":"all:revert","*::after":"all:revert",img:"width:1rem;height:1rem;background:#111;border:0",">img":"padding:0.25rem;bottom:0;right:0;position:fixed;"+de,...j($(["bottom:0;left:0","top:0;right:0"],((e,t)=>[`>img[data-position='${t}']`,e]))),main:"display:flex;flex-direction:column;background:#111d;color:#fff;position:fixed;",...j($(["bottom:0;left:0;width:35vw;height:100vh","top:0;right:0;width:100vw;height:30vh","bottom:0;left:0;width:100vw;height:30vh","top:0;right:0;width:35vw;height:100vh","top:0;right:0;width:100vw;height:100vh"],((e,t)=>[`main[data-position='${t}']`,e]))),header:"display:flex;padding:0.25rem;background:#000;align-items:center","header>img:nth-of-type(1)":de,"header>img:nth-of-type(6)":ce,...j($(ue,((e,t)=>[`header>img[data-id='${t}']`,e]))),"header>span":"flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;margin-left:0.25rem",article:"padding:0.25rem 0.25rem 0.25rem 0.5rem;overflow:auto",details:"margin-left:0.75rem;width:fit-content;",summary:"margin-left:-0.75rem;line-height:1.25rem;user-select:none;width:fit-content",table:"border-collapse:collapse;table-layout:fixed;margin-bottom:0.5rem",thead:"background:#222","th:nth-of-type(1)":"min-width:2rem;","th.sorted":"background:#000","table caption":"text-align:left;white-space:nowrap;line-height:1.25rem",button:"width:1.5rem;border:none;background:none;color:#fff;padding:0","button[disabled]":"color:#777","button.next":"margin-right:0.5rem",[`th,#${Y} td`]:"overflow:hidden;text-overflow:ellipsis;padding:0.25rem 0.5rem;max-width:12rem;white-space:nowrap;border-width:1px 0;border-style:solid;border-color:#777;text-align:left"},((e,t)=>e?`#${Y} ${t}{${e}}`:""))),{createElement:me}=l,ge=(e,...t)=>x(e)?{}:e(...t),be=({s:e})=>{const l=t.useValue(ae,e)??1,a=t.useSetValueCallback(se,(()=>!0),[],e);return t.useValue(se,e)?null:me("img",{onClick:a,title:Z,"data-position":l})},we=e=>{const t=a(e);return E(t)||t==r&&S(e)?t:void 0},fe=(e,t,l,a,s)=>x(s)?e.delCell(t,l,a,!0):e.setCell(t,l,a,s),pe=(e,t,l)=>x(l)?e.delValue(t):e.setValue(t,l),Ce=(e,t,l,a)=>e==n?t:e==r?l:a,{useCallback:ve,useMemo:Ie,useState:ye}=l,Te="editable",Ve=(e,t,l)=>{const a=ve(e,t);return l?a:void 0},ke=(e,t=!1,l,a=0,s,n,o,r)=>{const[[i,d,u],c]=ye([e,t,a]),h=ve((e=>{c(e),r?.(e)}),[r]),m=Ve((e=>h([e,e==i&&!d,u])),[h,i,d,u],l),g=ve((e=>h([i,d,e])),[h,i,d]),b=!0===o?qe:o;return[[i,d,u],m,Ie((()=>!1===o?null:me(b,{offset:u,limit:s,total:n,onChange:g})),[o,b,u,s,n,g])]},Se=({cellId:e,sort:[t,l],label:a=e??s,onClick:n})=>me("th",{onClick:Ve((()=>n?.(e)),[n,e],n),className:x(l)||t!=e?void 0:`sorted ${l?"de":"a"}scending`},x(l)||t!=e?null:(l?"↓":"↑")+" ",a),Re=({className:e,headerRow:t,idColumn:l,customCells:s,params:o,rowIds:r})=>{const[i,d,u,c,h,m,g]=o,b=c(...d),w=Ie((()=>{const e=s??b;return j(G(z(e)?j($(e,(e=>[e,e]))):e,((e,t)=>{return[t,{label:t,...(l=e,a(l)==n?{label:e}:e)}];var l})))}),[s,b]);return me("table",{className:e},g?me("caption",null,g):null,!1===t?null:me("thead",null,me("tr",null,!1===l?null:me(Se,{sort:h??[],label:"Id",onClick:m}),G(w,(({label:e},t)=>me(Se,{key:t,cellId:t,label:e,sort:h??[],onClick:m}))))),me("tbody",null,$(r,(e=>me("tr",{key:e},!1===l?null:me("th",null,e),G(w,(({component:t=u,getComponentProps:l},a)=>me("td",{key:a},me(t,{...ge(l,e,a),...i,rowId:e,cellId:a})))))))))},xe=({thing:e,onThingChange:t,className:l})=>{const[a,s]=ye(),[i,d]=ye(),[u,c]=ye(),[h,m]=ye(),[g,b]=ye();i!==e&&(s(we(e)),d(e),c(e+""),m(Number(e)||0),b(!!e));const w=ve(((e,l)=>{l(e),d(e),t(e)}),[t]);return me("div",{className:l},me("button",{className:a,onClick:ve((()=>{const e=Ce(a,r,o,n),l=Ce(e,u,h,g);s(e),d(l),t(l)}),[t,u,h,g,a])},a),Ce(a,me("input",{key:a,value:u,onChange:ve((e=>w(e[T][V]+"",c)),[w])}),me("input",{key:a,type:"number",value:h,onChange:ve((e=>w(Number(e[T][V]||0),m)),[w])}),me("input",{key:a,type:"checkbox",checked:g,onChange:ve((e=>w(!!e[T].checked,b)),[w])})))},Ne=({tableId:e,cellId:l,descending:a,offset:s,limit:n,store:o,editable:r,sortOnClick:i,paginator:d=!1,onChange:u,...c})=>{const[h,m,g]=ke(l,a,i,s,n,t.useRowCount(e,o),d,u);return me(Re,{...c,params:Ie((()=>[{tableId:e,store:o},[e,o],r?Le:t.CellView,t.useTableCellIds,h,m,g]),[o,e,r,h,m,g]),rowIds:t.useSortedRowIds(e,...h,n,o)})},Ee=({store:e,editable:l=!1,valueComponent:a=(l?ze:t.ValueView),getValueComponentProps:s,className:n,headerRow:o,idColumn:r})=>me("table",{className:n},!1===o?null:me("thead",null,me("tr",null,!1===r?null:me("th",null,"Id"),me("th",null,v))),me("tbody",null,$(t.useValueIds(e),(t=>me("tr",{key:t},!1===r?null:me("th",null,t),me("td",null,me(a,{...ge(s,t),valueId:t,store:e}))))))),Le=({tableId:e,rowId:l,cellId:a,store:s,className:n})=>me(xe,{thing:t.useCell(e,l,a,s),onThingChange:t.useSetCellCallback(e,l,a,(e=>e),[],s),className:n??Te+p}),ze=({valueId:e,store:l,className:a})=>me(xe,{thing:t.useValue(e,l),onThingChange:t.useSetValueCallback(e,(e=>e),[],l),className:a??Te+v}),qe=({onChange:e,total:t,offset:a=0,limit:s=t,singular:n="row",plural:o=n+"s"})=>{(a>t||a<0)&&(a=0,e(0));const r=Ve((()=>e(a-s)),[e,a,s],a>0),i=Ve((()=>e(a+s)),[e,a,s],a+s<t);return me(l.Fragment,null,t>s&&me(l.Fragment,null,me("button",{className:"previous",disabled:0==a,onClick:r},"←"),me("button",{className:"next",disabled:a+s>=t,onClick:i},"→"),a+1," to ",Math.min(t,a+s)," of "),t," ",1!=t?o:n)},$e=({uniqueId:e,summary:a,children:s,s:n})=>{const o=!!t.useCell(ee,e,le,n),r=t.useSetCellCallback(ee,e,le,(e=>e[T].open),[],n);return l.createElement("details",{open:o,onToggle:r},l.createElement("summary",null,a),s)},Ae=({tableId:e,store:l,storeId:a,s:s})=>{const n=ne("t",a,e),[o,r,i]=X(t.useCell(ee,n,te,s)??"[]"),d=t.useSetCellCallback(ee,n,te,Q,[],s);return me($e,{uniqueId:n,summary:h+": "+e,s:s},me(Ne,{tableId:e,store:l,cellId:o,descending:r,offset:i,limit:10,paginator:!0,sortOnClick:!0,onChange:d}))},Je=({store:e,storeId:l,s:a})=>{return s=t.useValueIds(e),0==A(s)?null:me($e,{uniqueId:ne("v",l),summary:I,s:a},me(Ee,{store:e}));var s},Me=({storeId:e,s:l})=>{const a=t.useStore(e),s=t.useTableIds(a);return x(a)?null:me($e,{uniqueId:ne("s",e),summary:"Store: "+(e??u),s:l},me(Je,{storeId:e,store:a,s:l}),$(s,(t=>me(Ae,{storeId:e,tableId:t,store:a,s:l}))))},Fe=e=>me("article",null,me(Me,{...e}),$(t.useStoreIds(),(t=>me(Me,{storeId:t,key:t,...e})))),Oe=({s:e})=>{const l=t.useValue(ae,e)??1,a=t.useSetValueCallback(se,(()=>!1),[],e),s=t.useSetValueCallback(ae,(e=>Number(e[T].dataset.id)),[],e);return me("header",null,me("img",{title:Z}),me("span",null,Z),$(_,((e,t)=>t==l?null:me("img",{onClick:s,"data-id":t,title:"Dock to "+e,key:t}))),me("img",{onClick:a,title:"Close"}))},Pe=({s:e})=>{const l=t.useValue(ae,e)??1;return t.useValue(se,e)?me("main",{"data-position":l},me(Oe,{s:e}),me(Fe,{s:e})):null},Be=e=>t=>{return l=(t,l)=>t+e(l),Ke(t).reduce(l,0);var l},De=e=>e?.size??0,He=Be(De),je=Be(He),Ue=Be(je),We=(e,t)=>e?.has(t)??!1,Ge=e=>x(e)||0==De(e),Ke=e=>[...e?.values()??[]],Qe=e=>e.clear(),Xe=(e,t)=>e?.forEach(t),Ye=(e,t)=>e?.delete(t),Ze=e=>new Map(e),_e=e=>[...e?.keys()??[]],et=(e,t)=>e?.get(t),tt=(e,t)=>Xe(e,((e,l)=>t(l,e))),lt=(e,t,l)=>x(l)?(Ye(e,t),e):e?.set(t,l),at=(e,t,l)=>(We(e,t)||lt(e,t,l()),et(e,t)),st=(e,t,l,a=lt)=>(G(t,((t,a)=>l(e,a,t))),tt(e,(l=>U(t,l)?0:a(e,l))),e),nt=(e,t,l)=>{const a={};return Xe(e,((e,s)=>{const n=t?t(e,s):e;!l?.(n,e)&&(a[s]=n)})),a},ot=(e,t,l)=>nt(e,(e=>nt(e,t,l)),K),rt=(e,t,l)=>nt(e,(e=>ot(e,t,l)),K),it=(e,t)=>{const l=Ze();return Xe(e,((e,a)=>l.set(a,t?.(e)??e))),l},dt=e=>it(e,it),ut=e=>it(e,dt),ct=(e,t,l,a,s=0)=>N((l?at:et)(e,t[s],s>A(t)-2?l:Ze),(n=>{if(s>A(t)-2)return a?.(n)&&lt(e,t[s]),n;const o=ct(n,t,l,a,s+1);return Ge(n)&&lt(e,t[s]),o})),ht=Ze(),mt=Ze(),gt="storage",bt=globalThis.window,wt=e=>new Set(z(e)||x(e)?e:[e]),ft=(e,t)=>e?.add(t),pt=/^\d+$/,Ct=()=>{const e=[];let t=0;return[l=>(l?F(e):null)??s+t++,t=>{pt.test(t)&&A(e)<1e3&&M(e,t)}]},vt=e=>[e,e],It=(e,t=He)=>t(e[0])+t(e[1]),yt=()=>[Ze(),Ze()],Tt=e=>[...e],Vt=([e,t])=>e===t,kt=(e,t,l)=>x(e)||!H(e)||K(e)||B(e)?(l?.(),!1):(G(e,((l,a)=>{t(l,a)||W(e,a)})),!K(e)),St=(e,t,l)=>lt(e,t,et(e,t)==-l?void 0:l),Rt=()=>{let e,t,l=!1,a=!1,n=0;const o=Ze(),i=Ze(),c=Ze(),T=Ze(),V=Ze(),S=Ze(),R=Ze(),z=Ze(),F=Ze(),O=Ze(),P=Ze(),B=Ze(),H=Ze(),j=Ze(),Y=wt(),Z=Ze(),_=Ze(),ee=Ze(),te=Ze(),le=yt(),ae=yt(),se=yt(),ne=yt(),oe=yt(),re=yt(),ie=yt(),de=yt(),ue=yt(),ce=yt(),he=yt(),me=yt(),ge=yt(),be=yt(),Ce=yt(),ve=Ze(),Ie=yt(),[ye,Te,Ve,ke]=(e=>{let t;const[l,a]=Ct(),n=Ze();return[(e,a,o,r=[],i=(()=>[]))=>{t??=Cl;const d=l(1);return lt(n,d,[e,a,o,r,i]),ft(ct(a,o??[s],wt),d),d},(e,l,...a)=>q(((e,t=[s])=>{const l=[],a=(e,s)=>s==A(t)?M(l,e):null===t[s]?Xe(e,(e=>a(e,s+1))):q([t[s],null],(t=>a(et(e,t),s+1)));return a(e,0),l})(e,l),(e=>Xe(e,(e=>et(n,e)[0](t,...l??[],...a))))),e=>N(et(n,e),(([,t,l])=>(ct(t,l??[s],void 0,(t=>(Ye(t,e),Ge(t)?1:0))),lt(n,e),a(e),l))),e=>N(et(n,e),(([e,,l=[],a,s])=>{const n=(...o)=>{const r=A(o);r==A(l)?e(t,...o,...s(o)):x(l[r])?q(a[r]?.(...o)??[],(e=>n(...o,e))):n(...o,l[r])};n()}))]})(),Se=e=>{if(!kt(e,((e,t)=>[d,u].includes(t))))return!1;const t=e[d];return!(!E(t)&&t!=r||(we(e[u])!=t&&W(e,u),0))},Re=(t,l)=>(!e||We(P,l)||Mt(l))&&kt(t,((e,t)=>xe(l,t,e)),(()=>Mt(l))),xe=(e,t,l,a)=>kt(a?l:ze(l,e,t),((a,s)=>N(Ne(e,t,s,a),(e=>(l[s]=e,!0)),(()=>!1))),(()=>Mt(e,t))),Ne=(t,l,a,s)=>e?N(et(et(P,t),a),(e=>we(s)!=e[d]?Mt(t,l,a,s,e[u]):s),(()=>Mt(t,l,a,s))):x(we(s))?Mt(t,l,a,s):s,Ee=(e,t)=>kt(t?e:qe(e),((t,l)=>N(Le(l,t),(t=>(e[l]=t,!0)),(()=>!1))),(()=>Ft())),Le=(e,l)=>t?N(et(H,e),(t=>we(l)!=t[d]?Ft(e,l,t[u]):l),(()=>Ft(e,l))):x(we(l))?Ft(e,l):l,ze=(e,t,l)=>(N(et(B,t),(([a,s])=>{Xe(a,((t,l)=>{U(e,l)||(e[l]=t)})),Xe(s,(a=>{U(e,a)||Mt(t,l,a)}))})),e),qe=e=>(t&&(Xe(j,((t,l)=>{U(e,l)||(e[l]=t)})),Xe(Y,(t=>{U(e,t)||Ft(t)}))),e),$e=e=>st(P,e,((e,t,l)=>{const a=Ze(),s=wt();st(at(P,t,Ze),l,((e,t,l)=>{lt(e,t,l),N(l[u],(e=>lt(a,t,e)),(()=>ft(s,t)))})),lt(B,t,[a,s])}),((e,t)=>{lt(P,t),lt(B,t)})),Ae=e=>st(H,e,((e,t,l)=>{lt(H,t,l),N(l[u],(e=>lt(j,t,e)),(()=>ft(Y,t)))}),((e,t)=>{lt(H,t),lt(j,t),Ye(Y,t)})),Je=e=>K(e)?ul():nl(e),Me=e=>st(ee,e,((e,t,l)=>Fe(t,l)),((e,t)=>pt(t))),Fe=(e,t)=>st(at(ee,e,(()=>(Lt(e,1),lt(Z,e,Ct()),lt(_,e,Ze()),Ze()))),t,((t,l,a)=>Oe(e,t,l,a)),((t,l)=>xt(e,t,l))),Oe=(e,t,l,a,s)=>st(at(t,l,(()=>(zt(e,l,1),Ze()))),a,((t,a,s)=>Pe(e,l,t,a,s)),((a,n)=>Nt(e,t,l,a,n,s))),Pe=(e,t,l,a,s)=>{We(l,a)||qt(e,t,a,1);const n=et(l,a);s!==n&&($t(e,t,a,n,s),lt(l,a,s))},Be=(e,t,l,a,s)=>N(et(t,l),(t=>Pe(e,l,t,a,s)),(()=>Oe(e,t,l,ze({[a]:s},e,l)))),Ke=e=>K(e)?ml():ol(e),ht=e=>st(te,e,((e,t,l)=>mt(t,l)),((e,t)=>Et(t))),mt=(e,t)=>{We(te,e)||At(e,1);const l=et(te,e);t!==l&&(Jt(e,l,t),lt(te,e,t))},gt=(e,t)=>{const[l]=et(Z,e),a=l(t);return We(et(ee,e),a)?gt(e,t):a},bt=e=>et(ee,e)??Fe(e,{}),pt=e=>Fe(e,{}),xt=(e,t,l)=>{const[,a]=et(Z,e);a(l),Oe(e,t,l,{},!0)},Nt=(e,t,l,a,s,n)=>{const o=et(et(B,e)?.[0],s);if(!x(o)&&!n)return Pe(e,l,a,s,o);const r=t=>{$t(e,l,t,et(a,t)),qt(e,l,t,-1),lt(a,t)};x(o)?r(s):tt(a,r),Ge(a)&&(zt(e,l,-1),Ge(lt(t,l))&&(Lt(e,-1),lt(ee,e),lt(Z,e),lt(_,e)))},Et=e=>{const t=et(j,e);if(!x(t))return mt(e,t);Jt(e,et(te,e)),At(e,-1),lt(te,e)},Lt=(e,t)=>St(o,e,t),zt=(e,t,l)=>St(at(T,e,Ze),t,l)&&lt(c,e,at(c,e,(()=>0))+l),qt=(e,t,l,a)=>{const s=et(_,e),n=et(s,l)??0;(0==n&&1==a||1==n&&-1==a)&&St(at(i,e,Ze),l,a),lt(s,l,n!=-a?n+a:null),St(at(at(V,e,Ze),t,Ze),l,a)},$t=(e,t,l,a,s)=>at(at(at(S,e,Ze),t,Ze),l,(()=>[a,0]))[1]=s,At=(e,t)=>St(R,e,t),Jt=(e,t,l)=>at(z,e,(()=>[t,0]))[1]=l,Mt=(e,t,l,a,s)=>(M(at(at(at(F,e,Ze),t,Ze),l,(()=>[])),a),s),Ft=(e,t,l)=>(M(at(O,e,(()=>[])),t),l),Ot=(e,t,l)=>N(et(et(et(S,e),t),l),(([e,t])=>[!0,e,t]),(()=>[!1,...vt(tl(e,t,l))])),Pt=e=>N(et(z,e),(([e,t])=>[!0,e,t]),(()=>[!1,...vt(sl(e))])),Bt=e=>Ge(F)||Ge(he[e])?0:Xe(e?ut(F):F,((t,l)=>Xe(t,((t,a)=>Xe(t,((t,s)=>Te(he[e],[l,a,s],t))))))),Dt=e=>Ge(O)||Ge(me[e])?0:Xe(e?it(O):O,((t,l)=>Te(me[e],[l],t))),Ht=(e,t,l)=>{if(!Ge(t))return Te(e,l,(()=>nt(t))),1},jt=e=>{const t=Ge(ie[e]),l=Ge(ue[e])&&Ge(ne[e])&&Ge(oe[e])&&Ge(re[e])&&t&&Ge(ae[e]),a=Ge(ce[e])&&Ge(de[e])&&Ge(se[e])&&Ge(le[e]);if(!l||!a){const s=e?[it(o),dt(i),it(c),dt(T),ut(V),ut(S)]:[o,i,c,T,V,S];if(!l){Ht(ae[e],s[0]),Xe(s[1],((t,l)=>Ht(ne[e],t,[l]))),Xe(s[2],((t,l)=>{0!=t&&Te(oe[e],[l],Yt(l))}));const l=wt();Xe(s[3],((a,s)=>{Ht(re[e],a,[s])&&!t&&(Te(ie[e],[s,null]),ft(l,s))})),t||Xe(s[5],((t,a)=>{if(!We(l,a)){const l=wt();Xe(t,(e=>Xe(e,(([t,a],s)=>a!==t?ft(l,s):Ye(e,s))))),Xe(l,(t=>Te(ie[e],[a,t])))}})),Xe(s[4],((t,l)=>Xe(t,((t,a)=>Ht(ue[e],t,[l,a])))))}if(!a){let t;Xe(s[5],((l,a)=>{let s;Xe(l,((l,n)=>{let o;Xe(l,(([l,r],i)=>{r!==l&&(Te(ce[e],[a,n,i],r,l,Ot),t=s=o=1)})),o&&Te(de[e],[a,n],Ot)})),s&&Te(se[e],[a],Ot)})),t&&Te(le[e],void 0,Ot)}}},Ut=e=>{const t=Ge(be[e]),l=Ge(Ce[e])&&Ge(ge[e]);if(!t||!l){const a=e?[it(R),it(z)]:[R,z];if(t||Ht(be[e],a[0]),!l){let t;Xe(a[1],(([l,a],s)=>{a!==l&&(Te(Ce[e],[s],a,l,Pt),t=1)})),t&&Te(ge[e],void 0,Pt)}}},Wt=(e,...t)=>(wl((()=>e(...$(t,k)))),Cl),Gt=()=>[nt(S,((e,t)=>-1===et(o,t)?null:nt(e,((e,l)=>-1===et(et(T,t),l)?null:nt(e,(([,e])=>e??null),((e,t)=>Vt(t)))),K)),K),nt(z,(([,e])=>e??null),((e,t)=>Vt(t)))],Kt=()=>({cellsTouched:l,valuesTouched:a,changedCells:rt(S,Tt,Vt),invalidCells:rt(F),changedValues:nt(z,Tt,Vt),invalidValues:nt(O),changedTableIds:nt(o),changedRowIds:ot(T),changedCellIds:rt(V),changedValueIds:nt(R)}),Qt=()=>rt(ee),Xt=()=>_e(ee),Yt=e=>De(et(ee,k(e))),Zt=e=>_e(et(ee,k(e))),_t=(e,t,l,a=0,s)=>{return $(J((o=et(ee,k(e)),r=(e,l)=>[x(t)?l:et(e,k(t)),l],n=([e],[t])=>((e??0)<(t??0)?-1:1)*(l?-1:1),$([...o?.entries()??[]],(([e,t])=>r(t,e))).sort(n)),a,x(s)?s:a+s),(([,e])=>e));var n,o,r},el=(e,t)=>_e(et(et(ee,k(e)),k(t))),tl=(e,t,l)=>et(et(et(ee,k(e)),k(t)),k(l)),ll=()=>nt(te),al=()=>_e(te),sl=e=>et(te,k(e)),nl=e=>Wt((()=>(e=>kt(e,Re,Mt))(e)?Me(e):0)),ol=e=>Wt((()=>Ee(e)?ht(e):0)),rl=e=>{try{Je(X(e))}catch{}return Cl},il=t=>Wt((()=>{if((e=kt(t,(e=>kt(e,Se))))&&($e(t),!Ge(ee))){const e=Qt();ul(),nl(e)}})),dl=e=>Wt((()=>{if(t=(e=>kt(e,Se))(e)){const l=ll();bl(),ml(),t=!0,Ae(e),ol(l)}})),ul=()=>Wt((()=>Me({}))),cl=e=>Wt((e=>We(ee,e)?pt(e):0),e),hl=(e,t)=>Wt(((e,t)=>N(et(ee,e),(l=>We(l,t)?xt(e,l,t):0))),e,t),ml=()=>Wt((()=>ht({}))),gl=()=>Wt((()=>{$e({}),e=!1})),bl=()=>Wt((()=>{Ae({}),t=!1})),wl=(e,t)=>{if(-1!=n){fl();const l=e();return pl(t),l}},fl=()=>(-1!=n&&n++,1==n&&Te(ve,void 0,Gt,Kt),Cl),pl=e=>(n>0&&(n--,0==n&&(l=!Ge(S),a=!Ge(z),n=1,Bt(1),l&&jt(1),Dt(1),a&&Ut(1),e?.(Gt,Kt)&&(Xe(S,((e,t)=>Xe(e,((e,l)=>Xe(e,(([e],a)=>fe(Cl,t,l,a,e))))))),Xe(z,(([e],t)=>pe(Cl,t,e))),l=a=!1),Te(Ie[0],void 0,Gt,Kt),n=-1,Bt(0),l&&jt(0),Dt(0),a&&Ut(0),Te(Ie[1],void 0,Gt,Kt),n=0,l=a=!1,q([o,i,c,T,V,S,F,R,z,O],Qe))),Cl),Cl={getContent:()=>[Qt(),ll()],getTables:Qt,getTableIds:Xt,getTable:e=>ot(et(ee,k(e))),getTableCellIds:e=>_e(et(_,k(e))),getRowCount:Yt,getRowIds:Zt,getSortedRowIds:_t,getRow:(e,t)=>nt(et(et(ee,k(e)),k(t))),getCellIds:el,getCell:tl,getValues:ll,getValueIds:al,getValue:sl,hasTables:()=>!Ge(ee),hasTable:e=>We(ee,k(e)),hasTableCell:(e,t)=>We(et(_,k(e)),k(t)),hasRow:(e,t)=>We(et(ee,k(e)),k(t)),hasCell:(e,t,l)=>We(et(et(ee,k(e)),k(t)),k(l)),hasValues:()=>!Ge(te),hasValue:e=>We(te,k(e)),getTablesJson:()=>Q(ee),getValuesJson:()=>Q(te),getJson:()=>Q([ee,te]),getTablesSchemaJson:()=>Q(P),getValuesSchemaJson:()=>Q(H),getSchemaJson:()=>Q([P,H]),setContent:([e,t])=>Wt((()=>{(K(e)?ul:nl)(e),(K(t)?ml:ol)(t)})),setTables:nl,setTable:(e,t)=>Wt((e=>Re(t,e)?Fe(e,t):0),e),setRow:(e,t,l)=>Wt(((e,t)=>xe(e,t,l)?Oe(e,bt(e),t,l):0),e,t),addRow:(e,t,l=!0)=>wl((()=>{let a;return xe(e,a,t)&&(e=k(e),Oe(e,bt(e),a=gt(e,l?1:0),t)),a})),setPartialRow:(e,t,l)=>Wt(((e,t)=>{if(xe(e,t,l,1)){const a=bt(e);G(l,((l,s)=>Be(e,a,t,s,l)))}}),e,t),setCell:(e,t,l,a)=>Wt(((e,t,l)=>N(Ne(e,t,l,L(a)?a(tl(e,t,l)):a),(a=>Be(e,bt(e),t,l,a)))),e,t,l),setValues:ol,setPartialValues:e=>Wt((()=>Ee(e,1)?G(e,((e,t)=>mt(t,e))):0)),setValue:(e,t)=>Wt((e=>N(Le(e,L(t)?t(sl(e)):t),(t=>mt(e,t)))),e),setTransactionChanges:e=>Wt((()=>{G(e[0],((e,t)=>x(e)?cl(t):G(e,((e,l)=>x(e)?hl(t,l):G(e,((e,a)=>fe(Cl,t,l,a,e))))))),G(e[1],((e,t)=>pe(Cl,t,e)))})),setTablesJson:rl,setValuesJson:e=>{try{Ke(X(e))}catch{}return Cl},setJson:e=>{try{const[t,l]=X(e);Je(t),Ke(l)}catch{rl(e)}return Cl},setTablesSchema:il,setValuesSchema:dl,setSchema:(e,t)=>Wt((()=>{il(e),dl(t)})),delTables:ul,delTable:cl,delRow:hl,delCell:(e,t,l,a)=>Wt(((e,t,l)=>N(et(ee,e),(s=>N(et(s,t),(n=>We(n,l)?Nt(e,s,t,n,l,a):0))))),e,t,l),delValues:ml,delValue:e=>Wt((e=>We(te,e)?Et(e):0),e),delTablesSchema:gl,delValuesSchema:bl,delSchema:()=>Wt((()=>{gl(),bl()})),transaction:wl,startTransaction:fl,finishTransaction:pl,forEachTable:e=>Xe(ee,((t,l)=>e(l,(e=>Xe(t,((t,l)=>e(l,(e=>tt(t,e))))))))),forEachTableCell:(e,t)=>tt(et(_,k(e)),t),forEachRow:(e,t)=>Xe(et(ee,k(e)),((e,l)=>t(l,(t=>tt(e,t))))),forEachCell:(e,t,l)=>tt(et(et(ee,k(e)),k(t)),l),forEachValue:e=>tt(te,e),addSortedRowIdsListener:(e,t,l,a,s,n,o)=>{let r=_t(e,t,l,a,s);return ye((()=>{const o=_t(e,t,l,a,s);var i,d,u;d=r,A(i=o)===A(d)&&(u=(e,t)=>d[t]===e,i.every(u))||(r=o,n(Cl,e,t,l,a,s,r))}),ie[o?1:0],[e,t],[Xt])},addStartTransactionListener:e=>ye(e,ve),addWillFinishTransactionListener:e=>ye(e,Ie[0]),addDidFinishTransactionListener:e=>ye(e,Ie[1]),callListener:e=>(ke(e),Cl),delListener:e=>(Ve(e),Cl),getListenerStats:()=>({tables:It(le),tableIds:It(ae),tableCellIds:It(ne),table:It(se),rowCount:It(oe),rowIds:It(re),sortedRowIds:It(ie),row:It(de,je),cellIds:It(ue,je),cell:It(ce,Ue),invalidCell:It(he,Ue),values:It(ge),valueIds:It(be),value:It(Ce),invalidValue:It(me),transaction:He(ve)+It(Ie)}),createStore:Rt};return G({[m]:[0,le],[g]:[0,ae],[h]:[1,se,[Xt]],[h+C]:[1,ne,[Xt]],[w]:[1,oe,[Xt]],[f]:[1,re,[Xt]],[b]:[2,de,[Xt,Zt]],[C]:[2,ue,[Xt,Zt]],[p]:[3,ce,[Xt,Zt,el],e=>vt(tl(...e))],InvalidCell:[3,he],[I]:[0,ge],[y]:[0,be],[v]:[1,Ce,[al],e=>vt(sl(e[0]))],InvalidValue:[1,me]},(([e,t,l,a],s)=>{Cl["add"+s+"Listener"]=(...s)=>ye(s[e],t[s[e+1]?1:0],e>0?J(s,0,e):void 0,l,a)})),D(Cl)},xt=({position:e="right",open:a=!1})=>{const s=t.useCreateStore(Rt),n=_.indexOf(e);return t.useCreatePersister(s,(e=>{return((e,t,l,a)=>((e,t,l,a,s,n,o=[])=>{let r,i,d,u=0,c=0,h=0,m=0;at(ht,o,(()=>0)),at(mt,o,(()=>[]));const g=async e=>(2!=u&&(u=1,c++,await b.schedule((async()=>{await e(),u=0}))),b),b={load:async(l,a)=>await g((async()=>{try{e.setContent(await t())}catch{e.setContent([l,a])}})),startAutoLoad:async(l={},s={})=>(b.stopAutoLoad(),await b.load(l,s),m=1,d=a((async(l,a)=>{if(a){const t=a();await g((async()=>e.setTransactionChanges(t)))}else await g((async()=>{try{e.setContent(l?.()??await t())}catch(e){n?.(e)}}))})),b),stopAutoLoad:()=>(m&&(s(d),d=void 0,m=0),b),save:async t=>(1!=u&&(u=2,h++,await b.schedule((async()=>{try{await l(e.getContent,t)}catch(e){n?.(e)}u=0}))),b),startAutoSave:async()=>(await b.stopAutoSave().save(),r=e.addDidFinishTransactionListener(((e,t)=>{const[l,a]=t();K(l)&&K(a)||b.save((()=>[l,a]))})),b),stopAutoSave:()=>(N(r,e.delListener),b),schedule:async(...e)=>(M(et(mt,o),...e),await(async()=>{if(!et(ht,o)){for(lt(ht,o,1);!x(i=F(et(mt,o)));)try{await i()}catch(e){n?.(e)}lt(ht,o,0)}})(),b),getStore:()=>e,destroy:()=>b.stopAutoLoad().stopAutoSave(),getStats:()=>({loads:c,saves:h})};return D(b)})(e,(async()=>X(l.getItem(t))),(async e=>l.setItem(t,Q(e()))),(e=>{const a=a=>{a.storageArea===l&&a.key===t&&e((()=>X(a.newValue)))};return bt.addEventListener(gt,a),a}),(e=>bt.removeEventListener(gt,e)),a))(e,Y,sessionStorage,t);var t}),void 0,(async e=>{await e.load(void 0,{position:-1==n?1:n,open:!!a}),await e.startAutoSave()})),me(l.Fragment,null,me("aside",{id:Y},me(be,{s:s}),me(Pe,{s:s})),me("style",null,he))};e.EditableCellView=Le,e.EditableValueView=ze,e.ResultSortedTableInHtmlTable=({queryId:e,cellId:l,descending:a,offset:s,limit:n,queries:o,sortOnClick:r,paginator:i=!1,onChange:d,...u})=>{const[c,h,m]=ke(l,a,r,s,n,t.useResultRowCount(e,o),i,d);return me(Re,{...u,params:Ie((()=>[{queryId:e,queries:o},[e,o],t.ResultCellView,t.useResultTableCellIds,c,h,m]),[e,o,c,h,m]),rowIds:t.useResultSortedRowIds(e,...c,n,o)})},e.ResultTableInHtmlTable=({queryId:e,queries:l,...a})=>me(Re,{...a,params:Ie((()=>[{queryId:e,queries:l},[e,l],t.ResultCellView,t.useResultTableCellIds]),[e,l]),rowIds:t.useResultRowIds(e,l)}),e.SortedTableInHtmlTable=Ne,e.SortedTablePaginator=qe,e.StoreInspector=e=>me(xt,{...e}),e.TableInHtmlTable=({tableId:e,store:l,editable:a,...s})=>me(Re,{...s,params:Ie((()=>[{tableId:e,store:l},[e,l],a?Le:t.CellView,t.useTableCellIds]),[l,e,a]),rowIds:t.useRowIds(e,l)}),e.ValuesInHtmlTable=Ee},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("./ui-react"),require("react")):"function"==typeof define&&define.amd?define(["exports","./ui-react","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseUiReactDomDebug={},e.TinyBaseUiReact,e.React);
