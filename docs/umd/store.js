var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s=t(""),n=t(!0),r=t(0),l=t(t),o="type",a="default",d=(e,t)=>e.forEach(t),c=e=>e.length,i=e=>0==c(e),f=e=>e.slice(1),u=(e,t)=>e.push(t),h=e=>JSON.stringify(e,((e,t)=>{return T(t,Map)?(s=[...t],n=(e,[t,s])=>(e[t]=s,e),r={},s.reduce(n,r)):t;var s,n,r})),b=JSON.parse,p=isFinite,T=(e,t)=>e instanceof t,g=e=>null==e,y=(e,t,s)=>g(e)?s?.():t(e),w=e=>e==s||e==n,L=(e,t)=>e?.has(t)??!1,R=e=>g(e)||0==(e=>e.size)(e),C=e=>e.clear(),S=(e,t)=>e?.forEach(t),v=(e,t)=>e?.delete(t),I=e=>new Map(e),m=(e=I)=>[e(),e()],E=e=>[...e?.keys()??[]],J=(e,t)=>e?.get(t),O=(e,t)=>S(e,((e,s)=>t(s,e))),j=(e,t,s)=>g(s)?(v(e,t),e):e?.set(t,s),x=(e,t,s,n)=>(L(e,t)||(n?.(s),e.set(t,s)),J(e,t)),z=(e,t)=>{const s={},n=t??(e=>e);return S(e,((e,t)=>s[t]=n(e))),s},M=(e,t)=>{const s=I(),n=t??(e=>e);return S(e,((e,t)=>s.set(t,n(e)))),s},k=Object,F=k.keys,N=k.isFrozen,P=k.freeze,_=(e,t)=>!g(((e,t)=>y(e,(e=>e[t])))(e,t)),B=(e,t)=>delete e[t],q=(e,t)=>d(k.entries(e),(([e,s])=>t(s,e))),A=e=>i(F(e)),D=e=>new Set(e),G=(e,t)=>e?.add(t),H=(e,t,s)=>c(s)<2?G(i(s)?e:x(e,s[0],D()),t):H(x(e,s[0],I()),t,f(s)),K=e=>{const t=(s,n,...r)=>y(s,(s=>i(r)?e(s,n):d([r[0],null],(e=>t(J(s,e),n,...f(r))))));return t},Q=(e,t,s,n=j)=>{const r=(l=E(e),o=e=>!_(t,e),l.filter(o));var l,o;return d(F(t),(n=>s(e,n,t[n]))),d(r,(t=>n(e,t))),e},U=e=>{const s=t(e);return w(s)||s==r&&p(e)?s:void 0},V=(e,t,s)=>g(e)||!(e=>T(e,k)&&e.constructor==k)(e)||A(e)||N(e)?(s?.(),!1):(q(e,((s,n)=>{t(s,n)||B(e,n)})),!A(e)),W=(e,t,s)=>j(e,t,J(e,t)==-s?void 0:s);e.createStore=()=>{let e,s=0,n=0;const i=I(),f=I(),p=I(),T=I(),k=I(),F=I(),N=I(),A=I(),X=m(D),Y=m(D),Z=m(),$=m(),ee=m(),te=m(),se=m(),ne=m(),[re,le,oe,ae]=(e=>{let t,s=0;const n=[],r=I();return[(l,o,a=[])=>{t??=e();const d=n.pop()??""+s++;return j(r,d,[l,o,a]),H(o,d,a),d},(e,s=[],...n)=>K(S)(e,(e=>y(J(r,e),(([e])=>e(t,...s,...n)))),...s),e=>y(J(r,e),(([,t,s])=>(K(v)(t,e,...s),j(r,e),c(n)<1e3&&u(n,e),s)),(()=>[])),(e,s,n)=>y(J(r,e),(([e,,r])=>{const l=(...o)=>{const a=c(o);a==c(r)?e(t,...o,...n(o)):g(r[a])?d(s[a](...o),(e=>l(...o,e))):l(...o,r[a])};l()}))]})((()=>qe)),de=(t,s)=>(!e||L(F,s)||Ee(s))&&V(t,((e,t)=>ce(s,t,e)),(()=>Ee(s))),ce=(e,t,s,n)=>V(n?s:fe(s,e,t),((n,r)=>y(ie(e,t,r,n),(e=>(s[r]=e,!0)),(()=>!1))),(()=>Ee(e,t))),ie=(t,s,n,r)=>e?y(J(J(F,t),n),(e=>U(r)!=e.type?Ee(t,s,n,r,e.default):r),(()=>Ee(t,s,n,r))):g(U(r))?Ee(t,s,n,r):r,fe=(e,t,s)=>(y(J(N,t),(([n,r])=>{S(n,((t,s)=>{_(e,s)||(e[s]=t)})),S(r,(n=>{_(e,n)||Ee(t,s,n)}))})),e),ue=e=>Q(F,e,((e,t,s)=>{const n=I(),r=D();Q(x(F,t,I()),s,((e,t,s)=>{j(e,t,s),y(s.default,(e=>j(n,t,e)),(()=>G(r,t)))})),j(N,t,[n,r])}),((e,t)=>{j(F,t),j(N,t)})),he=e=>Q(A,e,((e,t,s)=>be(t,s)),((e,t)=>Le(t))),be=(e,t)=>Q(x(A,e,I(),(()=>Se(e,1))),t,((t,s,n)=>pe(e,t,s,n)),((t,s)=>Re(e,t,s))),pe=(e,t,s,n,r)=>Q(x(t,s,I(),(()=>ve(e,s,1))),n,((t,n,r)=>Te(e,s,t,n,r)),((n,l)=>Ce(e,t,s,n,l,r))),Te=(e,t,s,n,r)=>{L(s,n)||Ie(e,t,n,1);const l=J(s,n);r!==l&&(me(e,t,n,l),j(s,n,r))},ge=(e,t,s,n,r)=>y(J(t,s),(t=>Te(e,s,t,n,r)),(()=>pe(e,t,s,fe({[n]:r},e,s)))),ye=e=>{const t=""+s++;return L(e,t)?ye(e):t},we=e=>J(A,e)??be(e,{}),Le=e=>be(e,{}),Re=(e,t,s)=>pe(e,t,s,{},!0),Ce=(e,t,s,n,r,l)=>{const o=J(J(N,e)?.[0],r);if(!g(o)&&!l)return Te(e,s,n,r,o);const a=t=>{me(e,s,t,J(n,t)),Ie(e,s,t,-1),j(n,t)};g(o)?a(r):O(n,a),R(n)&&(ve(e,s,-1),R(j(t,s))&&(Se(e,-1),j(A,e)))},Se=(e,t)=>W(i,e,t),ve=(e,t,s)=>W(x(f,e,I()),t,s),Ie=(e,t,s,n)=>W(x(x(p,e,I()),t,I()),s,n),me=(e,t,s,n)=>x(x(x(T,e,I()),t,I()),s,n),Ee=(e,t,s,n,r)=>(u(x(x(x(k,e,I()),t,I()),s,[]),n),r),Je=(e,t,s)=>{const n=J(J(T,e),t),r=Ne(e,t,s);return L(n,s)?[!0,J(n,s),r]:[!1,r,r]},Oe=e=>R(k)||R(ne[e])?0:S(e?M(k,(e=>M(e,M))):k,((t,s)=>S(t,((t,n)=>S(t,((t,r)=>le(ne[e],[s,n,r],t))))))),je=e=>{if(!R(T)){const t=R(te[e])&&R($[e])&&R(Y[e]),s=R(se[e])&&R(ee[e])&&R(Z[e])&&R(X[e]);if(!t||!s){const n=e?[M(i),M(f,M),M(p,(e=>M(e,M))),M(T,(e=>M(e,M)))]:[i,f,p,T];if(t||(S(n[2],((t,s)=>S(t,((t,n)=>{R(t)||le(te[e],[s,n])})))),S(n[1],((t,s)=>{R(t)||le($[e],[s])})),R(n[0])||le(Y[e])),!s){let t;S(n[3],((s,n)=>{let r;S(s,((s,l)=>{let o;S(s,((s,a)=>{const d=Ne(n,l,a);d!==s&&(le(se[e],[n,l,a],d,s,Je),t=r=o=1)})),o&&le(ee[e],[n,l],Je)})),r&&le(Z[e],[n],Je)})),t&&le(X[e],[],Je)}}}},xe=e=>(Be(e),qe),ze=()=>z(A,(e=>z(e,z))),Me=()=>E(A),ke=e=>E(J(A,e)),Fe=(e,t)=>E(J(J(A,e),t)),Ne=(e,t,s)=>J(J(J(A,e),t),s),Pe=e=>xe((()=>(e=>V(e,de,Ee))(e)?he(e):0)),_e=()=>xe((()=>he({}))),Be=e=>{if(-1==n)return;n++;const t=e?.();return n--,0==n&&(n=1,Oe(1),je(1),n=-1,Oe(0),je(0),n=0,d([T,k,i,f,p],C)),t},qe={getTables:ze,getTableIds:Me,getTable:e=>z(J(A,e),z),getRowIds:ke,getRow:(e,t)=>z(J(J(A,e),t)),getCellIds:Fe,getCell:Ne,hasTables:()=>!R(A),hasTable:e=>L(A,e),hasRow:(e,t)=>L(J(A,e),t),hasCell:(e,t,s)=>L(J(J(A,e),t),s),getJson:()=>h(A),getSchemaJson:()=>h(F),setTables:Pe,setTable:(e,t)=>xe((()=>de(t,e)?be(e,t):0)),setRow:(e,t,s)=>xe((()=>ce(e,t,s)?pe(e,we(e),t,s):0)),addRow:(e,t)=>Be((()=>{let s;return ce(e,s,t)&&pe(e,we(e),s=ye(J(A,e)),t),s})),setPartialRow:(e,t,s)=>xe((()=>{if(ce(e,t,s,1)){const n=we(e);q(s,((s,r)=>ge(e,n,t,r,s)))}})),setCell:(e,s,n,r)=>xe((()=>y(ie(e,s,n,t(r)==l?r(Ne(e,s,n)):r),(t=>ge(e,we(e),s,n,t))))),setJson:e=>{try{"{}"===e?_e():Pe(b(e))}catch{}return qe},setSchema:t=>xe((()=>{if((e=(e=>V(e,(e=>V(e,(e=>{if(!V(e,((e,t)=>[o,a].includes(t))))return!1;const t=e.type;return!(!w(t)&&t!=r||(U(e.default)!=t&&B(e,a),0))})))))(t))&&(ue(t),!R(A))){const e=ze();_e(),Pe(e)}})),delTables:_e,delTable:e=>xe((()=>L(A,e)?Le(e):0)),delRow:(e,t)=>xe((()=>y(J(A,e),(s=>L(s,t)?Re(e,s,t):0)))),delCell:(e,t,s,n)=>xe((()=>y(J(A,e),(r=>y(J(r,t),(l=>L(l,s)?Ce(e,r,t,l,s,n):0)))))),delSchema:()=>xe((()=>{ue({}),e=!1})),transaction:Be,forEachTable:e=>S(A,((t,s)=>e(s,(e=>S(t,((t,s)=>e(s,(e=>O(t,e))))))))),forEachRow:(e,t)=>S(J(A,e),((e,s)=>t(s,(t=>O(e,t))))),forEachCell:(e,t,s)=>O(J(J(A,e),t),s),addTablesListener:(e,t)=>re(e,X[t?1:0]),addTableIdsListener:(e,t)=>re(e,Y[t?1:0]),addTableListener:(e,t,s)=>re(t,Z[s?1:0],[e]),addRowIdsListener:(e,t,s)=>re(t,$[s?1:0],[e]),addRowListener:(e,t,s,n)=>re(s,ee[n?1:0],[e,t]),addCellIdsListener:(e,t,s,n)=>re(s,te[n?1:0],[e,t]),addCellListener:(e,t,s,n,r)=>re(n,se[r?1:0],[e,t,s]),addInvalidCellListener:(e,t,s,n,r)=>re(n,ne[r?1:0],[e,t,s]),callListener:e=>(ae(e,[Me,ke,Fe],(e=>g(e[2])?[]:[,,].fill(Ne(...e)))),qe),delListener:e=>(oe(e),qe),getListenerStats:()=>({})};return P(qe)},Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
