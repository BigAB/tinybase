var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s=t(""),n=t(!0),r=t(0),l=t(t),o="type",a="default",d=(e,t)=>e.forEach(t),c=e=>e.length,i=e=>0==c(e),u=e=>e.slice(1),f=(e,t)=>e.push(t),h=e=>JSON.stringify(e,((e,t)=>{return T(t,Map)?(s=[...t],n=(e,[t,s])=>(e[t]=s,e),r={},s.reduce(n,r)):t;var s,n,r})),b=JSON.parse,p=isFinite,T=(e,t)=>e instanceof t,g=e=>null==e,y=(e,t,s)=>g(e)?s?.():t(e),w=e=>e==s||e==n,L=(e,t)=>e?.has(t)??!1,R=e=>g(e)||0==(e=>e.size)(e),C=e=>e.clear(),S=(e,t)=>e?.forEach(t),v=(e,t)=>e?.delete(t),I=e=>new Map(e),m=(e=I)=>[e(),e()],E=e=>[...e?.keys()??[]],J=(e,t)=>e?.get(t),O=(e,t)=>S(e,((e,s)=>t(s,e))),j=(e,t,s)=>g(s)?(v(e,t),e):e?.set(t,s),x=(e,t,s,n)=>(L(e,t)||(n?.(s),e.set(t,s)),J(e,t)),z=(e,t)=>{const s={},n=t??(e=>e);return S(e,((e,t)=>s[t]=n(e))),s},M=(e,t)=>{const s=I(),n=t??(e=>e);return S(e,((e,t)=>s.set(t,n(e)))),s},k=Object,F=k.keys,N=k.isFrozen,P=k.freeze,_=(e,t)=>!g(((e,t)=>y(e,(e=>e[t])))(e,t)),B=(e,t)=>delete e[t],q=(e,t)=>d(k.entries(e),(([e,s])=>t(s,e))),A=e=>i(F(e)),D=e=>new Set(e),G=(e,t,s)=>c(s)<2?((e,t)=>e?.add(t))(i(s)?e:x(e,s[0],D()),t):G(x(e,s[0],I()),t,u(s)),H=e=>{const t=(s,n,...r)=>y(s,(s=>i(r)?e(s,n):d([r[0],null],(e=>t(J(s,e),n,...u(r))))));return t},K=(e,t,s,n=j)=>{const r=(l=E(e),o=e=>!_(t,e),l.filter(o));var l,o;return d(F(t),(n=>s(e,n,t[n]))),d(r,(t=>n(e,t))),e},Q=e=>{const s=t(e);return w(s)||s==r&&p(e)?s:void 0},U=(e,t,s)=>g(e)||!(e=>T(e,k)&&e.constructor==k)(e)||A(e)||N(e)?(s?.(),!1):(q(e,((s,n)=>{t(s,n)||B(e,n)})),!A(e)),V=(e,t,s)=>j(e,t,J(e,t)==-s?void 0:s);e.createStore=()=>{let e,s=0,n=0;const i=I(),u=I(),p=I(),T=I(),k=I(),F=I(),N=I(),A=I(),W=m(D),X=m(D),Y=m(),Z=m(),$=m(),ee=m(),te=m(),se=m(),[ne,re,le,oe]=(e=>{let t,s=0;const n=[],r=I();return[(l,o,a=[])=>{t??=e();const d=n.pop()??""+s++;return j(r,d,[l,o,a]),G(o,d,a),d},(e,s=[],...n)=>H(S)(e,(e=>y(J(r,e),(([e])=>e(t,...s,...n)))),...s),e=>y(J(r,e),(([,t,s])=>(H(v)(t,e,...s),j(r,e),c(n)<1e3&&f(n,e),s)),(()=>[])),(e,s,n)=>y(J(r,e),(([e,,r])=>{const l=(...o)=>{const a=c(o);a==c(r)?e(t,...o,...n(o)):g(r[a])?d(s[a](...o),(e=>l(...o,e))):l(...o,r[a])};l()}))]})((()=>Be)),ae=(t,s)=>(!e||L(F,s)||me(s))&&U(t,((e,t)=>de(s,t,e)),(()=>me(s))),de=(e,t,s,n)=>U(n?s:ie(s,e),((n,r)=>y(ce(e,t,r,n),(e=>(s[r]=e,!0)),(()=>!1))),(()=>me(e,t))),ce=(t,s,n,r)=>e?y(J(J(F,t),n),(e=>Q(r)!=e.type?me(t,s,n,r,e.default):r),(()=>me(t,s,n,r))):g(Q(r))?me(t,s,n,r):r,ie=(e,t)=>(y(J(N,t),(t=>q(t,((t,s)=>{_(e,s)||(e[s]=t)})))),e),ue=e=>K(F,e,((e,t,s)=>{const n={};K(x(F,t,I()),s,((e,t,s)=>{j(e,t,s),y(s.default,(e=>n[t]=e))})),j(N,t,n)}),((e,t)=>{j(F,t),j(N,t)})),fe=e=>K(A,e,((e,t,s)=>he(t,s)),((e,t)=>we(t))),he=(e,t)=>K(x(A,e,I(),(()=>Ce(e,1))),t,((t,s,n)=>be(e,t,s,n)),((t,s)=>Le(e,t,s))),be=(e,t,s,n,r)=>K(x(t,s,I(),(()=>Se(e,s,1))),n,((t,n,r)=>pe(e,s,t,n,r)),((n,l)=>Re(e,t,s,n,l,r))),pe=(e,t,s,n,r)=>{L(s,n)||ve(e,t,n,1);const l=J(s,n);r!==l&&(Ie(e,t,n,l),j(s,n,r))},Te=(e,t,s,n,r)=>y(J(t,s),(t=>pe(e,s,t,n,r)),(()=>be(e,t,s,ie({[n]:r},e)))),ge=e=>{const t=""+s++;return L(e,t)?ge(e):t},ye=e=>J(A,e)??he(e,{}),we=e=>he(e,{}),Le=(e,t,s)=>be(e,t,s,{},!0),Re=(e,t,s,n,r,l)=>{const o=J(N,e)?.[r];if(!g(o)&&!l)return pe(e,s,n,r,o);const a=t=>{Ie(e,s,t,J(n,t)),ve(e,s,t,-1),j(n,t)};g(o)?a(r):O(n,a),R(n)&&(Se(e,s,-1),R(j(t,s))&&(Ce(e,-1),j(A,e)))},Ce=(e,t)=>V(i,e,t),Se=(e,t,s)=>V(x(u,e,I()),t,s),ve=(e,t,s,n)=>V(x(x(p,e,I()),t,I()),s,n),Ie=(e,t,s,n)=>x(x(x(T,e,I()),t,I()),s,n),me=(e,t,s,n,r)=>(f(x(x(x(k,e,I()),t,I()),s,[]),n),r),Ee=(e,t,s)=>{const n=J(J(T,e),t),r=Fe(e,t,s);return L(n,s)?[!0,J(n,s),r]:[!1,r,r]},Je=e=>R(k)||R(se[e])?0:S(e?M(k,(e=>M(e,M))):k,((t,s)=>S(t,((t,n)=>S(t,((t,r)=>re(se[e],[s,n,r],t))))))),Oe=e=>{let t,s;if(!(R(T)||(t=R(ee[e])&&R(Z[e])&&R(X[e]))&&(s=R(te[e])&&R($[e])&&R(Y[e])&&R(W[e])))){const n=e?[M(i),M(u,M),M(p,(e=>M(e,M))),M(T,(e=>M(e,M)))]:[i,u,p,T];if(t||(S(n[2],((t,s)=>S(t,((t,n)=>{R(t)||re(ee[e],[s,n])})))),S(n[1],((t,s)=>{R(t)||re(Z[e],[s])})),R(n[0])||re(X[e])),!s){let t;S(n[3],((s,n)=>{let r;S(s,((s,l)=>{let o;S(s,((s,a)=>{const d=Fe(n,l,a);d!==s&&(re(te[e],[n,l,a],d,s,Ee),t=r=o=1)})),o&&re($[e],[n,l],Ee)})),r&&re(Y[e],[n],Ee)})),t&&re(W[e],[],Ee)}}},je=e=>(_e(e),Be),xe=()=>z(A,(e=>z(e,z))),ze=()=>E(A),Me=e=>E(J(A,e)),ke=(e,t)=>E(J(J(A,e),t)),Fe=(e,t,s)=>J(J(J(A,e),t),s),Ne=e=>je((()=>(e=>U(e,ae,me))(e)?fe(e):0)),Pe=()=>je((()=>fe({}))),_e=e=>{if(-1==n)return;n++;const t=e?.();return n--,0==n&&(n=1,Je(1),Oe(1),n=-1,Je(0),Oe(0),n=0,d([T,k,i,u,p],C)),t},Be={getTables:xe,getTableIds:ze,getTable:e=>z(J(A,e),z),getRowIds:Me,getRow:(e,t)=>z(J(J(A,e),t)),getCellIds:ke,getCell:Fe,hasTables:()=>!R(A),hasTable:e=>L(A,e),hasRow:(e,t)=>L(J(A,e),t),hasCell:(e,t,s)=>L(J(J(A,e),t),s),getJson:()=>h(A),getSchemaJson:()=>h(F),setTables:Ne,setTable:(e,t)=>je((()=>ae(t,e)?he(e,t):0)),setRow:(e,t,s)=>je((()=>de(e,t,s)?be(e,ye(e),t,s):0)),addRow:(e,t)=>_e((()=>{let s;return de(e,s,t)&&be(e,ye(e),s=ge(J(A,e)),t),s})),setPartialRow:(e,t,s)=>je((()=>{if(de(e,t,s,1)){const n=ye(e);q(s,((s,r)=>Te(e,n,t,r,s)))}})),setCell:(e,s,n,r)=>je((()=>y(ce(e,s,n,t(r)==l?r(Fe(e,s,n)):r),(t=>Te(e,ye(e),s,n,t))))),setJson:e=>{try{"{}"===e?Pe():Ne(b(e))}catch{}return Be},setSchema:t=>je((()=>{if((e=(e=>U(e,(e=>U(e,(e=>{if(!U(e,((e,t)=>[o,a].includes(t))))return!1;const t=e.type;return!(!w(t)&&t!=r||(Q(e.default)!=t&&B(e,a),0))})))))(t))&&(ue(t),!R(A))){const e=xe();Pe(),Ne(e)}})),delTables:Pe,delTable:e=>je((()=>L(A,e)?we(e):0)),delRow:(e,t)=>je((()=>y(J(A,e),(s=>L(s,t)?Le(e,s,t):0)))),delCell:(e,t,s,n)=>je((()=>y(J(A,e),(r=>y(J(r,t),(l=>L(l,s)?Re(e,r,t,l,s,n):0)))))),delSchema:()=>je((()=>{ue({}),e=!1})),transaction:_e,forEachTable:e=>S(A,((t,s)=>e(s,(e=>S(t,((t,s)=>e(s,(e=>O(t,e))))))))),forEachRow:(e,t)=>S(J(A,e),((e,s)=>t(s,(t=>O(e,t))))),forEachCell:(e,t,s)=>O(J(J(A,e),t),s),addTablesListener:(e,t)=>ne(e,W[t?1:0]),addTableIdsListener:(e,t)=>ne(e,X[t?1:0]),addTableListener:(e,t,s)=>ne(t,Y[s?1:0],[e]),addRowIdsListener:(e,t,s)=>ne(t,Z[s?1:0],[e]),addRowListener:(e,t,s,n)=>ne(s,$[n?1:0],[e,t]),addCellIdsListener:(e,t,s,n)=>ne(s,ee[n?1:0],[e,t]),addCellListener:(e,t,s,n,r)=>ne(n,te[r?1:0],[e,t,s]),addInvalidCellListener:(e,t,s,n,r)=>ne(n,se[r?1:0],[e,t,s]),callListener:e=>(oe(e,[ze,Me,ke],(e=>g(e[2])?[]:[,,].fill(Fe(...e)))),Be),delListener:e=>(le(e),Be),getListenerStats:()=>({})};return P(Be)},Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
