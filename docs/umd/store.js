var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s="",n=t(s),a=t(!0),r=t(0),l=t(t),o="type",i="default",c="Ids",d="Table",u=d+"s",f=d+c,h="Row"+c,T="Cell",g=T+c,b="Value",V=b+"s",S=b+c,v=e=>s+e,y=(e,t)=>e.forEach(t),p=(e,t)=>e.map(t),w=e=>e.length,m=(e,t,s)=>e.slice(t,s),R=(e,...t)=>e.push(...t),J=e=>JSON.stringify(e,((e,t)=>{return L(t,Map)?(s=(e,[t,s])=>(e[t]=s,e),n={},[...t].reduce(s,n)):t;var s,n})),C=JSON.parse,I=isFinite,L=(e,t)=>e instanceof t,E=e=>null==e,F=(e,t,s)=>E(e)?s?.():t(e),x=e=>e==n||e==a,z=e=>t(e)==l,O=(e,t)=>e?.has(t)??!1,j=e=>E(e)||0==(e=>e.size)(e),k=e=>e.clear(),A=(e,t)=>e?.forEach(t),M=(e,t)=>e?.delete(t),N=e=>new Map(e),P=e=>[...e?.keys()??[]],B=(e,t)=>e?.get(t),D=(e,t)=>A(e,((e,s)=>t(s,e))),W=(e,t,s)=>E(s)?(M(e,t),e):e?.set(t,s),$=(e,t,s)=>(O(e,t)||W(e,t,s()),B(e,t)),q=(e,t,s)=>{const n={},a=t??(e=>e);return A(e,((e,t)=>F(a(e),(e=>s?.(e)?0:n[t]=e)))),n},G=(e,t)=>{const s=N(),n=t??(e=>e);return A(e,((e,t)=>s.set(t,n(e)))),s},H=e=>G(e,G),K=(e,t,s,n,a=0)=>F((s?$:B)(e,t[a],a>w(t)-2?s:N),(r=>{if(a>w(t)-2)return n?.(r)&&W(e,t[a]),r;const l=K(r,t,s,n,a+1);return j(r)&&W(e,t[a]),l})),Q=e=>new Set(Array.isArray(e)||E(e)?e:[e]),U=(e,t)=>e?.add(t),X=/^\d+$/,Y=()=>{const e=[];let t=0;return[n=>(n?e.shift():null)??s+t++,t=>{X.test(t)&&w(e)<1e3&&R(e,t)}]},Z=Object,_=Z.keys,ee=Z.isFrozen,te=Z.freeze,se=e=>L(e,Z)&&e.constructor==Z,ne=(e,t)=>!E(((e,t)=>F(e,(e=>e[t])))(e,t)),ae=(e,t)=>delete e[t],re=(e,t)=>p(Z.entries(e),(([e,s])=>t(s,e))),le=e=>{return se(e)&&(t=_(e),0==w(t));var t},oe=e=>[e,e],ie=()=>[N(),N()],ce=e=>{const s=t(e);return x(s)||s==r&&I(e)?s:void 0},de=(e,t,s,n=W)=>(re(t,((t,n)=>s(e,n,t))),D(e,(s=>ne(t,s)?0:n(e,s))),e),ue=(e,t,s)=>E(e)||!se(e)||le(e)||ee(e)?(s?.(),!1):(re(e,((s,n)=>{t(s,n)||ae(e,n)})),!le(e)),fe=(e,t,s)=>W(e,t,B(e,t)==-s?void 0:s),he=()=>{let e,t,n,a,l=0;const c=N(),I=N(),L=N(),X=N(),Z=N(),_=N(),ee=N(),se=N(),Te=N(),ge=N(),be=N(),Ve=N(),Se=Q(),ve=N(),ye=N(),pe=N(),we=ie(),me=ie(),Re=ie(),Je=ie(),Ce=ie(),Ie=ie(),Le=ie(),Ee=ie(),Fe=ie(),xe=ie(),ze=ie(),Oe=ie(),je=ie(),ke=N(),Ae=ie(),[Me,Ne,Pe,Be]=(e=>{let t;const[n,a]=Y(),r=N();return[(e,a,l,o=[],i=(()=>[]))=>{t??=Ut;const c=n(1);return W(r,c,[e,a,l,o,i]),U(K(a,l??[s],Q),c),c},(e,n,...a)=>y(((e,t=[s])=>{const n=[],a=(e,s)=>s==w(t)?R(n,e):null===t[s]?A(e,(e=>a(e,s+1))):y([t[s],null],(t=>a(B(e,t),s+1)));return a(e,0),n})(e,n),(e=>A(e,(e=>B(r,e)[0](t,...n??[],...a))))),e=>F(B(r,e),(([,t,n])=>(K(t,n??[s],void 0,(t=>(M(t,e),j(t)?1:0))),W(r,e),a(e),n))),e=>F(B(r,e),(([e,,s=[],n,a])=>{const r=(...l)=>{const o=w(l);o==w(s)?e(t,...l,...a(l)):E(s[o])?y(n[o]?.(...l)??[],(e=>r(...l,e))):r(...l,s[o])};r()}))]})(),De=e=>{if(!ue(e,((e,t)=>[o,i].includes(t))))return!1;const t=e[o];return!(!x(t)&&t!=r||(ce(e[i])!=t&&ae(e,i),0))},We=(t,s)=>(!e||O(Te,s)||St(s))&&ue(t,((e,t)=>$e(s,t,e)),(()=>St(s))),$e=(e,t,s,n)=>ue(n?s:Ke(s,e,t),((n,a)=>F(qe(e,t,a,n),(e=>(s[a]=e,!0)),(()=>!1))),(()=>St(e,t))),qe=(t,s,n,a)=>e?F(B(B(Te,t),n),(e=>ce(a)!=e[o]?St(t,s,n,a,e[i]):a),(()=>St(t,s,n,a))):E(ce(a))?St(t,s,n,a):a,Ge=(e,t)=>ue(t?e:Qe(e),((t,s)=>F(He(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>vt())),He=(e,s)=>t?F(B(be,e),(t=>ce(s)!=t[o]?vt(e,s,t[i]):s),(()=>vt(e,s))):E(ce(s))?vt(e,s):s,Ke=(e,t,s)=>(F(B(ge,t),(([n,a])=>{A(n,((t,s)=>{ne(e,s)||(e[s]=t)})),A(a,(n=>{ne(e,n)||St(t,s,n)}))})),e),Qe=e=>(t&&(A(Ve,((t,s)=>{ne(e,s)||(e[s]=t)})),A(Se,(t=>{ne(e,t)||vt(t)}))),e),Ue=e=>de(Te,e,((e,t,s)=>{const n=N(),a=Q();de($(Te,t,N),s,((e,t,s)=>{W(e,t,s),F(s[i],(e=>W(n,t,e)),(()=>U(a,t)))})),W(ge,t,[n,a])}),((e,t)=>{W(Te,t),W(ge,t)})),Xe=e=>de(be,e,((e,t,s)=>{W(be,t,s),F(s[i],(e=>W(Ve,t,e)),(()=>U(Se,t)))}),((e,t)=>{W(be,t),W(Ve,t),M(Se,t)})),Ye=e=>le(e)?Wt():Mt(e),Ze=e=>de(ye,e,((e,t,s)=>_e(t,s)),((e,t)=>it(t))),_e=(e,t)=>de($(ye,e,(()=>(ft(e,1),N()))),t,((t,s,n)=>et(e,t,s,n)),((t,s)=>ct(e,t,s))),et=(e,t,s,n,a)=>de($(t,s,(()=>(ht(e,s,1),N()))),n,((t,n,a)=>tt(e,s,t,n,a)),((n,r)=>dt(e,t,s,n,r,a))),tt=(e,t,s,n,a)=>{O(s,n)||Tt(e,t,n,1);const r=B(s,n);a!==r&&(gt(e,t,n,r,a),W(s,n,a))},st=(e,t,s,n,a)=>F(B(t,s),(t=>tt(e,s,t,n,a)),(()=>et(e,t,s,Ke({[n]:a},e,s)))),nt=e=>le(e)?$t():Nt(e),at=e=>de(pe,e,((e,t,s)=>rt(t,s)),((e,t)=>ut(t))),rt=(e,t)=>{O(pe,e)||bt(e,1);const s=B(pe,e);t!==s&&(Vt(e,s,t),W(pe,e,t))},lt=(e,t)=>{const[s]=$(ve,e,Y),n=s(t);return O(B(ye,e),n)?lt(e,t):n},ot=e=>B(ye,e)??_e(e,{}),it=e=>_e(e,{}),ct=(e,t,s)=>{const[,n]=$(ve,e,Y);n(s),et(e,t,s,{},!0)},dt=(e,t,s,n,a,r)=>{const l=B(B(ge,e)?.[0],a);if(!E(l)&&!r)return tt(e,s,n,a,l);const o=t=>{gt(e,s,t,B(n,t)),Tt(e,s,t,-1),W(n,t)};E(l)?o(a):D(n,o),j(n)&&(ht(e,s,-1),j(W(t,s))&&(ft(e,-1),W(ye,e),W(ve,e)))},ut=e=>{const t=B(Ve,e);if(!E(t))return rt(e,t);Vt(e,B(pe,e)),bt(e,-1),W(pe,e)},ft=(e,t)=>fe(c,e,t),ht=(e,t,s)=>fe($(I,e,N),t,s),Tt=(e,t,s,n)=>fe($($(L,e,N),t,N),s,n),gt=(e,t,s,n,a)=>$($($(X,e,N),t,N),s,(()=>[n,0]))[1]=a,bt=(e,t)=>fe(Z,e,t),Vt=(e,t,s)=>$(_,e,(()=>[t,0]))[1]=s,St=(e,t,s,n,a)=>(R($($($(ee,e,N),t,N),s,(()=>[])),n),a),vt=(e,t,s)=>(R($(se,e,(()=>[])),t),s),yt=(e,t,s)=>F(B(B(B(X,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...oe(Ot(e,t,s))])),pt=e=>F(B(_,e),(([e,t])=>[!0,e,t]),(()=>[!1,...oe(At(e))])),wt=e=>j(ee)||j(Fe[e])?0:A(e?G(ee,H):ee,((t,s)=>A(t,((t,n)=>A(t,((t,a)=>Ne(Fe[e],[s,n,a],t))))))),mt=e=>j(se)||j(xe[e])?0:A(e?G(se):se,((t,s)=>Ne(xe[e],[s],t))),Rt=(e,t,s)=>{if(!j(t))return Ne(e,s),1},Jt=e=>{const t=j(Ce[e]),s=j(Le[e])&&j(Je[e])&&t&&j(me[e]),n=j(Ee[e])&&j(Ie[e])&&j(Re[e])&&j(we[e]);if(!s||!n){const a=e?[G(c),H(I),G(L,H),G(X,H)]:[c,I,L,X];if(!s){A(a[2],((t,s)=>A(t,((t,n)=>Rt(Le[e],t,[s,n])))));const s=Q();A(a[1],((n,a)=>{Rt(Je[e],n,[a])&&!t&&(Ne(Ce[e],[a,null]),U(s,a))})),t||A(a[3],((t,n)=>{if(!O(s,n)){const s=Q();A(t,(e=>A(e,(([t,n],a)=>n!==t?U(s,a):M(e,a))))),A(s,(t=>Ne(Ce[e],[n,t])))}})),Rt(me[e],a[0])}if(!n){let t;A(a[3],((s,n)=>{let a;A(s,((s,r)=>{let l;A(s,(([s,o],i)=>{o!==s&&(Ne(Ee[e],[n,r,i],o,s,yt),t=a=l=1)})),l&&Ne(Ie[e],[n,r],yt)})),a&&Ne(Re[e],[n],yt)})),t&&Ne(we[e],void 0,yt)}}},Ct=e=>{const t=j(Oe[e]),s=j(je[e])&&j(ze[e]);if(!t||!s){const n=e?[G(Z),G(_)]:[Z,_];if(t||Rt(Oe[e],n[0]),!s){let t;A(n[1],(([s,n],a)=>{n!==s&&(Ne(je[e],[a],n,s,pt),t=1)})),t&&Ne(ze[e],void 0,pt)}}},It=(e,...t)=>(Ht((()=>e(...p(t,v)))),Ut),Lt=()=>q(ye,(e=>q(e,q))),Et=()=>P(ye),Ft=e=>P(B(ye,v(e))),xt=(e,t,s,n=0,a)=>{return p(m((l=B(ye,v(e)),o=(e,s)=>[E(t)?s:B(e,v(t)),s],r=([e],[t])=>(e<t?-1:1)*(s?-1:1),p([...l?.entries()??[]],(([e,t])=>o(t,e))).sort(r)),n,E(a)?a:n+a),(([,e])=>e));var r,l,o},zt=(e,t)=>P(B(B(ye,v(e)),v(t))),Ot=(e,t,s)=>B(B(B(ye,v(e)),v(t)),v(s)),jt=()=>q(pe),kt=()=>P(pe),At=e=>B(pe,v(e)),Mt=e=>It((()=>(e=>ue(e,We,St))(e)?Ze(e):0)),Nt=e=>It((()=>Ge(e)?at(e):0)),Pt=e=>{try{Ye(C(e))}catch{}return Ut},Bt=t=>It((()=>{if((e=ue(t,(e=>ue(e,De))))&&(Ue(t),!j(ye))){const e=Lt();Wt(),Mt(e)}})),Dt=e=>It((()=>{if(t=(e=>ue(e,De))(e)){const s=jt();Gt(),$t(),t=!0,Xe(e),Nt(s)}})),Wt=()=>It((()=>Ze({}))),$t=()=>It((()=>at({}))),qt=()=>It((()=>{Ue({}),e=!1})),Gt=()=>It((()=>{Xe({}),t=!1})),Ht=(e,t)=>{if(-1!=l){Kt();const s=e();return Qt(t),s}},Kt=()=>(-1!=l&&l++,1==l&&Ne(ke,void 0,!1,!1),Ut),Qt=e=>(l>0&&(l--,0==l&&(n=!j(X),a=!j(_),l=1,wt(1),n&&Jt(1),mt(1),a&&Ct(1),e?.(q(X,(e=>q(e,(e=>q(e,(e=>[...e]),(([e,t])=>e===t))),le)),le),q(ee,(e=>q(e,q))),q(_,(e=>[...e]),(([e,t])=>e===t)),q(se))&&(A(X,((e,t)=>A(e,((e,s)=>A(e,(([e],n)=>((e,t,s,n,a)=>E(a)?e.delCell(t,s,n,!0):e.setCell(t,s,n,a))(Ut,t,s,n,e))))))),A(_,(([e],t)=>((e,t,s)=>E(s)?e.delValue(t):e.setValue(t,s))(Ut,t,e))),n=a=!1),Ne(Ae[0],void 0,n,a),l=-1,wt(0),n&&Jt(0),mt(0),a&&Ct(0),Ne(Ae[1],void 0,n,a),l=0,y([c,I,L,X,ee,Z,_,se],k))),Ut),Ut={getTables:Lt,getTableIds:Et,getTable:e=>q(B(ye,v(e)),q),getRowIds:Ft,getSortedRowIds:xt,getRow:(e,t)=>q(B(B(ye,v(e)),v(t))),getCellIds:zt,getCell:Ot,getValues:jt,getValueIds:kt,getValue:At,hasTables:()=>!j(ye),hasTable:e=>O(ye,v(e)),hasRow:(e,t)=>O(B(ye,v(e)),v(t)),hasCell:(e,t,s)=>O(B(B(ye,v(e)),v(t)),v(s)),hasValues:()=>!j(pe),hasValue:e=>O(pe,v(e)),getTablesJson:()=>J(ye),getValuesJson:()=>J(pe),getJson:()=>J([ye,pe]),getTablesSchemaJson:()=>J(Te),getValuesSchemaJson:()=>J(be),getSchemaJson:()=>J([Te,be]),setTables:Mt,setTable:(e,t)=>It((e=>We(t,e)?_e(e,t):0),e),setRow:(e,t,s)=>It(((e,t)=>$e(e,t,s)?et(e,ot(e),t,s):0),e,t),addRow:(e,t,s=!0)=>Ht((()=>{let n;return $e(e,n,t)&&(e=v(e),et(e,ot(e),n=lt(e,s?1:0),t)),n})),setPartialRow:(e,t,s)=>It(((e,t)=>{if($e(e,t,s,1)){const n=ot(e);re(s,((s,a)=>st(e,n,t,a,s)))}}),e,t),setCell:(e,t,s,n)=>It(((e,t,s)=>F(qe(e,t,s,z(n)?n(Ot(e,t,s)):n),(n=>st(e,ot(e),t,s,n)))),e,t,s),setValues:Nt,setPartialValues:e=>It((()=>Ge(e,1)?re(e,((e,t)=>rt(t,e))):0)),setValue:(e,t)=>It((e=>F(He(e,z(t)?t(At(e)):t),(t=>rt(e,t)))),e),setTablesJson:Pt,setValuesJson:e=>{try{nt(C(e))}catch{}return Ut},setJson:e=>{try{const[t,s]=C(e);Ye(t),nt(s)}catch{Pt(e)}return Ut},setTablesSchema:Bt,setValuesSchema:Dt,setSchema:(e,t)=>It((()=>{Bt(e),Dt(t)})),delTables:Wt,delTable:e=>It((e=>O(ye,e)?it(e):0),e),delRow:(e,t)=>It(((e,t)=>F(B(ye,e),(s=>O(s,t)?ct(e,s,t):0))),e,t),delCell:(e,t,s,n)=>It(((e,t,s)=>F(B(ye,e),(a=>F(B(a,t),(r=>O(r,s)?dt(e,a,t,r,s,n):0))))),e,t,s),delValues:$t,delValue:e=>It((e=>O(pe,e)?ut(e):0),e),delTablesSchema:qt,delValuesSchema:Gt,delSchema:()=>It((()=>{qt(),Gt()})),transaction:Ht,startTransaction:Kt,finishTransaction:Qt,forEachTable:e=>A(ye,((t,s)=>e(s,(e=>A(t,((t,s)=>e(s,(e=>D(t,e))))))))),forEachRow:(e,t)=>A(B(ye,v(e)),((e,s)=>t(s,(t=>D(e,t))))),forEachCell:(e,t,s)=>D(B(B(ye,v(e)),v(t)),s),forEachValue:e=>D(pe,e),addSortedRowIdsListener:(e,t,s,n,a,r,l)=>{let o=xt(e,t,s,n,a);return Me((()=>{const l=xt(e,t,s,n,a);var i,c,d;c=o,w(i=l)===w(c)&&(d=(e,t)=>c[t]===e,i.every(d))||(o=l,r(Ut,e,t,s,n,a,o))}),Ce[l?1:0],[e,t],[Et])},addStartTransactionListener:e=>Me(e,ke),addWillFinishTransactionListener:e=>Me(e,Ae[0]),addDidFinishTransactionListener:e=>Me(e,Ae[1]),callListener:e=>(Be(e),Ut),delListener:e=>(Pe(e),Ut),getListenerStats:()=>({}),createStore:he};return re({[u]:[0,we],[f]:[0,me],[d]:[1,Re,[Et]],[h]:[1,Je,[Et]],Row:[2,Ie,[Et,Ft]],[g]:[2,Le,[Et,Ft]],[T]:[3,Ee,[Et,Ft,zt],e=>oe(Ot(...e))],InvalidCell:[3,Fe],[V]:[0,ze],[S]:[0,Oe],[b]:[1,je,[kt],e=>oe(At(e[0]))],InvalidValue:[1,xe]},(([e,t,s,n],a)=>{Ut["add"+a+"Listener"]=(...a)=>Me(a[e],t[a[e+1]?1:0],e>0?m(a,0,e):void 0,s,n)})),te(Ut)};e.createStore=he},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
