var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s="",n=t(s),l=t(!0),r=t(0),a=t(t),o="type",c="default",i="Ids",u="Table",d=u+"s",f=u+i,h="Row"+i,g="Cell",T=g+i,b="Value",V=b+"s",S=b+i,v=e=>s+e,y=(e,t)=>e.forEach(t),p=(e,t)=>e.map(t),w=e=>e.length,m=(e,t,s)=>e.slice(t,s),R=(e,...t)=>e.push(...t),J=e=>JSON.stringify(e,((e,t)=>{return L(t,Map)?(s=(e,[t,s])=>(e[t]=s,e),n={},[...t].reduce(s,n)):t;var s,n})),C=JSON.parse,I=isFinite,L=(e,t)=>e instanceof t,E=e=>null==e,F=(e,t,s)=>E(e)?s?.():t(e),x=e=>e==n||e==l,z=e=>t(e)==a,O=(e,t)=>e?.has(t)??!1,j=e=>E(e)||0==(e=>e.size)(e),k=e=>e.clear(),A=(e,t)=>e?.forEach(t),M=(e,t)=>e?.delete(t),N=e=>new Map(e),P=e=>[...e?.keys()??[]],B=(e,t)=>e?.get(t),D=(e,t)=>A(e,((e,s)=>t(s,e))),W=(e,t,s)=>E(s)?(M(e,t),e):e?.set(t,s),$=(e,t,s)=>(O(e,t)||W(e,t,s()),B(e,t)),q=(e,t,s)=>{const n={},l=t??(e=>e);return A(e,((e,t)=>F(l(e),(e=>s?.(e)?0:n[t]=e)))),n},G=(e,t)=>{const s=N(),n=t??(e=>e);return A(e,((e,t)=>s.set(t,n(e)))),s},H=e=>G(e,G),K=(e,t,s,n,l=0)=>F((s?$:B)(e,t[l],l>w(t)-2?s:N),(r=>{if(l>w(t)-2)return n?.(r)&&W(e,t[l]),r;const a=K(r,t,s,n,l+1);return j(r)&&W(e,t[l]),a})),Q=e=>new Set(Array.isArray(e)||E(e)?e:[e]),U=(e,t)=>e?.add(t),X=/^\d+$/,Y=()=>{const e=[];let t=0;return[n=>(n?e.shift():null)??s+t++,t=>{X.test(t)&&w(e)<1e3&&R(e,t)}]},Z=Object,_=Z.keys,ee=Z.isFrozen,te=Z.freeze,se=e=>L(e,Z)&&e.constructor==Z,ne=(e,t)=>!E(((e,t)=>F(e,(e=>e[t])))(e,t)),le=(e,t)=>delete e[t],re=(e,t)=>p(Z.entries(e),(([e,s])=>t(s,e))),ae=e=>{return se(e)&&(t=_(e),0==w(t));var t},oe=e=>[e,e],ce=()=>[N(),N()],ie=e=>{const s=t(e);return x(s)||s==r&&I(e)?s:void 0},ue=(e,t,s,n=W)=>(re(t,((t,n)=>s(e,n,t))),D(e,(s=>ne(t,s)?0:n(e,s))),e),de=(e,t,s)=>E(e)||!se(e)||ae(e)||ee(e)?(s?.(),!1):(re(e,((s,n)=>{t(s,n)||le(e,n)})),!ae(e)),fe=(e,t,s)=>W(e,t,B(e,t)==-s?void 0:s),he=()=>{let e,t,n,l,a=0;const i=N(),I=N(),L=N(),X=N(),Z=N(),_=N(),ee=N(),se=N(),ge=N(),Te=N(),be=N(),Ve=N(),Se=Q(),ve=N(),ye=N(),pe=N(),we=ce(),me=ce(),Re=ce(),Je=ce(),Ce=ce(),Ie=ce(),Le=ce(),Ee=ce(),Fe=ce(),xe=ce(),ze=ce(),Oe=ce(),je=ce(),ke=ce(),[Ae,Me,Ne,Pe]=(e=>{let t;const[n,l]=Y(),r=N();return[(e,l,a,o=[],c=(()=>[]))=>{t??=Qt;const i=n(1);return W(r,i,[e,l,a,o,c]),U(K(l,a??[s],Q),i),i},(e,n,...l)=>y(((e,t=[s])=>{const n=[],l=(e,s)=>s==w(t)?R(n,e):null===t[s]?A(e,(e=>l(e,s+1))):y([t[s],null],(t=>l(B(e,t),s+1)));return l(e,0),n})(e,n),(e=>A(e,(e=>B(r,e)[0](t,...n??[],...l))))),e=>F(B(r,e),(([,t,n])=>(K(t,n??[s],void 0,(t=>(M(t,e),j(t)?1:0))),W(r,e),l(e),n))),e=>F(B(r,e),(([e,,s=[],n,l])=>{const r=(...a)=>{const o=w(a);o==w(s)?e(t,...a,...l(a)):E(s[o])?y(n[o]?.(...a)??[],(e=>r(...a,e))):r(...a,s[o])};r()}))]})(),Be=e=>{if(!de(e,((e,t)=>[o,c].includes(t))))return!1;const t=e[o];return!(!x(t)&&t!=r||(ie(e[c])!=t&&le(e,c),0))},De=(t,s)=>(!e||O(ge,s)||Vt(s))&&de(t,((e,t)=>We(s,t,e)),(()=>Vt(s))),We=(e,t,s,n)=>de(n?s:He(s,e,t),((n,l)=>F($e(e,t,l,n),(e=>(s[l]=e,!0)),(()=>!1))),(()=>Vt(e,t))),$e=(t,s,n,l)=>e?F(B(B(ge,t),n),(e=>ie(l)!=e[o]?Vt(t,s,n,l,e[c]):l),(()=>Vt(t,s,n,l))):E(ie(l))?Vt(t,s,n,l):l,qe=(e,t)=>de(t?e:Ke(e),((t,s)=>F(Ge(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>St())),Ge=(e,s)=>t?F(B(be,e),(t=>ie(s)!=t[o]?St(e,s,t[c]):s),(()=>St(e,s))):E(ie(s))?St(e,s):s,He=(e,t,s)=>(F(B(Te,t),(([n,l])=>{A(n,((t,s)=>{ne(e,s)||(e[s]=t)})),A(l,(n=>{ne(e,n)||Vt(t,s,n)}))})),e),Ke=e=>(t&&(A(Ve,((t,s)=>{ne(e,s)||(e[s]=t)})),A(Se,(t=>{ne(e,t)||St(t)}))),e),Qe=e=>ue(ge,e,((e,t,s)=>{const n=N(),l=Q();ue($(ge,t,N),s,((e,t,s)=>{W(e,t,s),F(s[c],(e=>W(n,t,e)),(()=>U(l,t)))})),W(Te,t,[n,l])}),((e,t)=>{W(ge,t),W(Te,t)})),Ue=e=>ue(be,e,((e,t,s)=>{W(be,t,s),F(s[c],(e=>W(Ve,t,e)),(()=>U(Se,t)))}),((e,t)=>{W(be,t),W(Ve,t),M(Se,t)})),Xe=e=>ae(e)?Dt():At(e),Ye=e=>ue(ye,e,((e,t,s)=>Ze(t,s)),((e,t)=>ot(t))),Ze=(e,t)=>ue($(ye,e,(()=>(dt(e,1),N()))),t,((t,s,n)=>_e(e,t,s,n)),((t,s)=>ct(e,t,s))),_e=(e,t,s,n,l)=>ue($(t,s,(()=>(ft(e,s,1),N()))),n,((t,n,l)=>et(e,s,t,n,l)),((n,r)=>it(e,t,s,n,r,l))),et=(e,t,s,n,l)=>{O(s,n)||ht(e,t,n,1);const r=B(s,n);l!==r&&(gt(e,t,n,r,l),W(s,n,l))},tt=(e,t,s,n,l)=>F(B(t,s),(t=>et(e,s,t,n,l)),(()=>_e(e,t,s,He({[n]:l},e,s)))),st=e=>ae(e)?Wt():Mt(e),nt=e=>ue(pe,e,((e,t,s)=>lt(t,s)),((e,t)=>ut(t))),lt=(e,t)=>{O(pe,e)||Tt(e,1);const s=B(pe,e);t!==s&&(bt(e,s,t),W(pe,e,t))},rt=(e,t)=>{const[s]=$(ve,e,Y),n=s(t);return O(B(ye,e),n)?rt(e,t):n},at=e=>B(ye,e)??Ze(e,{}),ot=e=>Ze(e,{}),ct=(e,t,s)=>{const[,n]=$(ve,e,Y);n(s),_e(e,t,s,{},!0)},it=(e,t,s,n,l,r)=>{const a=B(B(Te,e)?.[0],l);if(!E(a)&&!r)return et(e,s,n,l,a);const o=t=>{gt(e,s,t,B(n,t)),ht(e,s,t,-1),W(n,t)};E(a)?o(l):D(n,o),j(n)&&(ft(e,s,-1),j(W(t,s))&&(dt(e,-1),W(ye,e),W(ve,e)))},ut=e=>{const t=B(Ve,e);if(!E(t))return lt(e,t);bt(e,B(pe,e)),Tt(e,-1),W(pe,e)},dt=(e,t)=>fe(i,e,t),ft=(e,t,s)=>fe($(I,e,N),t,s),ht=(e,t,s,n)=>fe($($(L,e,N),t,N),s,n),gt=(e,t,s,n,l)=>$($($(X,e,N),t,N),s,(()=>[n,0]))[1]=l,Tt=(e,t)=>fe(Z,e,t),bt=(e,t,s)=>$(_,e,(()=>[t,0]))[1]=s,Vt=(e,t,s,n,l)=>(R($($($(ee,e,N),t,N),s,(()=>[])),n),l),St=(e,t,s)=>(R($(se,e,(()=>[])),t),s),vt=(e,t,s)=>F(B(B(B(X,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...oe(zt(e,t,s))])),yt=e=>F(B(_,e),(([e,t])=>[!0,e,t]),(()=>[!1,...oe(kt(e))])),pt=e=>j(ee)||j(Fe[e])?0:A(e?G(ee,H):ee,((t,s)=>A(t,((t,n)=>A(t,((t,l)=>Me(Fe[e],[s,n,l],t))))))),wt=e=>j(se)||j(xe[e])?0:A(e?G(se):se,((t,s)=>Me(xe[e],[s],t))),mt=(e,t,s)=>{if(!j(t))return Me(e,s),1},Rt=e=>{const t=j(Ce[e]),s=j(Le[e])&&j(Je[e])&&t&&j(me[e]),n=j(Ee[e])&&j(Ie[e])&&j(Re[e])&&j(we[e]);if(!s||!n){const l=e?[G(i),H(I),G(L,H),G(X,H)]:[i,I,L,X];if(!s){A(l[2],((t,s)=>A(t,((t,n)=>mt(Le[e],t,[s,n])))));const s=Q();A(l[1],((n,l)=>{mt(Je[e],n,[l])&&!t&&(Me(Ce[e],[l,null]),U(s,l))})),t||A(l[3],((t,n)=>{if(!O(s,n)){const s=Q();A(t,(e=>A(e,(([t,n],l)=>n!==t?U(s,l):M(e,l))))),A(s,(t=>Me(Ce[e],[n,t])))}})),mt(me[e],l[0])}if(!n){let t;A(l[3],((s,n)=>{let l;A(s,((s,r)=>{let a;A(s,(([s,o],c)=>{o!==s&&(Me(Ee[e],[n,r,c],o,s,vt),t=l=a=1)})),a&&Me(Ie[e],[n,r],vt)})),l&&Me(Re[e],[n],vt)})),t&&Me(we[e],void 0,vt)}}},Jt=e=>{const t=j(Oe[e]),s=j(je[e])&&j(ze[e]);if(!t||!s){const n=e?[G(Z),G(_)]:[Z,_];if(t||mt(Oe[e],n[0]),!s){let t;A(n[1],(([s,n],l)=>{n!==s&&(Me(je[e],[l],n,s,yt),t=1)})),t&&Me(ze[e],void 0,yt)}}},Ct=(e,...t)=>(Gt((()=>e(...p(t,v)))),Qt),It=()=>q(ye,(e=>q(e,q))),Lt=()=>P(ye),Et=e=>P(B(ye,v(e))),Ft=(e,t,s,n=0,l)=>{return p(m((a=B(ye,v(e)),o=(e,s)=>[E(t)?s:B(e,v(t)),s],r=([e],[t])=>(e<t?-1:1)*(s?-1:1),p([...a?.entries()??[]],(([e,t])=>o(t,e))).sort(r)),n,E(l)?l:n+l),(([,e])=>e));var r,a,o},xt=(e,t)=>P(B(B(ye,v(e)),v(t))),zt=(e,t,s)=>B(B(B(ye,v(e)),v(t)),v(s)),Ot=()=>q(pe),jt=()=>P(pe),kt=e=>B(pe,v(e)),At=e=>Ct((()=>(e=>de(e,De,Vt))(e)?Ye(e):0)),Mt=e=>Ct((()=>qe(e)?nt(e):0)),Nt=e=>{try{Xe(C(e))}catch{}return Qt},Pt=t=>Ct((()=>{if((e=de(t,(e=>de(e,Be))))&&(Qe(t),!j(ye))){const e=It();Dt(),At(e)}})),Bt=e=>Ct((()=>{if(t=(e=>de(e,Be))(e)){const s=Ot();qt(),Wt(),t=!0,Ue(e),Mt(s)}})),Dt=()=>Ct((()=>Ye({}))),Wt=()=>Ct((()=>nt({}))),$t=()=>Ct((()=>{Qe({}),e=!1})),qt=()=>Ct((()=>{Ue({}),t=!1})),Gt=(e,t)=>{if(-1==a)return;Ht();const s=e();return Kt(t),s},Ht=()=>(a++,Qt),Kt=e=>(a>0&&(a--,0==a&&(n=!j(X),l=!j(_),a=1,pt(1),n&&Rt(1),wt(1),l&&Jt(1),a=-1,e?.(q(X,(e=>q(e,(e=>q(e,(e=>[...e]),(([e,t])=>e===t))),ae)),ae),q(ee,(e=>q(e,q))),q(_,(e=>[...e]),(([e,t])=>e===t)),q(se))&&(a=1,A(X,((e,t)=>A(e,((e,s)=>A(e,(([e],n)=>((e,t,s,n,l)=>E(l)?e.delCell(t,s,n,!0):e.setCell(t,s,n,l))(Qt,t,s,n,e))))))),A(_,(([e],t)=>((e,t,s)=>E(s)?e.delValue(t):e.setValue(t,s))(Qt,t,e))),a=-1,n=l=!1),Me(ke[0],void 0,n,l),pt(0),n&&Rt(0),wt(0),l&&Jt(0),Me(ke[1],void 0,n,l),a=0,y([i,I,L,X,ee,Z,_,se],k))),Qt),Qt={getTables:It,getTableIds:Lt,getTable:e=>q(B(ye,v(e)),q),getRowIds:Et,getSortedRowIds:Ft,getRow:(e,t)=>q(B(B(ye,v(e)),v(t))),getCellIds:xt,getCell:zt,getValues:Ot,getValueIds:jt,getValue:kt,hasTables:()=>!j(ye),hasTable:e=>O(ye,v(e)),hasRow:(e,t)=>O(B(ye,v(e)),v(t)),hasCell:(e,t,s)=>O(B(B(ye,v(e)),v(t)),v(s)),hasValues:()=>!j(pe),hasValue:e=>O(pe,v(e)),getTablesJson:()=>J(ye),getValuesJson:()=>J(pe),getJson:()=>J([ye,pe]),getTablesSchemaJson:()=>J(ge),getValuesSchemaJson:()=>J(be),getSchemaJson:()=>J([ge,be]),setTables:At,setTable:(e,t)=>Ct((e=>De(t,e)?Ze(e,t):0),e),setRow:(e,t,s)=>Ct(((e,t)=>We(e,t,s)?_e(e,at(e),t,s):0),e,t),addRow:(e,t,s=!0)=>Gt((()=>{let n;return We(e,n,t)&&(e=v(e),_e(e,at(e),n=rt(e,s?1:0),t)),n})),setPartialRow:(e,t,s)=>Ct(((e,t)=>{if(We(e,t,s,1)){const n=at(e);re(s,((s,l)=>tt(e,n,t,l,s)))}}),e,t),setCell:(e,t,s,n)=>Ct(((e,t,s)=>F($e(e,t,s,z(n)?n(zt(e,t,s)):n),(n=>tt(e,at(e),t,s,n)))),e,t,s),setValues:Mt,setPartialValues:e=>Ct((()=>qe(e,1)?re(e,((e,t)=>lt(t,e))):0)),setValue:(e,t)=>Ct((e=>F(Ge(e,z(t)?t(kt(e)):t),(t=>lt(e,t)))),e),setTablesJson:Nt,setValuesJson:e=>{try{st(C(e))}catch{}return Qt},setJson:e=>{try{const[t,s]=C(e);Xe(t),st(s)}catch{Nt(e)}return Qt},setTablesSchema:Pt,setValuesSchema:Bt,setSchema:(e,t)=>Ct((()=>{Pt(e),Bt(t)})),delTables:Dt,delTable:e=>Ct((e=>O(ye,e)?ot(e):0),e),delRow:(e,t)=>Ct(((e,t)=>F(B(ye,e),(s=>O(s,t)?ct(e,s,t):0))),e,t),delCell:(e,t,s,n)=>Ct(((e,t,s)=>F(B(ye,e),(l=>F(B(l,t),(r=>O(r,s)?it(e,l,t,r,s,n):0))))),e,t,s),delValues:Wt,delValue:e=>Ct((e=>O(pe,e)?ut(e):0),e),delTablesSchema:$t,delValuesSchema:qt,delSchema:()=>Ct((()=>{$t(),qt()})),transaction:Gt,startTransaction:Ht,finishTransaction:Kt,forEachTable:e=>A(ye,((t,s)=>e(s,(e=>A(t,((t,s)=>e(s,(e=>D(t,e))))))))),forEachRow:(e,t)=>A(B(ye,v(e)),((e,s)=>t(s,(t=>D(e,t))))),forEachCell:(e,t,s)=>D(B(B(ye,v(e)),v(t)),s),forEachValue:e=>D(pe,e),addSortedRowIdsListener:(e,t,s,n,l,r,a)=>{let o=Ft(e,t,s,n,l);return Ae((()=>{const a=Ft(e,t,s,n,l);var c,i,u;i=o,w(c=a)===w(i)&&(u=(e,t)=>i[t]===e,c.every(u))||(o=a,r(Qt,e,t,s,n,l,o))}),Ce[a?1:0],[e,t],[Lt])},addWillFinishTransactionListener:e=>Ae(e,ke[0]),addDidFinishTransactionListener:e=>Ae(e,ke[1]),callListener:e=>(Pe(e),Qt),delListener:e=>(Ne(e),Qt),getListenerStats:()=>({}),createStore:he};return re({[d]:[0,we],[f]:[0,me],[u]:[1,Re,[Lt]],[h]:[1,Je,[Lt]],Row:[2,Ie,[Lt,Et]],[T]:[2,Le,[Lt,Et]],[g]:[3,Ee,[Lt,Et,xt],e=>oe(zt(...e))],InvalidCell:[3,Fe],[V]:[0,ze],[S]:[0,Oe],[b]:[1,je,[jt],e=>oe(kt(e[0]))],InvalidValue:[1,xe]},(([e,t,s,n],l)=>{Qt["add"+l+"Listener"]=(...l)=>Ae(l[e],t[l[e+1]?1:0],e>0?m(l,0,e):void 0,s,n)})),te(Qt)};e.createStore=he},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
