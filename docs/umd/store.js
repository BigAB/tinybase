var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s=t(""),n=t(!0),r=t(0),l=t(t),o="type",a="default",d=e=>[e,e],i=(e,t)=>e.forEach(t),c=e=>e.length,f=e=>0==c(e),u=e=>e.slice(1),h=(e,t)=>e.push(t),b=e=>JSON.stringify(e,((e,t)=>{return g(t,Map)?(s=[...t],n=(e,[t,s])=>(e[t]=s,e),r={},s.reduce(n,r)):t;var s,n,r})),p=JSON.parse,T=isFinite,g=(e,t)=>e instanceof t,y=e=>null==e,w=(e,t,s)=>y(e)?s?.():t(e),L=e=>e==s||e==n,R=(e,t)=>e?.has(t)??!1,C=e=>y(e)||0==(e=>e.size)(e),S=e=>e.clear(),v=(e,t)=>e?.forEach(t),I=(e,t)=>e?.delete(t),m=e=>new Map(e),E=(e=m)=>[e(),e()],J=e=>[...e?.keys()??[]],O=(e,t)=>e?.get(t),j=(e,t)=>v(e,((e,s)=>t(s,e))),x=(e,t,s)=>y(s)?(I(e,t),e):e?.set(t,s),z=(e,t,s)=>(R(e,t)||e.set(t,s()),O(e,t)),M=(e,t,s)=>{const n={},r=t??(e=>e);return v(e,((e,t)=>w(r(e),(e=>s?.(e)?0:n[t]=e)))),n},k=(e,t)=>{const s=m(),n=t??(e=>e);return v(e,((e,t)=>s.set(t,n(e)))),s},F=e=>k(e,k),N=Object,P=N.keys,_=N.isFrozen,B=N.freeze,q=(e,t)=>!y(((e,t)=>w(e,(e=>e[t])))(e,t)),A=(e,t)=>delete e[t],D=(e,t)=>i(N.entries(e),(([e,s])=>t(s,e))),G=e=>f(P(e)),H=e=>new Set(e),K=(e,t)=>e?.add(t),Q=(e,t,s)=>c(s)<2?K(f(s)?e:z(e,s[0],H),t):Q(z(e,s[0],m),t,u(s)),U=e=>{const t=(s,n,...r)=>w(s,(s=>f(r)?e(s,n):i([r[0],null],(e=>t(O(s,e),n,...u(r))))));return t},V=(e,t,s,n=x)=>{const r=(l=J(e),o=e=>!q(t,e),l.filter(o));var l,o;return i(P(t),(n=>s(e,n,t[n]))),i(r,(t=>n(e,t))),e},W=e=>{const s=t(e);return L(s)||s==r&&T(e)?s:void 0},X=(e,t,s)=>y(e)||!(e=>g(e,N)&&e.constructor==N)(e)||G(e)||_(e)?(s?.(),!1):(D(e,((s,n)=>{t(s,n)||A(e,n)})),!G(e)),Y=(e,t,s)=>x(e,t,O(e,t)==-s?void 0:s);e.createStore=()=>{let e,s=0,n=0;const f=m(),u=m(),T=m(),g=m(),N=m(),P=m(),_=m(),Z=m(),$=E(H),ee=E(H),te=E(),se=E(),ne=E(),re=E(),le=E(),oe=E(),[ae,de,ie,ce]=(e=>{let t,s=0;const n=[],r=m();return[(l,o,a=[])=>{t??=e();const d=n.pop()??""+s++;return x(r,d,[l,o,a]),Q(o,d,a),d},(e,s=[],...n)=>U(v)(e,(e=>w(O(r,e),(([e])=>e(t,...s,...n)))),...s),e=>w(O(r,e),(([,t,s])=>(U(I)(t,e,...s),x(r,e),c(n)<1e3&&h(n,e),s)),(()=>[])),(e,s,n)=>w(O(r,e),(([e,,r])=>{const l=(...o)=>{const a=c(o);a==c(r)?e(t,...o,...n(o)):y(r[a])?i(s[a](...o),(e=>l(...o,e))):l(...o,r[a])};l()}))]})((()=>Ke)),fe=(t,s)=>(!e||R(P,s)||je(s))&&X(t,((e,t)=>ue(s,t,e)),(()=>je(s))),ue=(e,t,s,n)=>X(n?s:be(s,e,t),((n,r)=>w(he(e,t,r,n),(e=>(s[r]=e,!0)),(()=>!1))),(()=>je(e,t))),he=(t,s,n,r)=>e?w(O(O(P,t),n),(e=>W(r)!=e.type?je(t,s,n,r,e.default):r),(()=>je(t,s,n,r))):y(W(r))?je(t,s,n,r):r,be=(e,t,s)=>(w(O(_,t),(([n,r])=>{v(n,((t,s)=>{q(e,s)||(e[s]=t)})),v(r,(n=>{q(e,n)||je(t,s,n)}))})),e),pe=e=>V(P,e,((e,t,s)=>{const n=m(),r=H();V(z(P,t,m),s,((e,t,s)=>{x(e,t,s),w(s.default,(e=>x(n,t,e)),(()=>K(r,t)))})),x(_,t,[n,r])}),((e,t)=>{x(P,t),x(_,t)})),Te=e=>V(Z,e,((e,t,s)=>ge(t,s)),((e,t)=>Se(t))),ge=(e,t)=>V(z(Z,e,(()=>(me(e,1),m()))),t,((t,s,n)=>ye(e,t,s,n)),((t,s)=>ve(e,t,s))),ye=(e,t,s,n,r)=>V(z(t,s,(()=>(Ee(e,s,1),m()))),n,((t,n,r)=>we(e,s,t,n,r)),((n,l)=>Ie(e,t,s,n,l,r))),we=(e,t,s,n,r)=>{R(s,n)||Je(e,t,n,1);const l=O(s,n);r!==l&&(Oe(e,t,n,l,r),x(s,n,r))},Le=(e,t,s,n,r)=>w(O(t,s),(t=>we(e,s,t,n,r)),(()=>ye(e,t,s,be({[n]:r},e,s)))),Re=e=>{const t=""+s++;return R(e,t)?Re(e):t},Ce=e=>O(Z,e)??ge(e,{}),Se=e=>ge(e,{}),ve=(e,t,s)=>ye(e,t,s,{},!0),Ie=(e,t,s,n,r,l)=>{const o=O(O(_,e)?.[0],r);if(!y(o)&&!l)return we(e,s,n,r,o);const a=t=>{Oe(e,s,t,O(n,t)),Je(e,s,t,-1),x(n,t)};y(o)?a(r):j(n,a),C(n)&&(Ee(e,s,-1),C(x(t,s))&&(me(e,-1),x(Z,e)))},me=(e,t)=>Y(f,e,t),Ee=(e,t,s)=>Y(z(u,e,m),t,s),Je=(e,t,s,n)=>Y(z(z(T,e,m),t,m),s,n),Oe=(e,t,s,n,r)=>z(z(z(g,e,m),t,m),s,(()=>[n,0]))[1]=r,je=(e,t,s,n,r)=>(h(z(z(z(N,e,m),t,m),s,(()=>[])),n),r),xe=(e,t,s)=>w(O(O(O(g,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...d(Be(e,t,s))])),ze=e=>C(N)||C(oe[e])?0:v(e?k(N,F):N,((t,s)=>v(t,((t,n)=>v(t,((t,r)=>de(oe[e],[s,n,r],t))))))),Me=e=>{if(!C(g)){const t=C(re[e])&&C(se[e])&&C(ee[e]),s=C(le[e])&&C(ne[e])&&C(te[e])&&C($[e]);if(!t||!s){const n=e?[k(f),F(u),k(T,F),k(g,F)]:[f,u,T,g];if(t||(v(n[2],((t,s)=>v(t,((t,n)=>{C(t)||de(re[e],[s,n])})))),v(n[1],((t,s)=>{C(t)||de(se[e],[s])})),C(n[0])||de(ee[e])),!s){let t;v(n[3],((s,n)=>{let r;v(s,((s,l)=>{let o;v(s,(([s,a],d)=>{a!==s&&(de(le[e],[n,l,d],a,s,xe),t=r=o=1)})),o&&de(ne[e],[n,l],xe)})),r&&de(te[e],[n],xe)})),t&&de($[e],[],xe)}}}},ke=e=>(He(e),Ke),Fe=()=>M(Z,(e=>M(e,M))),Ne=()=>J(Z),Pe=e=>J(O(Z,e)),_e=(e,t)=>J(O(O(Z,e),t)),Be=(e,t,s)=>O(O(O(Z,e),t),s),qe=e=>ke((()=>(e=>X(e,fe,je))(e)?Te(e):0)),Ae=(e,s,n,r)=>ke((()=>w(he(e,s,n,t(r)==l?r(Be(e,s,n)):r),(t=>Le(e,Ce(e),s,n,t))))),De=()=>ke((()=>Te({}))),Ge=(e,t,s,n)=>ke((()=>w(O(Z,e),(r=>w(O(r,t),(l=>R(l,s)?Ie(e,r,t,l,s,n):0)))))),He=(e,t)=>{if(-1==n)return;n++;const s=e?.();return n--,0==n&&(n=1,ze(1),Me(1),n=-1,t?.(M(g,(e=>M(e,(e=>M(e,(e=>[...e]),(([e,t])=>e===t))),G)),G),M(N,(e=>M(e,M))))&&(n=1,v(g,((e,t)=>v(e,((e,s)=>v(e,(([e],n)=>y(e)?Ge(t,s,n,!0):Ae(t,s,n,e))))))),n=-1),ze(0),Me(0),n=0,i([g,N,f,u,T],S)),s},Ke={getTables:Fe,getTableIds:Ne,getTable:e=>M(O(Z,e),M),getRowIds:Pe,getRow:(e,t)=>M(O(O(Z,e),t)),getCellIds:_e,getCell:Be,hasTables:()=>!C(Z),hasTable:e=>R(Z,e),hasRow:(e,t)=>R(O(Z,e),t),hasCell:(e,t,s)=>R(O(O(Z,e),t),s),getJson:()=>b(Z),getSchemaJson:()=>b(P),setTables:qe,setTable:(e,t)=>ke((()=>fe(t,e)?ge(e,t):0)),setRow:(e,t,s)=>ke((()=>ue(e,t,s)?ye(e,Ce(e),t,s):0)),addRow:(e,t)=>He((()=>{let s;return ue(e,s,t)&&ye(e,Ce(e),s=Re(O(Z,e)),t),s})),setPartialRow:(e,t,s)=>ke((()=>{if(ue(e,t,s,1)){const n=Ce(e);D(s,((s,r)=>Le(e,n,t,r,s)))}})),setCell:Ae,setJson:e=>{try{"{}"===e?De():qe(p(e))}catch{}return Ke},setSchema:t=>ke((()=>{if((e=(e=>X(e,(e=>X(e,(e=>{if(!X(e,((e,t)=>[o,a].includes(t))))return!1;const t=e.type;return!(!L(t)&&t!=r||(W(e.default)!=t&&A(e,a),0))})))))(t))&&(pe(t),!C(Z))){const e=Fe();De(),qe(e)}})),delTables:De,delTable:e=>ke((()=>R(Z,e)?Se(e):0)),delRow:(e,t)=>ke((()=>w(O(Z,e),(s=>R(s,t)?ve(e,s,t):0)))),delCell:Ge,delSchema:()=>ke((()=>{pe({}),e=!1})),transaction:He,forEachTable:e=>v(Z,((t,s)=>e(s,(e=>v(t,((t,s)=>e(s,(e=>j(t,e))))))))),forEachRow:(e,t)=>v(O(Z,e),((e,s)=>t(s,(t=>j(e,t))))),forEachCell:(e,t,s)=>j(O(O(Z,e),t),s),addTablesListener:(e,t)=>ae(e,$[t?1:0]),addTableIdsListener:(e,t)=>ae(e,ee[t?1:0]),addTableListener:(e,t,s)=>ae(t,te[s?1:0],[e]),addRowIdsListener:(e,t,s)=>ae(t,se[s?1:0],[e]),addRowListener:(e,t,s,n)=>ae(s,ne[n?1:0],[e,t]),addCellIdsListener:(e,t,s,n)=>ae(s,re[n?1:0],[e,t]),addCellListener:(e,t,s,n,r)=>ae(n,le[r?1:0],[e,t,s]),addInvalidCellListener:(e,t,s,n,r)=>ae(n,oe[r?1:0],[e,t,s]),callListener:e=>(ce(e,[Ne,Pe,_e],(e=>y(e[2])?[]:d(Be(...e)))),Ke),delListener:e=>(ie(e),Ke),getListenerStats:()=>({})};return B(Ke)},Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
