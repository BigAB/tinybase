var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s="",n=t(s),l=t(!0),a=t(0),r=t(t),o="type",c="default",i="Ids",d="Table",u=d+"s",f=d+i,h="Row"+i,T="Cell",g=T+i,b="Value",V=b+"s",S=b+i,v=e=>s+e,y=(e,t)=>e.forEach(t),p=(e,t)=>e.map(t),w=e=>e.length,C=(e,t,s)=>e.slice(t,s),m=(e,...t)=>e.push(...t),R=e=>JSON.stringify(e,((e,t)=>{return L(t,Map)?(s=(e,[t,s])=>(e[t]=s,e),n={},[...t].reduce(s,n)):t;var s,n})),J=JSON.parse,I=isFinite,L=(e,t)=>e instanceof t,E=e=>null==e,F=(e,t,s)=>E(e)?s?.():t(e),x=e=>e==n||e==l,z=e=>t(e)==r,O=(e,t)=>e?.has(t)??!1,j=e=>E(e)||0==(e=>e.size)(e),k=e=>e.clear(),A=(e,t)=>e?.forEach(t),M=(e,t)=>e?.delete(t),N=e=>new Map(e),P=e=>[...e?.keys()??[]],B=(e,t)=>e?.get(t),D=(e,t)=>A(e,((e,s)=>t(s,e))),W=(e,t,s)=>E(s)?(M(e,t),e):e?.set(t,s),$=(e,t,s)=>(O(e,t)||W(e,t,s()),B(e,t)),q=(e,t,s)=>{const n={},l=t??(e=>e);return A(e,((e,t)=>F(l(e),(e=>s?.(e)?0:n[t]=e)))),n},G=(e,t)=>{const s=N(),n=t??(e=>e);return A(e,((e,t)=>s.set(t,n(e)))),s},H=e=>G(e,G),K=(e,t,s,n,l=0)=>F((s?$:B)(e,t[l],l>w(t)-2?s:N),(a=>{if(l>w(t)-2)return n?.(a)&&W(e,t[l]),a;const r=K(a,t,s,n,l+1);return j(a)&&W(e,t[l]),r})),Q=e=>new Set(Array.isArray(e)||E(e)?e:[e]),U=(e,t)=>e?.add(t),X=/^\d+$/,Y=()=>{const e=[];let t=0;return[n=>(n?e.shift():null)??s+t++,t=>{X.test(t)&&w(e)<1e3&&m(e,t)}]},Z=Object,_=Z.keys,ee=Z.isFrozen,te=Z.freeze,se=e=>L(e,Z)&&e.constructor==Z,ne=(e,t)=>!E(((e,t)=>F(e,(e=>e[t])))(e,t)),le=(e,t)=>delete e[t],ae=(e,t)=>p(Z.entries(e),(([e,s])=>t(s,e))),re=e=>{return se(e)&&(t=_(e),0==w(t));var t},oe=e=>[e,e],ce=()=>[N(),N()],ie=e=>{const s=t(e);return x(s)||s==a&&I(e)?s:void 0},de=(e,t,s,n=W)=>(ae(t,((t,n)=>s(e,n,t))),D(e,(s=>ne(t,s)?0:n(e,s))),e),ue=(e,t,s)=>E(e)||!se(e)||re(e)||ee(e)?(s?.(),!1):(ae(e,((s,n)=>{t(s,n)||le(e,n)})),!re(e)),fe=(e,t,s)=>W(e,t,B(e,t)==-s?void 0:s),he=()=>{let e,t,n,l,r=0;const i=N(),I=N(),L=N(),X=N(),Z=N(),_=N(),ee=N(),se=N(),Te=N(),ge=N(),be=N(),Ve=N(),Se=N(),ve=Q(),ye=N(),pe=N(),we=N(),Ce=N(),me=ce(),Re=ce(),Je=ce(),Ie=ce(),Le=ce(),Ee=ce(),Fe=ce(),xe=ce(),ze=ce(),Oe=ce(),je=ce(),ke=ce(),Ae=ce(),Me=ce(),Ne=N(),Pe=ce(),[Be,De,We,$e]=(e=>{let t;const[n,l]=Y(),a=N();return[(e,l,r,o=[],c=(()=>[]))=>{t??=Zt;const i=n(1);return W(a,i,[e,l,r,o,c]),U(K(l,r??[s],Q),i),i},(e,n,...l)=>y(((e,t=[s])=>{const n=[],l=(e,s)=>s==w(t)?m(n,e):null===t[s]?A(e,(e=>l(e,s+1))):y([t[s],null],(t=>l(B(e,t),s+1)));return l(e,0),n})(e,n),(e=>A(e,(e=>B(a,e)[0](t,...n??[],...l))))),e=>F(B(a,e),(([,t,n])=>(K(t,n??[s],void 0,(t=>(M(t,e),j(t)?1:0))),W(a,e),l(e),n))),e=>F(B(a,e),(([e,,s=[],n,l])=>{const a=(...r)=>{const o=w(r);o==w(s)?e(t,...r,...l(r)):E(s[o])?y(n[o]?.(...r)??[],(e=>a(...r,e))):a(...r,s[o])};a()}))]})(),qe=e=>{if(!ue(e,((e,t)=>[o,c].includes(t))))return!1;const t=e[o];return!(!x(t)&&t!=a||(ie(e[c])!=t&&le(e,c),0))},Ge=(t,s)=>(!e||O(ge,s)||pt(s))&&ue(t,((e,t)=>He(s,t,e)),(()=>pt(s))),He=(e,t,s,n)=>ue(n?s:Xe(s,e,t),((n,l)=>F(Ke(e,t,l,n),(e=>(s[l]=e,!0)),(()=>!1))),(()=>pt(e,t))),Ke=(t,s,n,l)=>e?F(B(B(ge,t),n),(e=>ie(l)!=e[o]?pt(t,s,n,l,e[c]):l),(()=>pt(t,s,n,l))):E(ie(l))?pt(t,s,n,l):l,Qe=(e,t)=>ue(t?e:Ye(e),((t,s)=>F(Ue(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>wt())),Ue=(e,s)=>t?F(B(Ve,e),(t=>ie(s)!=t[o]?wt(e,s,t[c]):s),(()=>wt(e,s))):E(ie(s))?wt(e,s):s,Xe=(e,t,s)=>(F(B(be,t),(([n,l])=>{A(n,((t,s)=>{ne(e,s)||(e[s]=t)})),A(l,(n=>{ne(e,n)||pt(t,s,n)}))})),e),Ye=e=>(t&&(A(Se,((t,s)=>{ne(e,s)||(e[s]=t)})),A(ve,(t=>{ne(e,t)||wt(t)}))),e),Ze=e=>de(ge,e,((e,t,s)=>{const n=N(),l=Q();de($(ge,t,N),s,((e,t,s)=>{W(e,t,s),F(s[c],(e=>W(n,t,e)),(()=>U(l,t)))})),W(be,t,[n,l])}),((e,t)=>{W(ge,t),W(be,t)})),_e=e=>de(Ve,e,((e,t,s)=>{W(Ve,t,s),F(s[c],(e=>W(Se,t,e)),(()=>U(ve,t)))}),((e,t)=>{W(Ve,t),W(Se,t),M(ve,t)})),et=e=>re(e)?Gt():Bt(e),tt=e=>de(we,e,((e,t,s)=>st(t,s)),((e,t)=>ut(t))),st=(e,t)=>de($(we,e,(()=>(gt(e,1),W(ye,e,Y()),W(pe,e,N()),N()))),t,((t,s,n)=>nt(e,t,s,n)),((t,s)=>ft(e,t,s))),nt=(e,t,s,n,l)=>de($(t,s,(()=>(bt(e,s,1),N()))),n,((t,n,l)=>lt(e,s,t,n,l)),((n,a)=>ht(e,t,s,n,a,l))),lt=(e,t,s,n,l)=>{O(s,n)||Vt(e,t,n,1);const a=B(s,n);l!==a&&(St(e,t,n,a,l),W(s,n,l))},at=(e,t,s,n,l)=>F(B(t,s),(t=>lt(e,s,t,n,l)),(()=>nt(e,t,s,Xe({[n]:l},e,s)))),rt=e=>re(e)?Ht():Dt(e),ot=e=>de(Ce,e,((e,t,s)=>ct(t,s)),((e,t)=>Tt(t))),ct=(e,t)=>{O(Ce,e)||vt(e,1);const s=B(Ce,e);t!==s&&(yt(e,s,t),W(Ce,e,t))},it=(e,t)=>{const[s]=B(ye,e),n=s(t);return O(B(we,e),n)?it(e,t):n},dt=e=>B(we,e)??st(e,{}),ut=e=>st(e,{}),ft=(e,t,s)=>{const[,n]=B(ye,e);n(s),nt(e,t,s,{},!0)},ht=(e,t,s,n,l,a)=>{const r=B(B(be,e)?.[0],l);if(!E(r)&&!a)return lt(e,s,n,l,r);const o=t=>{St(e,s,t,B(n,t)),Vt(e,s,t,-1),W(n,t)};E(r)?o(l):D(n,o),j(n)&&(bt(e,s,-1),j(W(t,s))&&(gt(e,-1),W(we,e),W(ye,e),W(pe,e)))},Tt=e=>{const t=B(Se,e);if(!E(t))return ct(e,t);yt(e,B(Ce,e)),vt(e,-1),W(Ce,e)},gt=(e,t)=>fe(i,e,t),bt=(e,t,s)=>fe($(L,e,N),t,s),Vt=(e,t,s,n)=>{const l=B(pe,e),a=B(l,s)??0;(0==a&&1==n||1==a&&-1==n)&&fe($(I,e,N),s,n),W(l,s,a!=-n?a+n:null),fe($($(X,e,N),t,N),s,n)},St=(e,t,s,n,l)=>$($($(Z,e,N),t,N),s,(()=>[n,0]))[1]=l,vt=(e,t)=>fe(_,e,t),yt=(e,t,s)=>$(ee,e,(()=>[t,0]))[1]=s,pt=(e,t,s,n,l)=>(m($($($(se,e,N),t,N),s,(()=>[])),n),l),wt=(e,t,s)=>(m($(Te,e,(()=>[])),t),s),Ct=(e,t,s)=>F(B(B(B(Z,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...oe(At(e,t,s))])),mt=e=>F(B(ee,e),(([e,t])=>[!0,e,t]),(()=>[!1,...oe(Pt(e))])),Rt=e=>j(se)||j(Oe[e])?0:A(e?G(se,H):se,((t,s)=>A(t,((t,n)=>A(t,((t,l)=>De(Oe[e],[s,n,l],t))))))),Jt=e=>j(Te)||j(je[e])?0:A(e?G(Te):Te,((t,s)=>De(je[e],[s],t))),It=(e,t,s)=>{if(!j(t))return De(e,s,(()=>q(t))),1},Lt=e=>{const t=j(Ee[e]),s=j(xe[e])&&j(Ie[e])&&j(Le[e])&&t&&j(Re[e]),n=j(ze[e])&&j(Fe[e])&&j(Je[e])&&j(me[e]);if(!s||!n){const l=e?[G(i),H(I),H(L),G(X,H),G(Z,H)]:[i,I,L,X,Z];if(!s){A(l[1],((t,s)=>It(Ie[e],t,[s]))),A(l[3],((t,s)=>A(t,((t,n)=>It(xe[e],t,[s,n])))));const s=Q();A(l[2],((n,l)=>{It(Le[e],n,[l])&&!t&&(De(Ee[e],[l,null]),U(s,l))})),t||A(l[4],((t,n)=>{if(!O(s,n)){const s=Q();A(t,(e=>A(e,(([t,n],l)=>n!==t?U(s,l):M(e,l))))),A(s,(t=>De(Ee[e],[n,t])))}})),It(Re[e],l[0])}if(!n){let t;A(l[4],((s,n)=>{let l;A(s,((s,a)=>{let r;A(s,(([s,o],c)=>{o!==s&&(De(ze[e],[n,a,c],o,s,Ct),t=l=r=1)})),r&&De(Fe[e],[n,a],Ct)})),l&&De(Je[e],[n],Ct)})),t&&De(me[e],void 0,Ct)}}},Et=e=>{const t=j(Ae[e]),s=j(Me[e])&&j(ke[e]);if(!t||!s){const n=e?[G(_),G(ee)]:[_,ee];if(t||It(Ae[e],n[0]),!s){let t;A(n[1],(([s,n],l)=>{n!==s&&(De(Me[e],[l],n,s,mt),t=1)})),t&&De(ke[e],void 0,mt)}}},Ft=(e,...t)=>(Ut((()=>e(...p(t,v)))),Zt),xt=()=>q(we,(e=>q(e,q))),zt=()=>P(we),Ot=e=>P(B(we,v(e))),jt=(e,t,s,n=0,l)=>{return p(C((r=B(we,v(e)),o=(e,s)=>[E(t)?s:B(e,v(t)),s],a=([e],[t])=>(e<t?-1:1)*(s?-1:1),p([...r?.entries()??[]],(([e,t])=>o(t,e))).sort(a)),n,E(l)?l:n+l),(([,e])=>e));var a,r,o},kt=(e,t)=>P(B(B(we,v(e)),v(t))),At=(e,t,s)=>B(B(B(we,v(e)),v(t)),v(s)),Mt=()=>q(Ce),Nt=()=>P(Ce),Pt=e=>B(Ce,v(e)),Bt=e=>Ft((()=>(e=>ue(e,Ge,pt))(e)?tt(e):0)),Dt=e=>Ft((()=>Qe(e)?ot(e):0)),Wt=e=>{try{et(J(e))}catch{}return Zt},$t=t=>Ft((()=>{if((e=ue(t,(e=>ue(e,qe))))&&(Ze(t),!j(we))){const e=xt();Gt(),Bt(e)}})),qt=e=>Ft((()=>{if(t=(e=>ue(e,qe))(e)){const s=Mt();Qt(),Ht(),t=!0,_e(e),Dt(s)}})),Gt=()=>Ft((()=>tt({}))),Ht=()=>Ft((()=>ot({}))),Kt=()=>Ft((()=>{Ze({}),e=!1})),Qt=()=>Ft((()=>{_e({}),t=!1})),Ut=(e,t)=>{if(-1!=r){Xt();const s=e();return Yt(t),s}},Xt=()=>(-1!=r&&r++,1==r&&De(Ne,void 0,!1,!1),Zt),Yt=e=>(r>0&&(r--,0==r&&(n=!j(Z),l=!j(ee),r=1,Rt(1),n&&Lt(1),Jt(1),l&&Et(1),e?.(q(Z,(e=>q(e,(e=>q(e,(e=>[...e]),(([e,t])=>e===t))),re)),re),q(se,(e=>q(e,q))),q(ee,(e=>[...e]),(([e,t])=>e===t)),q(Te))&&(A(Z,((e,t)=>A(e,((e,s)=>A(e,(([e],n)=>((e,t,s,n,l)=>E(l)?e.delCell(t,s,n,!0):e.setCell(t,s,n,l))(Zt,t,s,n,e))))))),A(ee,(([e],t)=>((e,t,s)=>E(s)?e.delValue(t):e.setValue(t,s))(Zt,t,e))),n=l=!1),De(Pe[0],void 0,n,l),r=-1,Rt(0),n&&Lt(0),Jt(0),l&&Et(0),De(Pe[1],void 0,n,l),r=0,y([i,I,L,X,Z,se,_,ee,Te],k))),Zt),Zt={getTables:xt,getTableIds:zt,getTable:e=>q(B(we,v(e)),q),getTableCellIds:e=>P(B(pe,v(e))),getRowIds:Ot,getSortedRowIds:jt,getRow:(e,t)=>q(B(B(we,v(e)),v(t))),getCellIds:kt,getCell:At,getValues:Mt,getValueIds:Nt,getValue:Pt,hasTables:()=>!j(we),hasTable:e=>O(we,v(e)),hasTableCell:(e,t)=>O(B(pe,v(e)),v(t)),hasRow:(e,t)=>O(B(we,v(e)),v(t)),hasCell:(e,t,s)=>O(B(B(we,v(e)),v(t)),v(s)),hasValues:()=>!j(Ce),hasValue:e=>O(Ce,v(e)),getTablesJson:()=>R(we),getValuesJson:()=>R(Ce),getJson:()=>R([we,Ce]),getTablesSchemaJson:()=>R(ge),getValuesSchemaJson:()=>R(Ve),getSchemaJson:()=>R([ge,Ve]),setTables:Bt,setTable:(e,t)=>Ft((e=>Ge(t,e)?st(e,t):0),e),setRow:(e,t,s)=>Ft(((e,t)=>He(e,t,s)?nt(e,dt(e),t,s):0),e,t),addRow:(e,t,s=!0)=>Ut((()=>{let n;return He(e,n,t)&&(e=v(e),nt(e,dt(e),n=it(e,s?1:0),t)),n})),setPartialRow:(e,t,s)=>Ft(((e,t)=>{if(He(e,t,s,1)){const n=dt(e);ae(s,((s,l)=>at(e,n,t,l,s)))}}),e,t),setCell:(e,t,s,n)=>Ft(((e,t,s)=>F(Ke(e,t,s,z(n)?n(At(e,t,s)):n),(n=>at(e,dt(e),t,s,n)))),e,t,s),setValues:Dt,setPartialValues:e=>Ft((()=>Qe(e,1)?ae(e,((e,t)=>ct(t,e))):0)),setValue:(e,t)=>Ft((e=>F(Ue(e,z(t)?t(Pt(e)):t),(t=>ct(e,t)))),e),setTablesJson:Wt,setValuesJson:e=>{try{rt(J(e))}catch{}return Zt},setJson:e=>{try{const[t,s]=J(e);et(t),rt(s)}catch{Wt(e)}return Zt},setTablesSchema:$t,setValuesSchema:qt,setSchema:(e,t)=>Ft((()=>{$t(e),qt(t)})),delTables:Gt,delTable:e=>Ft((e=>O(we,e)?ut(e):0),e),delRow:(e,t)=>Ft(((e,t)=>F(B(we,e),(s=>O(s,t)?ft(e,s,t):0))),e,t),delCell:(e,t,s,n)=>Ft(((e,t,s)=>F(B(we,e),(l=>F(B(l,t),(a=>O(a,s)?ht(e,l,t,a,s,n):0))))),e,t,s),delValues:Ht,delValue:e=>Ft((e=>O(Ce,e)?Tt(e):0),e),delTablesSchema:Kt,delValuesSchema:Qt,delSchema:()=>Ft((()=>{Kt(),Qt()})),transaction:Ut,startTransaction:Xt,finishTransaction:Yt,forEachTable:e=>A(we,((t,s)=>e(s,(e=>A(t,((t,s)=>e(s,(e=>D(t,e))))))))),forEachTableCell:(e,t)=>D(B(pe,v(e)),t),forEachRow:(e,t)=>A(B(we,v(e)),((e,s)=>t(s,(t=>D(e,t))))),forEachCell:(e,t,s)=>D(B(B(we,v(e)),v(t)),s),forEachValue:e=>D(Ce,e),addSortedRowIdsListener:(e,t,s,n,l,a,r)=>{let o=jt(e,t,s,n,l);return Be((()=>{const r=jt(e,t,s,n,l);var c,i,d;i=o,w(c=r)===w(i)&&(d=(e,t)=>i[t]===e,c.every(d))||(o=r,a(Zt,e,t,s,n,l,o))}),Ee[r?1:0],[e,t],[zt])},addStartTransactionListener:e=>Be(e,Ne),addWillFinishTransactionListener:e=>Be(e,Pe[0]),addDidFinishTransactionListener:e=>Be(e,Pe[1]),callListener:e=>($e(e),Zt),delListener:e=>(We(e),Zt),getListenerStats:()=>({}),createStore:he};return ae({[u]:[0,me],[f]:[0,Re],[d]:[1,Je,[zt]],[d+g]:[1,Ie,[zt]],[h]:[1,Le,[zt]],Row:[2,Fe,[zt,Ot]],[g]:[2,xe,[zt,Ot]],[T]:[3,ze,[zt,Ot,kt],e=>oe(At(...e))],InvalidCell:[3,Oe],[V]:[0,ke],[S]:[0,Ae],[b]:[1,Me,[Nt],e=>oe(Pt(e[0]))],InvalidValue:[1,je]},(([e,t,s,n],l)=>{Zt["add"+l+"Listener"]=(...l)=>Be(l[e],t[l[e+1]?1:0],e>0?C(l,0,e):void 0,s,n)})),te(Zt)};e.createStore=he},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
