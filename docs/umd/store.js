var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s="",n=t(s),r=t(!0),l=t(0),a=t(t),o="type",c="default",i="Ids",u="Table",d=u+"s",f=u+i,h="Row"+i,g="Cell",T=g+i,b="Value",V=b+"s",S=b+i,v=e=>s+e,y=(e,t)=>e.forEach(t),p=(e,t)=>e.map(t),w=e=>e.length,m=(e,t,s)=>e.slice(t,s),C=(e,...t)=>e.push(...t),R=e=>JSON.stringify(e,((e,t)=>{return L(t,Map)?(s=(e,[t,s])=>(e[t]=s,e),n={},[...t].reduce(s,n)):t;var s,n})),J=JSON.parse,I=isFinite,L=(e,t)=>e instanceof t,E=e=>null==e,F=(e,t,s)=>E(e)?s?.():t(e),x=e=>e==n||e==r,z=e=>t(e)==a,O=(e,t)=>e?.has(t)??!1,j=e=>E(e)||0==(e=>e.size)(e),k=e=>e.clear(),A=(e,t)=>e?.forEach(t),M=(e,t)=>e?.delete(t),N=e=>new Map(e),P=e=>[...e?.keys()??[]],B=(e,t)=>e?.get(t),D=(e,t)=>A(e,((e,s)=>t(s,e))),W=(e,t,s)=>E(s)?(M(e,t),e):e?.set(t,s),$=(e,t,s)=>(O(e,t)||W(e,t,s()),B(e,t)),q=(e,t,s)=>{const n={},r=t??(e=>e);return A(e,((e,t)=>F(r(e),(e=>s?.(e)?0:n[t]=e)))),n},G=(e,t)=>{const s=N(),n=t??(e=>e);return A(e,((e,t)=>s.set(t,n(e)))),s},H=e=>G(e,G),K=(e,t,s,n,r=0)=>F((s?$:B)(e,t[r],r>w(t)-2?s:N),(l=>{if(r>w(t)-2)return n?.(l)&&W(e,t[r]),l;const a=K(l,t,s,n,r+1);return j(l)&&W(e,t[r]),a})),Q=e=>new Set(Array.isArray(e)||E(e)?e:[e]),U=(e,t)=>e?.add(t),X=/^\d+$/,Y=()=>{const e=[];let t=0;return[n=>(n?e.shift():null)??s+t++,t=>{X.test(t)&&w(e)<1e3&&C(e,t)}]},Z=Object,_=Z.keys,ee=Z.isFrozen,te=Z.freeze,se=e=>L(e,Z)&&e.constructor==Z,ne=(e,t)=>!E(((e,t)=>F(e,(e=>e[t])))(e,t)),re=(e,t)=>delete e[t],le=(e,t)=>p(Z.entries(e),(([e,s])=>t(s,e))),ae=e=>{return se(e)&&(t=_(e),0==w(t));var t},oe=e=>[e,e],ce=()=>[N(),N()],ie=e=>{const s=t(e);return x(s)||s==l&&I(e)?s:void 0},ue=(e,t,s,n=W)=>(le(t,((t,n)=>s(e,n,t))),D(e,(s=>ne(t,s)?0:n(e,s))),e),de=(e,t,s)=>E(e)||!se(e)||ae(e)||ee(e)?(s?.(),!1):(le(e,((s,n)=>{t(s,n)||re(e,n)})),!ae(e)),fe=(e,t,s)=>W(e,t,B(e,t)==-s?void 0:s),he=()=>{let e,t,n,r,a=0;const i=N(),I=N(),L=N(),X=N(),Z=N(),_=N(),ee=N(),se=N(),ge=N(),Te=N(),be=N(),Ve=N(),Se=Q(),ve=N(),ye=N(),pe=N(),we=ce(),me=ce(),Ce=ce(),Re=ce(),Je=ce(),Ie=ce(),Le=ce(),Ee=ce(),Fe=ce(),xe=ce(),ze=ce(),Oe=ce(),je=ce(),ke=ce(),[Ae,Me,Ne,Pe]=(e=>{let t;const[n,r]=Y(),l=N();return[(e,r,a,o=[],c=(()=>[]))=>{t??=Qt;const i=n(1);return W(l,i,[e,r,a,o,c]),U(K(r,a??[s],Q),i),i},(e,n,...r)=>y(((e,t=[s])=>{const n=[],r=(e,s)=>s==w(t)?C(n,e):null===t[s]?A(e,(e=>r(e,s+1))):y([t[s],null],(t=>r(B(e,t),s+1)));return r(e,0),n})(e,n),(e=>A(e,(e=>B(l,e)[0](t,...n??[],...r))))),e=>F(B(l,e),(([,t,n])=>(K(t,n??[s],void 0,(t=>(M(t,e),j(t)?1:0))),W(l,e),r(e),n))),e=>F(B(l,e),(([e,,s=[],n,r])=>{const l=(...a)=>{const o=w(a);o==w(s)?e(t,...a,...r(a)):E(s[o])?y(n[o]?.(...a)??[],(e=>l(...a,e))):l(...a,s[o])};l()}))]})(),Be=e=>{if(!de(e,((e,t)=>[o,c].includes(t))))return!1;const t=e[o];return!(!x(t)&&t!=l||(ie(e[c])!=t&&re(e,c),0))},De=(t,s)=>(!e||O(ge,s)||Vt(s))&&de(t,((e,t)=>We(s,t,e)),(()=>Vt(s))),We=(e,t,s,n)=>de(n?s:He(s,e,t),((n,r)=>F($e(e,t,r,n),(e=>(s[r]=e,!0)),(()=>!1))),(()=>Vt(e,t))),$e=(t,s,n,r)=>e?F(B(B(ge,t),n),(e=>ie(r)!=e[o]?Vt(t,s,n,r,e[c]):r),(()=>Vt(t,s,n,r))):E(ie(r))?Vt(t,s,n,r):r,qe=(e,t)=>de(t?e:Ke(e),((t,s)=>F(Ge(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>St())),Ge=(e,s)=>t?F(B(be,e),(t=>ie(s)!=t[o]?St(e,s,t[c]):s),(()=>St(e,s))):E(ie(s))?St(e,s):s,He=(e,t,s)=>(F(B(Te,t),(([n,r])=>{A(n,((t,s)=>{ne(e,s)||(e[s]=t)})),A(r,(n=>{ne(e,n)||Vt(t,s,n)}))})),e),Ke=e=>(t&&(A(Ve,((t,s)=>{ne(e,s)||(e[s]=t)})),A(Se,(t=>{ne(e,t)||St(t)}))),e),Qe=e=>ue(ge,e,((e,t,s)=>{const n=N(),r=Q();ue($(ge,t,N),s,((e,t,s)=>{W(e,t,s),F(s[c],(e=>W(n,t,e)),(()=>U(r,t)))})),W(Te,t,[n,r])}),((e,t)=>{W(ge,t),W(Te,t)})),Ue=e=>ue(be,e,((e,t,s)=>{W(be,t,s),F(s[c],(e=>W(Ve,t,e)),(()=>U(Se,t)))}),((e,t)=>{W(be,t),W(Ve,t),M(Se,t)})),Xe=e=>ae(e)?Dt():At(e),Ye=e=>ue(ye,e,((e,t,s)=>Ze(t,s)),((e,t)=>ot(t))),Ze=(e,t)=>ue($(ye,e,(()=>(dt(e,1),N()))),t,((t,s,n)=>_e(e,t,s,n)),((t,s)=>ct(e,t,s))),_e=(e,t,s,n,r)=>ue($(t,s,(()=>(ft(e,s,1),N()))),n,((t,n,r)=>et(e,s,t,n,r)),((n,l)=>it(e,t,s,n,l,r))),et=(e,t,s,n,r)=>{O(s,n)||ht(e,t,n,1);const l=B(s,n);r!==l&&(gt(e,t,n,l,r),W(s,n,r))},tt=(e,t,s,n,r)=>F(B(t,s),(t=>et(e,s,t,n,r)),(()=>_e(e,t,s,He({[n]:r},e,s)))),st=e=>ae(e)?Wt():Mt(e),nt=e=>ue(pe,e,((e,t,s)=>rt(t,s)),((e,t)=>ut(t))),rt=(e,t)=>{O(pe,e)||Tt(e,1);const s=B(pe,e);t!==s&&(bt(e,s,t),W(pe,e,t))},lt=(e,t)=>{const[s]=$(ve,e,Y),n=s(t);return O(B(ye,e),n)?lt(e,t):n},at=e=>B(ye,e)??Ze(e,{}),ot=e=>Ze(e,{}),ct=(e,t,s)=>{const[,n]=$(ve,e,Y);n(s),_e(e,t,s,{},!0)},it=(e,t,s,n,r,l)=>{const a=B(B(Te,e)?.[0],r);if(!E(a)&&!l)return et(e,s,n,r,a);const o=t=>{gt(e,s,t,B(n,t)),ht(e,s,t,-1),W(n,t)};E(a)?o(r):D(n,o),j(n)&&(ft(e,s,-1),j(W(t,s))&&(dt(e,-1),W(ye,e),W(ve,e)))},ut=e=>{const t=B(Ve,e);if(!E(t))return rt(e,t);bt(e,B(pe,e)),Tt(e,-1),W(pe,e)},dt=(e,t)=>fe(i,e,t),ft=(e,t,s)=>fe($(I,e,N),t,s),ht=(e,t,s,n)=>fe($($(L,e,N),t,N),s,n),gt=(e,t,s,n,r)=>$($($(X,e,N),t,N),s,(()=>[n,0]))[1]=r,Tt=(e,t)=>fe(Z,e,t),bt=(e,t,s)=>$(_,e,(()=>[t,0]))[1]=s,Vt=(e,t,s,n,r)=>(C($($($(ee,e,N),t,N),s,(()=>[])),n),r),St=(e,t,s)=>(C($(se,e,(()=>[])),t),s),vt=(e,t,s)=>F(B(B(B(X,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...oe(zt(e,t,s))])),yt=e=>F(B(_,e),(([e,t])=>[!0,e,t]),(()=>[!1,...oe(kt(e))])),pt=e=>j(ee)||j(Fe[e])?0:A(e?G(ee,H):ee,((t,s)=>A(t,((t,n)=>A(t,((t,r)=>Me(Fe[e],[s,n,r],t))))))),wt=e=>j(se)||j(xe[e])?0:A(e?G(se):se,((t,s)=>Me(xe[e],[s],t))),mt=(e,t,s)=>{if(!j(t))return Me(e,s),1},Ct=e=>{const t=j(Je[e]),s=j(Le[e])&&j(Re[e])&&t&&j(me[e]),n=j(Ee[e])&&j(Ie[e])&&j(Ce[e])&&j(we[e]);if(!s||!n){const r=e?[G(i),H(I),G(L,H),G(X,H)]:[i,I,L,X];if(!s){A(r[2],((t,s)=>A(t,((t,n)=>mt(Le[e],t,[s,n])))));const s=Q();A(r[1],((n,r)=>{mt(Re[e],n,[r])&&!t&&(Me(Je[e],[r,null]),U(s,r))})),t||A(r[3],((t,n)=>{if(!O(s,n)){const s=Q();A(t,(e=>A(e,(([t,n],r)=>n!==t?U(s,r):M(e,r))))),A(s,(t=>Me(Je[e],[n,t])))}})),mt(me[e],r[0])}if(!n){let t;A(r[3],((s,n)=>{let r;A(s,((s,l)=>{let a;A(s,(([s,o],c)=>{o!==s&&(Me(Ee[e],[n,l,c],o,s,vt),t=r=a=1)})),a&&Me(Ie[e],[n,l],vt)})),r&&Me(Ce[e],[n],vt)})),t&&Me(we[e],void 0,vt)}}},Rt=e=>{const t=j(Oe[e]),s=j(je[e])&&j(ze[e]);if(!t||!s){const n=e?[G(Z),G(_)]:[Z,_];if(t||mt(Oe[e],n[0]),!s){let t;A(n[1],(([s,n],r)=>{n!==s&&(Me(je[e],[r],n,s,yt),t=1)})),t&&Me(ze[e],void 0,yt)}}},Jt=(e,...t)=>(Gt((()=>e(...p(t,v)))),Qt),It=()=>q(ye,(e=>q(e,q))),Lt=()=>P(ye),Et=e=>P(B(ye,v(e))),Ft=(e,t,s,n=0,r)=>{return p(m((a=B(ye,v(e)),o=(e,s)=>[E(t)?s:B(e,v(t)),s],l=([e],[t])=>(e<t?-1:1)*(s?-1:1),p([...a?.entries()??[]],(([e,t])=>o(t,e))).sort(l)),n,E(r)?r:n+r),(([,e])=>e));var l,a,o},xt=(e,t)=>P(B(B(ye,v(e)),v(t))),zt=(e,t,s)=>B(B(B(ye,v(e)),v(t)),v(s)),Ot=()=>q(pe),jt=()=>P(pe),kt=e=>B(pe,v(e)),At=e=>Jt((()=>(e=>de(e,De,Vt))(e)?Ye(e):0)),Mt=e=>Jt((()=>qe(e)?nt(e):0)),Nt=e=>{try{Xe(J(e))}catch{}return Qt},Pt=t=>Jt((()=>{if((e=de(t,(e=>de(e,Be))))&&(Qe(t),!j(ye))){const e=It();Dt(),At(e)}})),Bt=e=>Jt((()=>{if(t=(e=>de(e,Be))(e)){const s=Ot();qt(),Wt(),t=!0,Ue(e),Mt(s)}})),Dt=()=>Jt((()=>Ye({}))),Wt=()=>Jt((()=>nt({}))),$t=()=>Jt((()=>{Qe({}),e=!1})),qt=()=>Jt((()=>{Ue({}),t=!1})),Gt=(e,t)=>{if(-1==a)return;Ht();const s=e();return Kt(t),s},Ht=()=>(a++,Qt),Kt=e=>{if(a>0&&(a--,0==a)){n=!j(X),r=!j(_),a=1,pt(1),n&&Ct(1),wt(1),r&&Rt(1),a=-1;let t=!e&&j(ke[0])&&j(ke[1])?[{},{},{},{}]:[q(X,(e=>q(e,(e=>q(e,(e=>[...e]),(([e,t])=>e===t))),ae)),ae),q(ee,(e=>q(e,q))),q(_,(e=>[...e]),(([e,t])=>e===t)),q(se)];e?.(...t)&&(a=1,A(X,((e,t)=>A(e,((e,s)=>A(e,(([e],n)=>((e,t,s,n,r)=>E(r)?e.delCell(t,s,n,!0):e.setCell(t,s,n,r))(Qt,t,s,n,e))))))),A(_,(([e],t)=>((e,t,s)=>E(s)?e.delValue(t):e.setValue(t,s))(Qt,t,e))),a=-1,n=r=!1,t=[{},{},{},{}]),Me(ke[0],void 0,n,r,...t),pt(0),n&&Ct(0),wt(0),r&&Rt(0),Me(ke[1],void 0,n,r,...t),a=0,y([i,I,L,X,ee,Z,_,se],k)}return Qt},Qt={getContent:()=>[It(),Ot()],getTables:It,getTableIds:Lt,getTable:e=>q(B(ye,v(e)),q),getRowIds:Et,getSortedRowIds:Ft,getRow:(e,t)=>q(B(B(ye,v(e)),v(t))),getCellIds:xt,getCell:zt,getValues:Ot,getValueIds:jt,getValue:kt,hasTables:()=>!j(ye),hasTable:e=>O(ye,v(e)),hasRow:(e,t)=>O(B(ye,v(e)),v(t)),hasCell:(e,t,s)=>O(B(B(ye,v(e)),v(t)),v(s)),hasValues:()=>!j(pe),hasValue:e=>O(pe,v(e)),getTablesJson:()=>R(ye),getValuesJson:()=>R(pe),getJson:()=>R([ye,pe]),getTablesSchemaJson:()=>R(ge),getValuesSchemaJson:()=>R(be),getSchemaJson:()=>R([ge,be]),setContent:([e,t])=>Jt((()=>{At(e),Mt(t)})),setTables:At,setTable:(e,t)=>Jt((e=>De(t,e)?Ze(e,t):0),e),setRow:(e,t,s)=>Jt(((e,t)=>We(e,t,s)?_e(e,at(e),t,s):0),e,t),addRow:(e,t,s=!0)=>Gt((()=>{let n;return We(e,n,t)&&(e=v(e),_e(e,at(e),n=lt(e,s?1:0),t)),n})),setPartialRow:(e,t,s)=>Jt(((e,t)=>{if(We(e,t,s,1)){const n=at(e);le(s,((s,r)=>tt(e,n,t,r,s)))}}),e,t),setCell:(e,t,s,n)=>Jt(((e,t,s)=>F($e(e,t,s,z(n)?n(zt(e,t,s)):n),(n=>tt(e,at(e),t,s,n)))),e,t,s),setValues:Mt,setPartialValues:e=>Jt((()=>qe(e,1)?le(e,((e,t)=>rt(t,e))):0)),setValue:(e,t)=>Jt((e=>F(Ge(e,z(t)?t(kt(e)):t),(t=>rt(e,t)))),e),setTablesJson:Nt,setValuesJson:e=>{try{st(J(e))}catch{}return Qt},setJson:e=>{try{const[t,s]=J(e);Xe(t),st(s)}catch{Nt(e)}return Qt},setTablesSchema:Pt,setValuesSchema:Bt,setSchema:(e,t)=>Jt((()=>{Pt(e),Bt(t)})),delTables:Dt,delTable:e=>Jt((e=>O(ye,e)?ot(e):0),e),delRow:(e,t)=>Jt(((e,t)=>F(B(ye,e),(s=>O(s,t)?ct(e,s,t):0))),e,t),delCell:(e,t,s,n)=>Jt(((e,t,s)=>F(B(ye,e),(r=>F(B(r,t),(l=>O(l,s)?it(e,r,t,l,s,n):0))))),e,t,s),delValues:Wt,delValue:e=>Jt((e=>O(pe,e)?ut(e):0),e),delTablesSchema:$t,delValuesSchema:qt,delSchema:()=>Jt((()=>{$t(),qt()})),transaction:Gt,startTransaction:Ht,finishTransaction:Kt,forEachTable:e=>A(ye,((t,s)=>e(s,(e=>A(t,((t,s)=>e(s,(e=>D(t,e))))))))),forEachRow:(e,t)=>A(B(ye,v(e)),((e,s)=>t(s,(t=>D(e,t))))),forEachCell:(e,t,s)=>D(B(B(ye,v(e)),v(t)),s),forEachValue:e=>D(pe,e),addSortedRowIdsListener:(e,t,s,n,r,l,a)=>{let o=Ft(e,t,s,n,r);return Ae((()=>{const a=Ft(e,t,s,n,r);var c,i,u;i=o,w(c=a)===w(i)&&(u=(e,t)=>i[t]===e,c.every(u))||(o=a,l(Qt,e,t,s,n,r,o))}),Je[a?1:0],[e,t],[Lt])},addWillFinishTransactionListener:e=>Ae(e,ke[0]),addDidFinishTransactionListener:e=>Ae(e,ke[1]),callListener:e=>(Pe(e),Qt),delListener:e=>(Ne(e),Qt),getListenerStats:()=>({}),createStore:he};return le({[d]:[0,we],[f]:[0,me],[u]:[1,Ce,[Lt]],[h]:[1,Re,[Lt]],Row:[2,Ie,[Lt,Et]],[T]:[2,Le,[Lt,Et]],[g]:[3,Ee,[Lt,Et,xt],e=>oe(zt(...e))],InvalidCell:[3,Fe],[V]:[0,ze],[S]:[0,Oe],[b]:[1,je,[jt],e=>oe(kt(e[0]))],InvalidValue:[1,xe]},(([e,t,s,n],r)=>{Qt["add"+r+"Listener"]=(...r)=>Ae(r[e],t[r[e+1]?1:0],e>0?m(r,0,e):void 0,s,n)})),te(Qt)};e.createStore=he},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
