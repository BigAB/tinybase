var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s=t(""),n=t(!0),r=t(0),a=t(t),l="type",o="default",i=e=>[e,e],d=(e,t)=>e.forEach(t),c=e=>e.length,u=e=>0==c(e),f=e=>e.slice(1),h=(e,t)=>e.push(t),T=e=>JSON.stringify(e,((e,t)=>{return g(t,Map)?(s=[...t],n=(e,[t,s])=>(e[t]=s,e),r={},s.reduce(n,r)):t;var s,n,r})),p=JSON.parse,b=isFinite,g=(e,t)=>e instanceof t,y=e=>null==e,L=(e,t,s)=>y(e)?s?.():t(e),w=e=>e==s||e==n,R=(e,t)=>e?.has(t)??!1,C=e=>y(e)||0==(e=>e.size)(e),S=e=>e.clear(),v=(e,t)=>e?.forEach(t),I=(e,t)=>e?.delete(t),m=e=>new Map(e),E=(e=m)=>[e(),e()],J=e=>[...e?.keys()??[]],F=(e,t)=>e?.get(t),O=(e,t)=>v(e,((e,s)=>t(s,e))),j=(e,t,s)=>y(s)?(I(e,t),e):e?.set(t,s),x=(e,t,s)=>(R(e,t)||j(e,t,s()),F(e,t)),z=(e,t,s)=>{const n={},r=t??(e=>e);return v(e,((e,t)=>L(r(e),(e=>s?.(e)?0:n[t]=e)))),n},M=(e,t)=>{const s=m(),n=t??(e=>e);return v(e,((e,t)=>s.set(t,n(e)))),s},k=e=>M(e,M),N=Object,P=N.keys,_=N.isFrozen,B=N.freeze,D=(e,t)=>!y(((e,t)=>L(e,(e=>e[t])))(e,t)),W=(e,t)=>delete e[t],q=(e,t)=>d(N.entries(e),(([e,s])=>t(s,e))),A=e=>u(P(e)),G=e=>new Set(e),H=(e,t)=>e?.add(t),K=(e,t,s)=>c(s)<2?H(u(s)?e:x(e,s[0],G),t):K(x(e,s[0],m),t,f(s)),Q=e=>{const t=(s,n,...r)=>L(s,(s=>u(r)?e(s,n):d([r[0],null],(e=>t(F(s,e),n,...f(r))))));return t},U=e=>""+e,V=(e,t,s,n=j)=>{const r=(a=J(e),l=e=>!D(t,e),a.filter(l));var a,l;return d(P(t),(n=>s(e,n,t[n]))),d(r,(t=>n(e,t))),e},X=e=>{const s=t(e);return w(s)||s==r&&b(e)?s:void 0},Y=(e,t,s)=>y(e)||!(e=>g(e,N)&&e.constructor==N)(e)||A(e)||_(e)?(s?.(),!1):(q(e,((s,n)=>{t(s,n)||W(e,n)})),!A(e)),Z=(e,t,s)=>j(e,t,F(e,t)==-s?void 0:s);e.createStore=()=>{let e,s,n=0,u=0;const f=m(),b=m(),g=m(),N=m(),P=m(),_=m(),$=m(),ee=m(),te=E(G),se=E(G),ne=E(),re=E(),ae=E(),le=E(),oe=E(),ie=E(),de=E(G),[ce,ue,fe,he]=(e=>{let t,s=0;const n=[],r=m();return[(a,l,o=[])=>{t??=e();const i=n.pop()??""+s++;return j(r,i,[a,l,o]),K(l,i,o),i},(e,s=[],...n)=>Q(v)(e,(e=>L(F(r,e),(([e])=>e(t,...s,...n)))),...s),e=>L(F(r,e),(([,t,s])=>(Q(I)(t,e,...s),j(r,e),c(n)<1e3&&h(n,e),s)),(()=>[])),(e,s,n)=>L(F(r,e),(([e,,r])=>{const a=(...l)=>{const o=c(l);o==c(r)?e(t,...l,...n(l)):y(r[o])?d(s[o](...l),(e=>a(...l,e))):a(...l,r[o])};a()}))]})((()=>Xe)),Te=(t,s)=>(!e||R(_,s)||ze(s))&&Y(t,((e,t)=>pe(s,t,e)),(()=>ze(s))),pe=(e,t,s,n)=>Y(n?s:ge(s,e,t),((n,r)=>L(be(e,t,r,n),(e=>(s[r]=e,!0)),(()=>!1))),(()=>ze(e,t))),be=(t,s,n,r)=>e?L(F(F(_,t),n),(e=>X(r)!=e.type?ze(t,s,n,r,e.default):r),(()=>ze(t,s,n,r))):y(X(r))?ze(t,s,n,r):r,ge=(e,t,s)=>(L(F($,t),(([n,r])=>{v(n,((t,s)=>{D(e,s)||(e[s]=t)})),v(r,(n=>{D(e,n)||ze(t,s,n)}))})),e),ye=e=>V(_,e,((e,t,s)=>{const n=m(),r=G();V(x(_,t,m),s,((e,t,s)=>{j(e,t,s),L(s.default,(e=>j(n,t,e)),(()=>H(r,t)))})),j($,t,[n,r])}),((e,t)=>{j(_,t),j($,t)})),Le=e=>V(ee,e,((e,t,s)=>we(t,s)),((e,t)=>me(t))),we=(e,t)=>V(x(ee,e,(()=>(Fe(e,1),m()))),t,((t,s,n)=>Re(e,t,s,n)),((t,s)=>Ee(e,t,s))),Re=(e,t,s,n,r)=>V(x(t,s,(()=>(Oe(e,s,1),m()))),n,((t,n,r)=>Ce(e,s,t,n,r)),((n,a)=>Je(e,t,s,n,a,r))),Ce=(e,t,s,n,r)=>{R(s,n)||je(e,t,n,1);const a=F(s,n);r!==a&&(xe(e,t,n,a,r),j(s,n,r))},Se=(e,t,s,n,r)=>L(F(t,s),(t=>Ce(e,s,t,n,r)),(()=>Re(e,t,s,ge({[n]:r},e,s)))),ve=e=>{const t=""+n++;return R(e,t)?ve(e):t},Ie=e=>F(ee,e)??we(e,{}),me=e=>we(e,{}),Ee=(e,t,s)=>Re(e,t,s,{},!0),Je=(e,t,s,n,r,a)=>{const l=F(F($,e)?.[0],r);if(!y(l)&&!a)return Ce(e,s,n,r,l);const o=t=>{xe(e,s,t,F(n,t)),je(e,s,t,-1),j(n,t)};y(l)?o(r):O(n,o),C(n)&&(Oe(e,s,-1),C(j(t,s))&&(Fe(e,-1),j(ee,e)))},Fe=(e,t)=>Z(f,e,t),Oe=(e,t,s)=>Z(x(b,e,m),t,s),je=(e,t,s,n)=>Z(x(x(g,e,m),t,m),s,n),xe=(e,t,s,n,r)=>x(x(x(N,e,m),t,m),s,(()=>[n,0]))[1]=r,ze=(e,t,s,n,r)=>(h(x(x(x(P,e,m),t,m),s,(()=>[])),n),r),Me=(e,t,s)=>L(F(F(F(N,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...i(qe(e,t,s))])),ke=e=>C(P)||C(ie[e])?0:v(e?M(P,k):P,((t,s)=>v(t,((t,n)=>v(t,((t,r)=>ue(ie[e],[s,n,r],t))))))),Ne=e=>{const t=C(le[e])&&C(re[e])&&C(se[e]),s=C(oe[e])&&C(ae[e])&&C(ne[e])&&C(te[e]);if(!t||!s){const n=e?[M(f),k(b),M(g,k),M(N,k)]:[f,b,g,N];if(t||(v(n[2],((t,s)=>v(t,((t,n)=>{C(t)||ue(le[e],[s,n])})))),v(n[1],((t,s)=>{C(t)||ue(re[e],[s])})),C(n[0])||ue(se[e])),!s){let t;v(n[3],((s,n)=>{let r;v(s,((s,a)=>{let l;v(s,(([s,o],i)=>{o!==s&&(ue(oe[e],[n,a,i],o,s,Me),t=r=l=1)})),l&&ue(ae[e],[n,a],Me)})),r&&ue(ne[e],[n],Me)})),t&&ue(te[e],[],Me)}}},Pe=(e,...t)=>(Qe((()=>{return e(...(s=t,n=U,s.map(n)));var s,n})),Xe),_e=()=>z(ee,(e=>z(e,z))),Be=()=>J(ee),De=e=>J(F(ee,U(e))),We=(e,t)=>J(F(F(ee,U(e)),U(t))),qe=(e,t,s)=>F(F(F(ee,U(e)),U(t)),U(s)),Ae=e=>Pe((()=>(e=>Y(e,Te,ze))(e)?Le(e):0)),Ge=(e,s,n,r)=>Pe(((e,s,n)=>L(be(e,s,n,t(r)==a?r(qe(e,s,n)):r),(t=>Se(e,Ie(e),s,n,t)))),e,s,n),He=()=>Pe((()=>Le({}))),Ke=(e,t,s,n)=>Pe(((e,t,s)=>L(F(ee,e),(r=>L(F(r,t),(a=>R(a,s)?Je(e,r,t,a,s,n):0))))),e,t,s),Qe=(e,t)=>{if(-1==u)return;Ue();const s=e?.();return Ve(t),s},Ue=()=>(u++,Xe),Ve=e=>(u>0&&(u--,0==u&&(s=!C(N),u=1,ke(1),s&&Ne(1),u=-1,e?.(z(N,(e=>z(e,(e=>z(e,(e=>[...e]),(([e,t])=>e===t))),A)),A),z(P,(e=>z(e,z))))&&(u=1,v(N,((e,t)=>v(e,((e,s)=>v(e,(([e],n)=>y(e)?Ke(t,s,n,!0):Ge(t,s,n,e))))))),u=-1,s=!1),ue(de[0],[],s),ke(0),s&&Ne(0),ue(de[1],[],s),u=0,d([N,P,f,b,g],S))),Xe),Xe={getTables:_e,getTableIds:Be,getTable:e=>z(F(ee,U(e)),z),getRowIds:De,getRow:(e,t)=>z(F(F(ee,U(e)),U(t))),getCellIds:We,getCell:qe,hasTables:()=>!C(ee),hasTable:e=>R(ee,U(e)),hasRow:(e,t)=>R(F(ee,U(e)),U(t)),hasCell:(e,t,s)=>R(F(F(ee,U(e)),U(t)),U(s)),getJson:()=>T(ee),getSchemaJson:()=>T(_),setTables:Ae,setTable:(e,t)=>Pe((e=>Te(t,e)?we(e,t):0),e),setRow:(e,t,s)=>Pe(((e,t)=>pe(U(e),U(t),s)?Re(U(e),Ie(U(e)),U(t),s):0),e,t),addRow:(e,t)=>Qe((()=>{let s;return pe(e,s,t)&&(e=U(e),Re(e,Ie(e),s=ve(F(ee,e)),t)),s})),setPartialRow:(e,t,s)=>Pe(((e,t)=>{if(pe(e,t,s,1)){const n=Ie(e);q(s,((s,r)=>Se(e,n,t,r,s)))}}),e,t),setCell:Ge,setJson:e=>{try{"{}"===e?He():Ae(p(e))}catch{}return Xe},setSchema:t=>Pe((()=>{if((e=(e=>Y(e,(e=>Y(e,(e=>{if(!Y(e,((e,t)=>[l,o].includes(t))))return!1;const t=e.type;return!(!w(t)&&t!=r||(X(e.default)!=t&&W(e,o),0))})))))(t))&&(ye(t),!C(ee))){const e=_e();He(),Ae(e)}})),delTables:He,delTable:e=>Pe((e=>R(ee,e)?me(e):0),e),delRow:(e,t)=>Pe(((e,t)=>L(F(ee,e),(s=>R(s,t)?Ee(e,s,t):0))),e,t),delCell:Ke,delSchema:()=>Pe((()=>{ye({}),e=!1})),transaction:Qe,startTransaction:Ue,finishTransaction:Ve,forEachTable:e=>v(ee,((t,s)=>e(s,(e=>v(t,((t,s)=>e(s,(e=>O(t,e))))))))),forEachRow:(e,t)=>v(F(ee,U(e)),((e,s)=>t(s,(t=>O(e,t))))),forEachCell:(e,t,s)=>O(F(F(ee,U(e)),U(t)),s),addTablesListener:(e,t)=>ce(e,te[t?1:0]),addTableIdsListener:(e,t)=>ce(e,se[t?1:0]),addTableListener:(e,t,s)=>ce(t,ne[s?1:0],[e]),addRowIdsListener:(e,t,s)=>ce(t,re[s?1:0],[e]),addRowListener:(e,t,s,n)=>ce(s,ae[n?1:0],[e,t]),addCellIdsListener:(e,t,s,n)=>ce(s,le[n?1:0],[e,t]),addCellListener:(e,t,s,n,r)=>ce(n,oe[r?1:0],[e,t,s]),addInvalidCellListener:(e,t,s,n,r)=>ce(n,ie[r?1:0],[e,t,s]),addWillFinishTransactionListener:e=>ce(e,de[0]),addDidFinishTransactionListener:e=>ce(e,de[1]),callListener:e=>(he(e,[Be,De,We],(e=>y(e[2])?[]:i(qe(...e)))),Xe),delListener:e=>(fe(e),Xe),getListenerStats:()=>({})};return B(Xe)},Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
