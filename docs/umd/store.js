var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s=t(""),n=t(!0),r=t(0),l=t(t),o="type",a="default",d=(e,t)=>e.forEach(t),c=e=>e.length,i=e=>0==c(e),u=e=>e.slice(1),f=e=>JSON.stringify(e,((e,t)=>{return p(t,Map)?(s=[...t],n=(e,[t,s])=>(e[t]=s,e),r={},s.reduce(n,r)):t;var s,n,r})),h=JSON.parse,b=isFinite,p=(e,t)=>e instanceof t,T=e=>null==e,g=(e,t,s)=>T(e)?s?.():t(e),y=e=>e==s||e==n,w=(e,t)=>e?.has(t)??!1,L=e=>T(e)||0==(e=>e.size)(e),R=e=>e.clear(),S=(e,t)=>e?.forEach(t),C=(e,t)=>e?.delete(t),v=e=>new Map(e),I=(e=v)=>[e(),e()],m=e=>[...e?.keys()??[]],E=(e,t)=>e?.get(t),J=(e,t)=>S(e,((e,s)=>t(s,e))),O=(e,t,s)=>T(s)?(C(e,t),e):e?.set(t,s),j=(e,t,s,n)=>(w(e,t)||(n?.(s),e.set(t,s)),E(e,t)),x=(e,t)=>{const s={},n=t??(e=>e);return S(e,((e,t)=>s[t]=n(e))),s},z=(e,t)=>{const s=v(),n=t??(e=>e);return S(e,((e,t)=>s.set(t,n(e)))),s},M=Object,k=M.keys,F=M.isFrozen,N=M.freeze,P=(e,t)=>!T(((e,t)=>g(e,(e=>e[t])))(e,t)),_=(e,t)=>delete e[t],B=(e,t)=>d(M.entries(e),(([e,s])=>t(s,e))),q=e=>new Set(e),A=(e,t,s)=>c(s)<2?((e,t)=>e?.add(t))(i(s)?e:j(e,s[0],q()),t):A(j(e,s[0],v()),t,u(s)),D=e=>{const t=(s,n,...r)=>g(s,(s=>i(r)?e(s,n):d([r[0],null],(e=>t(E(s,e),n,...u(r))))));return t},G=(e,t,s,n=O)=>{const r=(l=m(e),o=e=>!P(t,e),l.filter(o));var l,o;return d(k(t),(n=>s(e,n,t[n]))),d(r,(t=>n(e,t))),e},H=e=>{const s=t(e);return y(s)||s==r&&b(e)?s:void 0},K=(e,t)=>!(T(e)||!(e=>p(e,M)&&e.constructor==M)(e)||F(e)||(B(e,((s,n)=>{t(s,n)||_(e,n)})),(e=>i(k(e)))(e))),Q=(e,t,s)=>O(e,t,E(e,t)==-s?void 0:s);e.createStore=()=>{let e,s=0,n=0;const i=v(),u=v(),b=v(),p=v(),M=v(),k=v(),F=v(),U=I(q),V=I(q),W=I(),X=I(),Y=I(),Z=I(),$=I(),[ee,te,se,ne]=(e=>{let t,s=0;const n=[],r=v();return[(l,o,a=[])=>{t??=e();const d=n.pop()??""+s++;return O(r,d,[l,o,a]),A(o,d,a),d},(e,s=[],...n)=>D(S)(e,(e=>g(E(r,e),(([e])=>e(t,...s,...n)))),...s),e=>g(E(r,e),(([,t,s])=>(D(C)(t,e,...s),O(r,e),c(n)<1e3&&n.push(e),s)),(()=>[])),(e,s,n)=>g(E(r,e),(([e,,r])=>{const l=(...o)=>{const a=c(o);a==c(r)?e(t,...o,...n(o)):T(r[a])?d(s[a](...o),(e=>l(...o,e))):l(...o,r[a])};l()}))]})((()=>ke)),re=(t,s)=>(!e||w(M,s))&&K(t,(e=>le(s,e))),le=(e,t,s)=>K(s?t:ae(t,e),((s,n)=>g(oe(e,n,s),(e=>(t[n]=e,!0)),(()=>!1)))),oe=(t,s,n)=>e?g(E(E(M,t),s),(e=>H(n)!=e.type?e.default:n)):T(H(n))?void 0:n,ae=(e,t)=>(g(E(k,t),(t=>B(t,((t,s)=>{P(e,s)||(e[s]=t)})))),e),de=e=>G(M,e,((e,t,s)=>{const n={};G(j(M,t,v()),s,((e,t,s)=>{O(e,t,s),g(s.default,(e=>n[t]=e))})),O(k,t,n)}),((e,t)=>{O(M,t),O(k,t)})),ce=e=>G(F,e,((e,t,s)=>ie(t,s)),((e,t)=>ge(t))),ie=(e,t)=>G(j(F,e,v(),(()=>Le(e,1))),t,((t,s,n)=>ue(e,t,s,n)),((t,s)=>ye(e,t,s))),ue=(e,t,s,n,r)=>G(j(t,s,v(),(()=>Re(e,s,1))),n,((t,n,r)=>fe(e,s,t,n,r)),((n,l)=>we(e,t,s,n,l,r))),fe=(e,t,s,n,r)=>{w(s,n)||Se(e,t,n,1);const l=E(s,n);r!==l&&(Ce(e,t,n,l),O(s,n,r))},he=(e,t,s)=>Me((()=>ue(e,Te(e),t,s))),be=(e,t,s,n,r)=>g(E(t,s),(t=>fe(e,s,t,n,r)),(()=>ue(e,t,s,ae({[n]:r},e)))),pe=e=>{const t=""+s++;return w(e,t)?pe(e):t},Te=e=>E(F,e)??ie(e,{}),ge=e=>ie(e,{}),ye=(e,t,s)=>ue(e,t,s,{},!0),we=(e,t,s,n,r,l)=>{const o=E(k,e)?.[r];if(!T(o)&&!l)return fe(e,s,n,r,o);const a=t=>{Ce(e,s,t,E(n,t)),Se(e,s,t,-1),O(n,t)};T(o)?a(r):J(n,a),L(n)&&(Re(e,s,-1),L(O(t,s))&&(Le(e,-1),O(F,e)))},Le=(e,t)=>Q(i,e,t),Re=(e,t,s)=>Q(j(u,e,v()),t,s),Se=(e,t,s,n)=>Q(j(j(b,e,v()),t,v()),s,n),Ce=(e,t,s,n)=>j(j(j(p,e,v()),t,v()),s,n),ve=(e,t,s)=>{const n=E(E(p,e),t),r=je(e,t,s);return w(n,s)?[!0,E(n,s),r]:[!1,r,r]},Ie=e=>{const t=L(Z[e])&&L(X[e])&&L(V[e]),s=L($[e])&&L(Y[e])&&L(W[e])&&L(U[e]);if(t&&s)return;const n=e?[z(i),z(u,z),z(b,(e=>z(e,z))),z(p,(e=>z(e,z)))]:[i,u,b,p];if(t||(S(n[2],((t,s)=>S(t,((t,n)=>{L(t)||te(Z[e],[s,n])})))),S(n[1],((t,s)=>{L(t)||te(X[e],[s])})),L(n[0])||te(V[e])),!s){let t;S(n[3],((s,n)=>{let r;S(s,((s,l)=>{let o;S(s,((s,a)=>{const d=je(n,l,a);d!==s&&(te($[e],[n,l,a],d,s,ve),t=r=o=1)})),o&&te(Y[e],[n,l],ve)})),r&&te(W[e],[n],ve)})),t&&te(U[e],[],ve)}},me=()=>x(F,(e=>x(e,x))),Ee=()=>m(F),Je=e=>m(E(F,e)),Oe=(e,t)=>m(E(E(F,e),t)),je=(e,t,s)=>E(E(E(F,e),t),s),xe=e=>((e=>K(e,re))(e)&&Me((()=>ce(e))),ke),ze=()=>(Me((()=>ce({}))),ke),Me=e=>{if(-1==n)return;n++;const t=e();return n--,0==n&&(n=1,Ie(1),n=-1,Ie(0),n=0,d([p,i,u,b],R)),t},ke={getTables:me,getTableIds:Ee,getTable:e=>x(E(F,e),x),getRowIds:Je,getRow:(e,t)=>x(E(E(F,e),t)),getCellIds:Oe,getCell:je,hasTables:()=>!L(F),hasTable:e=>w(F,e),hasRow:(e,t)=>w(E(F,e),t),hasCell:(e,t,s)=>w(E(E(F,e),t),s),getJson:()=>f(F),getSchemaJson:()=>f(M),setTables:xe,setTable:(e,t)=>(re(t,e)&&Me((()=>ie(e,t))),ke),setRow:(e,t,s)=>(le(e,s)&&he(e,t,s),ke),addRow:(e,t)=>{let s;return le(e,t)&&(s=pe(E(F,e)),he(e,s,t)),s},setPartialRow:(e,t,s)=>(le(e,s,1)&&Me((()=>{const n=Te(e);B(s,((s,r)=>be(e,n,t,r,s)))})),ke),setCell:(e,s,n,r)=>(g(oe(e,n,t(r)==l?r(je(e,s,n)):r),(t=>Me((()=>be(e,Te(e),s,n,t))))),ke),setJson:e=>{try{"{}"===e?ze():xe(h(e))}catch{}return ke},setSchema:t=>{if((e=(e=>K(e,(e=>K(e,(e=>{if(!K(e,((e,t)=>[o,a].includes(t))))return!1;const t=e.type;return!(!y(t)&&t!=r||(H(e.default)!=t&&_(e,a),0))})))))(t))&&(de(t),!L(F))){const e=me();ze(),xe(e)}return ke},delTables:ze,delTable:e=>(w(F,e)&&Me((()=>ge(e))),ke),delRow:(e,t)=>(g(E(F,e),(s=>{w(s,t)&&Me((()=>ye(e,s,t)))})),ke),delCell:(e,t,s,n)=>(g(E(F,e),(r=>g(E(r,t),(l=>{w(l,s)&&Me((()=>we(e,r,t,l,s,n)))})))),ke),delSchema:()=>(de({}),e=!1,ke),transaction:Me,forEachTable:e=>S(F,((t,s)=>e(s,(e=>S(t,((t,s)=>e(s,(e=>J(t,e))))))))),forEachRow:(e,t)=>S(E(F,e),((e,s)=>t(s,(t=>J(e,t))))),forEachCell:(e,t,s)=>J(E(E(F,e),t),s),addTablesListener:(e,t)=>ee(e,U[t?1:0]),addTableIdsListener:(e,t)=>ee(e,V[t?1:0]),addTableListener:(e,t,s)=>ee(t,W[s?1:0],[e]),addRowIdsListener:(e,t,s)=>ee(t,X[s?1:0],[e]),addRowListener:(e,t,s,n)=>ee(s,Y[n?1:0],[e,t]),addCellIdsListener:(e,t,s,n)=>ee(s,Z[n?1:0],[e,t]),addCellListener:(e,t,s,n,r)=>ee(n,$[r?1:0],[e,t,s]),callListener:e=>(ne(e,[Ee,Je,Oe],(e=>T(e[2])?[]:[,,].fill(je(...e)))),ke),delListener:e=>(se(e),ke),getListenerStats:()=>({})};return N(ke)},Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
