var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s=t(""),n=t(!0),r=t(0),l=t(t),o="type",a="default",d=(e,t)=>e.forEach(t),c=e=>e.length,i=e=>0==c(e),u=e=>e.slice(1),f=(e,t)=>e.push(t),h=e=>JSON.stringify(e,((e,t)=>{return T(t,Map)?(s=[...t],n=(e,[t,s])=>(e[t]=s,e),r={},s.reduce(n,r)):t;var s,n,r})),b=JSON.parse,p=isFinite,T=(e,t)=>e instanceof t,g=e=>null==e,y=(e,t,s)=>g(e)?s?.():t(e),w=e=>e==s||e==n,L=(e,t)=>e?.has(t)??!1,R=e=>g(e)||0==(e=>e.size)(e),C=e=>e.clear(),S=(e,t)=>e?.forEach(t),v=(e,t)=>e?.delete(t),I=e=>new Map(e),m=(e=I)=>[e(),e()],E=e=>[...e?.keys()??[]],J=(e,t)=>e?.get(t),O=(e,t)=>S(e,((e,s)=>t(s,e))),j=(e,t,s)=>g(s)?(v(e,t),e):e?.set(t,s),x=(e,t,s,n)=>(L(e,t)||(n?.(s),e.set(t,s)),J(e,t)),z=(e,t)=>{const s={},n=t??(e=>e);return S(e,((e,t)=>s[t]=n(e))),s},M=(e,t)=>{const s=I(),n=t??(e=>e);return S(e,((e,t)=>s.set(t,n(e)))),s},k=Object,F=k.keys,N=k.isFrozen,P=k.freeze,_=(e,t)=>!g(((e,t)=>y(e,(e=>e[t])))(e,t)),B=(e,t)=>delete e[t],q=(e,t)=>d(k.entries(e),(([e,s])=>t(s,e))),A=e=>new Set(e),D=(e,t,s)=>c(s)<2?((e,t)=>e?.add(t))(i(s)?e:x(e,s[0],A()),t):D(x(e,s[0],I()),t,u(s)),G=e=>{const t=(s,n,...r)=>y(s,(s=>i(r)?e(s,n):d([r[0],null],(e=>t(J(s,e),n,...u(r))))));return t},H=(e,t,s,n=j)=>{const r=(l=E(e),o=e=>!_(t,e),l.filter(o));var l,o;return d(F(t),(n=>s(e,n,t[n]))),d(r,(t=>n(e,t))),e},K=e=>{const s=t(e);return w(s)||s==r&&p(e)?s:void 0},Q=(e,t)=>!(g(e)||!(e=>T(e,k)&&e.constructor==k)(e)||N(e)||(q(e,((s,n)=>{t(s,n)||B(e,n)})),(e=>i(F(e)))(e))),U=(e,t,s)=>j(e,t,J(e,t)==-s?void 0:s);e.createStore=()=>{let e,s=0,n=0;const i=I(),u=I(),p=I(),T=I(),k=I(),F=I(),N=I(),V=I(),W=m(A),X=m(A),Y=m(),Z=m(),$=m(),ee=m(),te=m(),se=m(),[ne,re,le,oe]=(e=>{let t,s=0;const n=[],r=I();return[(l,o,a=[])=>{t??=e();const d=n.pop()??""+s++;return j(r,d,[l,o,a]),D(o,d,a),d},(e,s=[],...n)=>G(S)(e,(e=>y(J(r,e),(([e])=>e(t,...s,...n)))),...s),e=>y(J(r,e),(([,t,s])=>(G(v)(t,e,...s),j(r,e),c(n)<1e3&&f(n,e),s)),(()=>[])),(e,s,n)=>y(J(r,e),(([e,,r])=>{const l=(...o)=>{const a=c(o);a==c(r)?e(t,...o,...n(o)):g(r[a])?d(s[a](...o),(e=>l(...o,e))):l(...o,r[a])};l()}))]})((()=>Be)),ae=(t,s)=>(!e||L(F,s))&&Q(t,((e,t)=>de(s,t,e))),de=(e,t,s,n)=>Q(n?s:ie(s,e),((n,r)=>y(ce(e,t,r,n),(e=>(s[r]=e,!0)),(()=>!1)))),ce=(t,s,n,r)=>e?y(J(J(F,t),n),(e=>K(r)!=e.type?Ee(t,s,n,r,e.default):r)):g(K(r))?Ee(t,s,n,r):r,ie=(e,t)=>(y(J(N,t),(t=>q(t,((t,s)=>{_(e,s)||(e[s]=t)})))),e),ue=e=>H(F,e,((e,t,s)=>{const n={};H(x(F,t,I()),s,((e,t,s)=>{j(e,t,s),y(s.default,(e=>n[t]=e))})),j(N,t,n)}),((e,t)=>{j(F,t),j(N,t)})),fe=e=>H(V,e,((e,t,s)=>he(t,s)),((e,t)=>Le(t))),he=(e,t)=>H(x(V,e,I(),(()=>Se(e,1))),t,((t,s,n)=>be(e,t,s,n)),((t,s)=>Re(e,t,s))),be=(e,t,s,n,r)=>H(x(t,s,I(),(()=>ve(e,s,1))),n,((t,n,r)=>pe(e,s,t,n,r)),((n,l)=>Ce(e,t,s,n,l,r))),pe=(e,t,s,n,r)=>{L(s,n)||Ie(e,t,n,1);const l=J(s,n);r!==l&&(me(e,t,n,l),j(s,n,r))},Te=(e,t,s)=>_e((()=>be(e,we(e),t,s))),ge=(e,t,s,n,r)=>y(J(t,s),(t=>pe(e,s,t,n,r)),(()=>be(e,t,s,ie({[n]:r},e)))),ye=e=>{const t=""+s++;return L(e,t)?ye(e):t},we=e=>J(V,e)??he(e,{}),Le=e=>he(e,{}),Re=(e,t,s)=>be(e,t,s,{},!0),Ce=(e,t,s,n,r,l)=>{const o=J(N,e)?.[r];if(!g(o)&&!l)return pe(e,s,n,r,o);const a=t=>{me(e,s,t,J(n,t)),Ie(e,s,t,-1),j(n,t)};g(o)?a(r):O(n,a),R(n)&&(ve(e,s,-1),R(j(t,s))&&(Se(e,-1),j(V,e)))},Se=(e,t)=>U(i,e,t),ve=(e,t,s)=>U(x(u,e,I()),t,s),Ie=(e,t,s,n)=>U(x(x(p,e,I()),t,I()),s,n),me=(e,t,s,n)=>x(x(x(T,e,I()),t,I()),s,n),Ee=(e,t,s,n,r)=>(f(x(x(x(k,e,I()),t,I()),s,[]),n),r),Je=(e,t,s)=>{const n=J(J(T,e),t),r=Fe(e,t,s);return L(n,s)?[!0,J(n,s),r]:[!1,r,r]},Oe=e=>{R(se[e])||S(e?M(k,(e=>M(e,M))):k,((t,s)=>S(t,((t,n)=>S(t,((t,r)=>re(se[e],[s,n,r],t)))))))},je=e=>{const t=R(ee[e])&&R(Z[e])&&R(X[e]),s=R(te[e])&&R($[e])&&R(Y[e])&&R(W[e]);if(t&&s)return;const n=e?[M(i),M(u,M),M(p,(e=>M(e,M))),M(T,(e=>M(e,M)))]:[i,u,p,T];if(t||(S(n[2],((t,s)=>S(t,((t,n)=>{R(t)||re(ee[e],[s,n])})))),S(n[1],((t,s)=>{R(t)||re(Z[e],[s])})),R(n[0])||re(X[e])),!s){let t;S(n[3],((s,n)=>{let r;S(s,((s,l)=>{let o;S(s,((s,a)=>{const d=Fe(n,l,a);d!==s&&(re(te[e],[n,l,a],d,s,Je),t=r=o=1)})),o&&re($[e],[n,l],Je)})),r&&re(Y[e],[n],Je)})),t&&re(W[e],[],Je)}},xe=()=>z(V,(e=>z(e,z))),ze=()=>E(V),Me=e=>E(J(V,e)),ke=(e,t)=>E(J(J(V,e),t)),Fe=(e,t,s)=>J(J(J(V,e),t),s),Ne=e=>((e=>Q(e,ae))(e)?_e((()=>fe(e))):_e(),Be),Pe=()=>(_e((()=>fe({}))),Be),_e=e=>{if(-1==n)return;n++;const t=e?.();return n--,0==n&&(n=1,Oe(1),je(1),n=-1,Oe(0),je(0),n=0,d([T,k,i,u,p],C)),t},Be={getTables:xe,getTableIds:ze,getTable:e=>z(J(V,e),z),getRowIds:Me,getRow:(e,t)=>z(J(J(V,e),t)),getCellIds:ke,getCell:Fe,hasTables:()=>!R(V),hasTable:e=>L(V,e),hasRow:(e,t)=>L(J(V,e),t),hasCell:(e,t,s)=>L(J(J(V,e),t),s),getJson:()=>h(V),getSchemaJson:()=>h(F),setTables:Ne,setTable:(e,t)=>(ae(t,e)?_e((()=>he(e,t))):_e(),Be),setRow:(e,t,s)=>(de(e,t,s)?Te(e,t,s):_e(),Be),addRow:(e,t)=>{let s;return de(e,s,t)?Te(e,s=ye(J(V,e)),t):_e(),s},setPartialRow:(e,t,s)=>(de(e,t,s,1)?_e((()=>{const n=we(e);q(s,((s,r)=>ge(e,n,t,r,s)))})):_e(),Be),setCell:(e,s,n,r)=>(y(ce(e,s,n,t(r)==l?r(Fe(e,s,n)):r),(t=>_e((()=>ge(e,we(e),s,n,t)))),_e),Be),setJson:e=>{try{"{}"===e?Pe():Ne(b(e))}catch{}return Be},setSchema:t=>{if((e=(e=>Q(e,(e=>Q(e,(e=>{if(!Q(e,((e,t)=>[o,a].includes(t))))return!1;const t=e.type;return!(!w(t)&&t!=r||(K(e.default)!=t&&B(e,a),0))})))))(t))&&(ue(t),!R(V))){const e=xe();Pe(),Ne(e)}return Be},delTables:Pe,delTable:e=>(L(V,e)&&_e((()=>Le(e))),Be),delRow:(e,t)=>(y(J(V,e),(s=>{L(s,t)&&_e((()=>Re(e,s,t)))})),Be),delCell:(e,t,s,n)=>(y(J(V,e),(r=>y(J(r,t),(l=>{L(l,s)&&_e((()=>Ce(e,r,t,l,s,n)))})))),Be),delSchema:()=>(ue({}),e=!1,Be),transaction:_e,forEachTable:e=>S(V,((t,s)=>e(s,(e=>S(t,((t,s)=>e(s,(e=>O(t,e))))))))),forEachRow:(e,t)=>S(J(V,e),((e,s)=>t(s,(t=>O(e,t))))),forEachCell:(e,t,s)=>O(J(J(V,e),t),s),addTablesListener:(e,t)=>ne(e,W[t?1:0]),addTableIdsListener:(e,t)=>ne(e,X[t?1:0]),addTableListener:(e,t,s)=>ne(t,Y[s?1:0],[e]),addRowIdsListener:(e,t,s)=>ne(t,Z[s?1:0],[e]),addRowListener:(e,t,s,n)=>ne(s,$[n?1:0],[e,t]),addCellIdsListener:(e,t,s,n)=>ne(s,ee[n?1:0],[e,t]),addCellListener:(e,t,s,n,r)=>ne(n,te[r?1:0],[e,t,s]),addInvalidCellListener:(e,t,s,n,r)=>ne(n,se[r?1:0],[e,t,s]),callListener:e=>(oe(e,[ze,Me,ke],(e=>g(e[2])?[]:[,,].fill(Fe(...e)))),Be),delListener:e=>(le(e),Be),getListenerStats:()=>({})};return P(Be)},Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
