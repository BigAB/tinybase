var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n=t(""),s=(e,t)=>e.every(((n,s)=>0==s||t(e[s-1],n)<=0)),o=(e,t)=>e.sort(t),d=(e,t)=>e.forEach(t),i=e=>e.length,r=e=>0==i(e),l=e=>e.slice(1),c=e=>null==e,a=(e,t,n)=>c(e)?n?.():t(e),f=(e,t)=>e?.has(t)??!1,u=e=>c(e)||0==(e=>e.size)(e),p=e=>e.clear(),g=(e,t)=>e?.forEach(t),I=(e,t)=>e?.delete(t),h=e=>new Map(e),y=e=>[...e?.keys()??[]],b=(e,t)=>e?.get(t),w=(e,t)=>g(e,((e,n)=>t(n,e))),x=(e,t,n)=>c(n)?(I(e,t),e):e?.set(t,n),v=(e,t,n,s)=>(f(e,t)||(s?.(n),e.set(t,n)),b(e,t)),L=e=>new Set(e),S=(e,t)=>e?.add(t),T=(e,s)=>t(e)==n?t=>t(e):e??(()=>s??""),R=(e,t)=>e<t?-1:1,j=(e,t,n)=>i(n)<2?S(r(n)?e:v(e,n[0],L()),t):j(v(e,n[0],h()),t,l(n)),M=e=>{const t=(n,s,...o)=>a(n,(n=>r(o)?e(n,s):d([o[0],null],(e=>t(b(n,e),s,...l(o))))));return t},k=Object.freeze,m=(e=>{const t=new WeakMap;return n=>(t.has(n)||t.set(n,e(n)),t.get(n))})((e=>{const t=h(),n=h(),[r,l,v,m,z,D,E,O]=((e,t,n)=>{const s=e.hasRow,o=h(),i=h(),r=h(),l=h(),u=h(),I=t=>a(b(u,t),(n=>{g(n,e.delListener),x(u,t)})),v=e=>{x(o,e),x(i,e),x(r,e),x(l,e),I(e)};return[()=>e,()=>y(o),e=>b(o,e),e=>b(i,e),(e,t)=>x(i,e,t),(a,y,v,S,T)=>{const R=h(),j=h();x(o,a,y),f(i,a)||(x(i,a,t()),x(r,a,h()),x(l,a,h()));const M=b(r,a),k=b(l,a),m=t=>{const o=n=>e.getCell(y,t,n),d=b(M,t),i=s(y,t)?n(S(o,t)):void 0;if(d!=i&&x(R,t,[d,i]),!c(T)){const e=b(k,t),n=s(y,t)?T(o,t):void 0;e!=n&&x(j,t,n)}},z=e=>{v((()=>{g(R,(([,e],t)=>x(M,t,e))),g(j,((e,t)=>x(k,t,e)))}),R,j,M,k,e),p(R),p(j)};w(M,m),e.hasTable(y)&&d(e.getRowIds(y),(e=>{f(M,e)||m(e)})),z(!0),I(a),x(u,a,L([e.addRowListener(y,null,((e,t,n)=>m(n))),e.addTableListener(y,(()=>z()))]))},v,()=>w(u,v)]})(e,h,(e=>c(e)?"":e+"")),[_,B,C]=(e=>{let t,n=0;const s=[],o=h();return[(d,i,r=[])=>{t??=e();const l=s.pop()??""+n++;return x(o,l,[d,i,r]),j(i,l,r),l},(e,n=[],...s)=>M(g)(e,(e=>a(b(o,e),(([e])=>e(t,...n,...s)))),...n),e=>a(b(o,e),(([,t,n])=>(M(I)(t,e,...n),x(o,e),i(s)<1e3&&s.push(e),n)),(()=>[])),(e,n,s)=>a(b(o,e),(([e,,o])=>{const r=(...l)=>{const a=i(l);a==i(o)?e(t,...l,...s(l)):c(o[a])?d(n[a](...l),(e=>r(...l,e))):r(...l,o[a])};r()}))]})((()=>P)),P={setIndexDefinition:(e,d,i,r,l,p=R)=>{const y=c(l)?void 0:([e],[t])=>l(e,t);return D(e,d,((d,i,l,v,T,R)=>{let j=0;const M=L(),k=L(),D=m(e);if(g(i,(([e,t],n)=>{c(e)||(S(M,e),a(b(D,e),(t=>{I(t,n),u(t)&&(x(D,e),j=1)}))),c(t)||(S(M,t),f(D,t)||(x(D,t,L()),j=1),S(b(D,t),n),c(r)||S(k,t))})),d(),u(T)||(R?w(D,(e=>S(k,e))):w(l,(e=>a(b(v,e),(e=>S(k,e))))),g(k,(e=>{const t=(t,n)=>p(b(T,t),b(T,n),e),n=[...b(D,e)];s(n,t)||(x(D,e,L(o(n,t))),S(M,e))}))),(j||R)&&!c(y)){const t=[...D];s(t,y)||(z(e,h(o(t,y))),j=1)}j&&B(t,[e]),g(M,(t=>B(n,[e,t])))}),T(i),a(r,T)),P},delIndexDefinition:e=>(E(e),P),getStore:r,getIndexIds:l,getTableId:v,getSliceIds:e=>y(m(e)),getSliceRowIds:(e,t)=>[...b(m(e),t)?.values()??[]],addSliceIdsListener:(e,n)=>_(n,t,[e]),addSliceRowIdsListener:(e,t,s)=>_(s,n,[e,t]),delListener:e=>(C(e),P),destroy:O,getListenerStats:()=>({})};return k(P)}));e.createIndexes=m,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseIndexes={});
