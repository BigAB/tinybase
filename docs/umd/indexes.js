var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n=t(""),s=(e,t)=>e.every(((n,s)=>0==s||t(e[s-1],n)<=0)),o=(e,t)=>e.sort(t),d=(e,t)=>e.forEach(t),i=e=>e.length,r=e=>0==i(e),l=e=>e.slice(1),c=e=>null==e,a=(e,t,n)=>c(e)?n?.():t(e),f=(e,t)=>e?.has(t)??!1,u=e=>c(e)||0==(e=>e.size)(e),p=e=>e.clear(),g=(e,t)=>e?.forEach(t),h=(e,t)=>e?.delete(t),I=e=>new Map(e),y=e=>[...e?.keys()??[]],x=(e,t)=>e?.get(t),b=(e,t)=>g(e,((e,n)=>t(n,e))),w=(e,t,n)=>c(n)?(h(e,t),e):e?.set(t,n),S=(e,t,n,s)=>(f(e,t)||(s?.(n),e.set(t,n)),x(e,t)),v=e=>new Set(e),L=(e,t)=>e?.add(t),T=(e,s)=>t(e)==n?t=>t(e):e??(()=>s??""),R=(e,t)=>e<t?-1:1,j=(e,t,n)=>i(n)<2?L(r(n)?e:S(e,n[0],v()),t):j(S(e,n[0],I()),t,l(n)),M=e=>{const t=(n,s,...o)=>a(n,(n=>r(o)?e(n,s):d([o[0],null],(e=>t(x(n,e),s,...l(o))))));return t},k=Object.freeze,m=(e=>{const t=new WeakMap;return n=>(t.has(n)||t.set(n,e(n)),t.get(n))})((e=>{const t=I(),n=I(),[r,l,S,m,z,D,E,O,_]=((e,t,n)=>{const s=e.hasRow,o=I(),i=I(),r=I(),l=I(),u=I(),h=t=>a(x(u,t),(n=>{g(n,e.delListener),w(u,t)})),S=e=>{w(o,e),w(i,e),w(r,e),w(l,e),h(e)};return[()=>e,()=>y(o),e=>f(i,e),e=>x(o,e),e=>x(i,e),(e,t)=>w(i,e,t),(a,y,S,L,T)=>{const R=I(),j=I();w(o,a,y),f(i,a)||(w(i,a,t()),w(r,a,I()),w(l,a,I()));const M=x(r,a),k=x(l,a),m=t=>{const o=n=>e.getCell(y,t,n),d=x(M,t),i=s(y,t)?n(L(o,t)):void 0;if(d!=i&&w(R,t,[d,i]),!c(T)){const e=x(k,t),n=s(y,t)?T(o,t):void 0;e!=n&&w(j,t,n)}},z=e=>{S((()=>{g(R,(([,e],t)=>w(M,t,e))),g(j,((e,t)=>w(k,t,e)))}),R,j,M,k,e),p(R),p(j)};b(M,m),e.hasTable(y)&&d(e.getRowIds(y),(e=>{f(M,e)||m(e)})),z(!0),h(a),w(u,a,v([e.addRowListener(y,null,((e,t,n)=>m(n))),e.addTableListener(y,(()=>z()))]))},S,()=>b(u,S)]})(e,I,(e=>c(e)?"":e+"")),[B,C,P]=(e=>{let t,n=0;const s=[],o=I();return[(d,i,r=[])=>{t??=e();const l=s.pop()??""+n++;return w(o,l,[d,i,r]),j(i,l,r),l},(e,n=[],...s)=>M(g)(e,(e=>a(x(o,e),(([e])=>e(t,...n,...s)))),...n),e=>a(x(o,e),(([,t,n])=>(M(h)(t,e,...n),w(o,e),i(s)<1e3&&s.push(e),n)),(()=>[])),(e,n,s)=>a(x(o,e),(([e,,o])=>{const r=(...l)=>{const a=i(l);a==i(o)?e(t,...l,...s(l)):c(o[a])?d(n[a](...l),(e=>r(...l,e))):r(...l,o[a])};r()}))]})((()=>W)),W={setIndexDefinition:(e,d,i,r,l,p=R)=>{const y=c(l)?void 0:([e],[t])=>l(e,t);return E(e,d,((d,i,l,S,T,R)=>{let j=0;const M=v(),k=v(),m=z(e);if(g(i,(([e,t],n)=>{c(e)||(L(M,e),a(x(m,e),(t=>{h(t,n),u(t)&&(w(m,e),j=1)}))),c(t)||(L(M,t),f(m,t)||(w(m,t,v()),j=1),L(x(m,t),n),c(r)||L(k,t))})),d(),u(T)||(R?b(m,(e=>L(k,e))):b(l,(e=>a(x(S,e),(e=>L(k,e))))),g(k,(e=>{const t=(t,n)=>p(x(T,t),x(T,n),e),n=[...x(m,e)];s(n,t)||(w(m,e,v(o(n,t))),L(M,e))}))),(j||R)&&!c(y)){const t=[...m];s(t,y)||(D(e,I(o(t,y))),j=1)}j&&C(t,[e]),g(M,(t=>C(n,[e,t])))}),T(i),a(r,T)),W},delIndexDefinition:e=>(O(e),W),getStore:r,getIndexIds:l,hasIndex:S,hasSlice:(e,t)=>f(z(e),t),getTableId:m,getSliceIds:e=>y(z(e)),getSliceRowIds:(e,t)=>[...x(z(e),t)?.values()??[]],addSliceIdsListener:(e,n)=>B(n,t,[e]),addSliceRowIdsListener:(e,t,s)=>B(s,n,[e,t]),delListener:e=>(P(e),W),destroy:_,getListenerStats:()=>({})};return k(W)}));e.createIndexes=m,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseIndexes={});
