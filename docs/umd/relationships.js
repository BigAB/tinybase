var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s=t(""),n=(e,t)=>e.forEach(t),o=e=>e.length,i=e=>0==o(e),d=e=>e.slice(1),a=e=>null==e,l=(e,t,s)=>a(e)?s?.():t(e),r=(e,t)=>e?.has(t)??!1,c=e=>[...e?.values()??[]],f=e=>e.clear(),u=(e,t)=>e?.forEach(t),p=(e,t)=>e?.delete(t),h=e=>new Map(e),R=(e,t)=>e?.get(t),g=(e,t)=>u(e,((e,s)=>t(s,e))),L=(e,t,s)=>a(s)?(p(e,t),e):e?.set(t,s),w=(e,t,s,n)=>(r(e,t)||(n?.(s),e.set(t,s)),R(e,t)),I=e=>new Set(e),b=(e,t)=>e?.add(t),y=(e,n)=>t(e)==s?t=>t(e):e??(()=>n??""),v=(e,t,s)=>o(s)<2?b(i(s)?e:w(e,s[0],I()),t):v(w(e,s[0],h()),t,d(s)),T=e=>{const t=(s,o,...a)=>l(s,(s=>i(a)?e(s,o):n([a[0],null],(e=>t(R(s,e),o,...d(a))))));return t},m=Object.freeze,k=(e=>{const t=new WeakMap;return s=>(t.has(s)||t.set(s,e(s)),t.get(s))})((e=>{const t=h(),s=h(),i=h(),d=h(),[w,k,j,x,M,S,z,D,E]=((e,t,s)=>{const o=e.hasRow,i=h(),d=h(),c=h(),p=h(),w=h(),b=t=>l(R(w,t),(s=>{u(s,e.delListener),L(w,t)})),y=e=>{L(i,e),L(d,e),L(c,e),L(p,e),b(e)};return[()=>e,()=>[...i?.keys()??[]],e=>r(d,e),e=>R(i,e),e=>R(d,e),(e,t)=>L(d,e,t),(l,y,v,T,m)=>{const k=h(),j=h();L(i,l,y),r(d,l)||(L(d,l,t()),L(c,l,h()),L(p,l,h()));const x=R(c,l),M=R(p,l),S=t=>{const n=s=>e.getCell(y,t,s),i=R(x,t),d=o(y,t)?s(T(n,t)):void 0;if(i!=d&&L(k,t,[i,d]),!a(m)){const e=R(M,t),s=o(y,t)?m(n,t):void 0;e!=s&&L(j,t,s)}},z=e=>{v((()=>{u(k,(([,e],t)=>L(x,t,e))),u(j,((e,t)=>L(M,t,e)))}),k,j,x,M,e),f(k),f(j)};g(x,S),e.hasTable(y)&&n(e.getRowIds(y),(e=>{r(x,e)||S(e)})),z(!0),b(l),L(w,l,I([e.addRowListener(y,null,((e,t,s)=>S(s))),e.addTableListener(y,(()=>z()))]))},y,()=>g(w,y)]})(e,(()=>[h(),h(),h(),h()]),(e=>a(e)?void 0:e+"")),[O,_,B]=(e=>{let t,s=0;const i=[],d=h();return[(n,o,a=[])=>{t??=e();const l=i.pop()??""+s++;return L(d,l,[n,o,a]),v(o,l,a),l},(e,s=[],...n)=>T(u)(e,(e=>l(R(d,e),(([e])=>e(t,...s,...n)))),...s),e=>l(R(d,e),(([,t,s])=>(T(p)(t,e,...s),L(d,e),o(i)<1e3&&i.push(e),s)),(()=>[])),(e,s,i)=>l(R(d,e),(([e,,d])=>{const l=(...r)=>{const c=o(r);c==o(d)?e(t,...r,...i(r)):a(d[c])?n(s[c](...r),(e=>l(...r,e))):l(...r,d[c])};l()}))]})((()=>q)),C=(e,t,s)=>l(M(e),(([n,,o])=>{if(!r(o,t)){const i=I();if(x(e)!=W(e))b(i,t);else{let e=t;for(;!a(e)&&!r(i,e);)b(i,e),e=R(n,e)}if(s)return i;L(o,t,i)}return R(o,t)})),P=(e,t)=>l(M(e),(([,,e])=>L(e,t))),W=e=>R(t,e),q={setRelationshipDefinition:(e,n,o,c)=>(L(t,e,o),z(e,n,((t,n)=>{const o=I(),c=I(),f=I(),[h,w]=M(e);u(n,(([t,s],n)=>{a(t)||(b(c,t),l(R(w,t),(e=>{var s;p(e,n),(a(s=e)||0==(e=>e.size)(s))&&L(w,t)}))),a(s)||(b(c,s),r(w,s)||L(w,s,I()),b(R(w,s),n)),b(o,n),L(h,n,s),g(R(d,e),(t=>{r(C(e,t),n)&&b(f,t)}))})),t(),u(o,(t=>_(s,[e,t]))),u(c,(t=>_(i,[e,t]))),u(f,(t=>{P(e,t),_(d,[e,t])}))}),y(c)),q),delRelationshipDefinition:e=>(L(t,e),D(e),q),getStore:w,getRelationshipIds:k,hasRelationship:j,getLocalTableId:x,getRemoteTableId:W,getRemoteRowId:(e,t)=>R(M(e)?.[0],t),getLocalRowIds:(e,t)=>c(R(M(e)?.[1],t)),getLinkedRowIds:(e,t)=>a(M(e))?[t]:c(C(e,t,!0)),addRemoteRowIdListener:(e,t,n)=>O(n,s,[e,t]),addLocalRowIdsListener:(e,t,s)=>O(s,i,[e,t]),addLinkedRowIdsListener:(e,t,s)=>(C(e,t),O(s,d,[e,t])),delListener:e=>(P(...B(e)),q),destroy:E,getListenerStats:()=>({})};return m(q)}));e.createRelationships=k,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseRelationships={});
