var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s=t(""),n=(e,t)=>e.forEach(t),o=e=>e.length,i=e=>0==o(e),d=e=>e.slice(1),r=e=>null==e,l=(e,t,s)=>r(e)?s?.():t(e),a=(e,t)=>e?.has(t)??!1,c=e=>[...e?.values()??[]],f=e=>e.clear(),u=(e,t)=>e?.forEach(t),p=(e,t)=>e?.delete(t),R=e=>new Map(e),h=(e,t)=>e?.get(t),g=(e,t)=>u(e,((e,s)=>t(s,e))),L=(e,t,s)=>r(s)?(p(e,t),e):e?.set(t,s),w=(e,t,s,n)=>(a(e,t)||(n?.(s),e.set(t,s)),h(e,t)),I=e=>new Set(e),b=(e,t)=>e?.add(t),y=(e,n)=>t(e)==s?t=>t(e):e??(()=>n??""),v=(e,t,s)=>o(s)<2?b(i(s)?e:w(e,s[0],I()),t):v(w(e,s[0],R()),t,d(s)),T=e=>{const t=(s,o,...r)=>l(s,(s=>i(r)?e(s,o):n([r[0],null],(e=>t(h(s,e),o,...d(r))))));return t},m=Object.freeze,k=(e=>{const t=new WeakMap;return s=>(t.has(s)||t.set(s,e(s)),t.get(s))})((e=>{const t=R(),s=R(),i=R(),d=R(),[w,k,j,x,M,S,z,D]=((e,t,s)=>{const o=e.hasRow,i=R(),d=R(),c=R(),p=R(),w=R(),b=t=>l(h(w,t),(s=>{u(s,e.delListener),L(w,t)})),y=e=>{L(i,e),L(d,e),L(c,e),L(p,e),b(e)};return[()=>e,()=>[...i?.keys()??[]],e=>h(i,e),e=>h(d,e),(e,t)=>L(d,e,t),(l,y,v,T,m)=>{const k=R(),j=R();L(i,l,y),a(d,l)||(L(d,l,t()),L(c,l,R()),L(p,l,R()));const x=h(c,l),M=h(p,l),S=t=>{const n=s=>e.getCell(y,t,s),i=h(x,t),d=o(y,t)?s(T(n,t)):void 0;if(i!=d&&L(k,t,[i,d]),!r(m)){const e=h(M,t),s=o(y,t)?m(n,t):void 0;e!=s&&L(j,t,s)}},z=e=>{v((()=>{u(k,(([,e],t)=>L(x,t,e))),u(j,((e,t)=>L(M,t,e)))}),k,j,x,M,e),f(k),f(j)};g(x,S),e.hasTable(y)&&n(e.getRowIds(y),(e=>{a(x,e)||S(e)})),z(!0),b(l),L(w,l,I([e.addRowListener(y,null,((e,t,s)=>S(s))),e.addTableListener(y,(()=>z()))]))},y,()=>g(w,y)]})(e,(()=>[R(),R(),R(),R()]),(e=>r(e)?void 0:e+"")),[E,O,_]=(e=>{let t,s=0;const i=[],d=R();return[(n,o,r=[])=>{t??=e();const l=i.pop()??""+s++;return L(d,l,[n,o,r]),v(o,l,r),l},(e,s=[],...n)=>T(u)(e,(e=>l(h(d,e),(([e])=>e(t,...s,...n)))),...s),e=>l(h(d,e),(([,t,s])=>(T(p)(t,e,...s),L(d,e),o(i)<1e3&&i.push(e),s)),(()=>[])),(e,s,i)=>l(h(d,e),(([e,,d])=>{const l=(...a)=>{const c=o(a);c==o(d)?e(t,...a,...i(a)):r(d[c])?n(s[c](...a),(e=>l(...a,e))):l(...a,d[c])};l()}))]})((()=>W)),B=(e,t,s)=>l(x(e),(([n,,o])=>{if(!a(o,t)){const i=I();if(j(e)!=P(e))b(i,t);else{let e=t;for(;!r(e)&&!a(i,e);)b(i,e),e=h(n,e)}if(s)return i;L(o,t,i)}return h(o,t)})),C=(e,t)=>l(x(e),(([,,e])=>L(e,t))),P=e=>h(t,e),W={setRelationshipDefinition:(e,n,o,c)=>(L(t,e,o),S(e,n,((t,n)=>{const o=I(),c=I(),f=I(),[R,w]=x(e);u(n,(([t,s],n)=>{r(t)||(b(c,t),l(h(w,t),(e=>{var s;p(e,n),(r(s=e)||0==(e=>e.size)(s))&&L(w,t)}))),r(s)||(b(c,s),a(w,s)||L(w,s,I()),b(h(w,s),n)),b(o,n),L(R,n,s),g(h(d,e),(t=>{a(B(e,t),n)&&b(f,t)}))})),t(),u(o,(t=>O(s,[e,t]))),u(c,(t=>O(i,[e,t]))),u(f,(t=>{C(e,t),O(d,[e,t])}))}),y(c)),W),delRelationshipDefinition:e=>(L(t,e),z(e),W),getStore:w,getRelationshipIds:k,getLocalTableId:j,getRemoteTableId:P,getRemoteRowId:(e,t)=>h(x(e)?.[0],t),getLocalRowIds:(e,t)=>c(h(x(e)?.[1],t)),getLinkedRowIds:(e,t)=>r(x(e))?[t]:c(B(e,t,!0)),addRemoteRowIdListener:(e,t,n)=>E(n,s,[e,t]),addLocalRowIdsListener:(e,t,s)=>E(s,i,[e,t]),addLinkedRowIdsListener:(e,t,s)=>(B(e,t),E(s,d,[e,t])),delListener:e=>(C(..._(e)),W),destroy:D,getListenerStats:()=>({})};return m(W)}));e.createRelationships=k,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseRelationships={});
