var e,t;e=this,t=function(e){"use strict";const t=(e,t)=>e.includes(t),n=(e,t)=>e.forEach(t),o=e=>e.length,s=e=>0==o(e),i=e=>e.slice(1),r=e=>null==e,l=(e,t,n)=>r(e)?n?.():t(e),c=(e,t)=>e?.has(t)??!1,d=e=>r(e)||0==(e=>e.size)(e),p=(e,t)=>e?.forEach(t),a=(e,t)=>e?.delete(t),u=e=>new Map(e),h=(e,t)=>e?.get(t),f=(e,t,n)=>r(n)?(a(e,t),e):e?.set(t,n),g=(e,t,n,o)=>(c(e,t)||(o?.(n),e.set(t,n)),h(e,t)),C=e=>new Set(e),k=(e,t,n)=>o(n)<2?((e,t)=>e?.add(t))(s(n)?e:g(e,n[0],C()),t):k(g(e,n[0],u()),t,i(n)),y=e=>{const t=(o,r,...c)=>l(o,(o=>s(c)?e(o,r):n([c[0],null],(e=>t(h(o,e),r,...i(c))))));return t},v=Object.freeze,L=(e=>{const t=new WeakMap;return n=>(t.has(n)||t.set(n,e(n)),t.get(n))})((e=>{let i,L,b,w=100,S=u(),T=1;const j=C(),x=u(),[z,M,m]=(e=>{let t,s=0;const i=[],c=u();return[(n,o,r=[])=>{t??=e();const l=i.pop()??""+s++;return f(c,l,[n,o,r]),k(o,l,r),l},(e,n=[],...o)=>y(p)(e,(e=>l(h(c,e),(([e])=>e(t,...n,...o)))),...n),e=>l(h(c,e),(([,t,n])=>(y(a)(t,e,...n),f(c,e),o(i)<1e3&&i.push(e),n)),(()=>[])),(e,s,i)=>l(h(c,e),(([e,,l])=>{const c=(...d)=>{const p=o(d);p==o(l)?e(t,...d,...i(d)):r(l[p])?n(s[p](...d),(e=>c(...d,e))):c(...d,l[p])};c()}))]})((()=>N)),B=u(),E=u(),I=[],O=[],_=(t,n)=>{T=0,e.transaction((()=>p(h(B,n),((n,o)=>p(n,((n,s)=>p(n,((n,i)=>r(n[t])?e.delCell(o,s,i,!0):e.setCell(o,s,i,n[t]))))))))),T=1},F=e=>{f(B,e),f(E,e),M(x,[e])},P=(e,t)=>n(((e,t)=>e.splice(0,t))(e,t??o(e)),F),W=()=>P(I,o(I)-w),q=e.addCellListener(null,null,null,((e,t,n,o,s,r)=>{if(T){l(i,(()=>{I.push(i),W(),P(O),i=void 0,b=1}));const e=g(S,t,u()),c=g(e,n,u()),p=g(c,o,[void 0,void 0],(e=>e[0]=r));p[1]=s,p[0]===p[1]&&d(f(c,o))&&d(f(e,n))&&d(f(S,t))&&(i=I.pop(),b=1),H()}})),A=(e="")=>(r(i)&&(i=""+L++,f(B,i,S),K(i,e),S=u(),b=1),i),D=()=>{s(I)||(O.unshift(A()),_(0,i),i=I.pop(),b=1)},G=()=>{s(O)||(I.push(i),i=O.shift(),_(1,i),b=1)},H=()=>{b&&(M(j),b=0)},J=e=>{const t=A(e);return H(),t},K=(e,t)=>(c(B,e)&&h(E,e)!==t&&(f(E,e,t),M(x,[e])),N),N={setSize:e=>(w=e,W(),N),addCheckpoint:J,setCheckpoint:K,getStore:()=>e,getCheckpointIds:()=>[[...I],i,[...O]],getCheckpoint:e=>h(E,e),goBackward:()=>(D(),H(),N),goForward:()=>(G(),H(),N),goTo:e=>{const n=t(I,e)?D:t(O,e)?G:null;for(;!r(n)&&e!=i;)n();return H(),N},addCheckpointIdsListener:e=>z(e,j),addCheckpointListener:(e,t)=>z(t,x,[e]),delListener:e=>(m(e),N),clear:()=>(P(I),P(O),r(i)||F(i),i=void 0,L=0,J(),N),destroy:()=>{e.delListener(q)},getListenerStats:()=>({})};return v(N.clear())}));e.createCheckpoints=L,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseCheckpoints={});
