var e,t;e=this,t=function(e){"use strict";const t=(e,t)=>e.includes(t),n=(e,t)=>e.forEach(t),o=e=>e.length,s=e=>0==o(e),r=e=>e.slice(1),i=e=>null==e,c=(e,t,n)=>i(e)?n?.():t(e),l=(e,t)=>e?.has(t)??!1,d=e=>i(e)||0==(e=>e.size)(e),a=(e,t)=>e?.forEach(t),p=(e,t)=>e?.delete(t),u=e=>new Map(e),h=(e,t)=>e?.get(t),f=(e,t,n)=>i(n)?(p(e,t),e):e?.set(t,n),C=(e,t,n,o)=>(l(e,t)||(o?.(n),e.set(t,n)),h(e,t)),g=e=>new Set(e),k=(e,t,n)=>o(n)<2?((e,t)=>e?.add(t))(s(n)?e:C(e,n[0],g()),t):k(C(e,n[0],u()),t,r(n)),v=e=>{const t=(o,i,...l)=>c(o,(o=>s(l)?e(o,i):n([l[0],null],(e=>t(h(o,e),i,...r(l))))));return t},y=Object.freeze,L=(e=>{const t=new WeakMap;return n=>(t.has(n)||t.set(n,e(n)),t.get(n))})((e=>{let r,L,b,w=100,S=u(),T=1;const j=g(),x=u(),[z,E,M]=(e=>{let t,s=0;const r=[],l=u();return[(n,o,i=[])=>{t??=e();const c=r.pop()??""+s++;return f(l,c,[n,o,i]),k(o,c,i),c},(e,n=[],...o)=>v(a)(e,(e=>c(h(l,e),(([e])=>e(t,...n,...o)))),...n),e=>c(h(l,e),(([,t,n])=>(v(p)(t,e,...n),f(l,e),o(r)<1e3&&r.push(e),n)),(()=>[])),(e,s,r)=>c(h(l,e),(([e,,c])=>{const l=(...d)=>{const a=o(d);a==o(c)?e(t,...d,...r(d)):i(c[a])?n(s[a](...d),(e=>l(...d,e))):l(...d,c[a])};l()}))]})((()=>Q)),m=u(),B=u(),I=[],O=[],_=(t,n)=>{T=0,e.transaction((()=>a(h(m,n),((n,o)=>a(n,((n,s)=>a(n,((n,r)=>i(n[t])?e.delCell(o,s,r,!0):e.setCell(o,s,r,n[t]))))))))),T=1},F=e=>{f(m,e),f(B,e),E(x,[e])},P=(e,t)=>n(((e,t)=>e.splice(0,t))(e,t??o(e)),F),W=()=>P(I,o(I)-w),q=e.addCellListener(null,null,null,((e,t,n,o,s,i)=>{if(T){c(r,(()=>{I.push(r),W(),P(O),r=void 0,b=1}));const e=C(S,t,u()),l=C(e,n,u()),a=C(l,o,[void 0,void 0],(e=>e[0]=i));a[1]=s,a[0]===a[1]&&d(f(l,o))&&d(f(e,n))&&d(f(S,t))&&(r=I.pop(),b=1),H()}})),A=(e="")=>(i(r)&&(r=""+L++,f(m,r,S),K(r,e),S=u(),b=1),r),D=()=>{s(I)||(O.unshift(A()),_(0,r),r=I.pop(),b=1)},G=()=>{s(O)||(I.push(r),r=O.shift(),_(1,r),b=1)},H=()=>{b&&(E(j),b=0)},J=e=>{const t=A(e);return H(),t},K=(e,t)=>(N(e)&&h(B,e)!==t&&(f(B,e,t),E(x,[e])),Q),N=e=>l(m,e),Q={setSize:e=>(w=e,W(),Q),addCheckpoint:J,setCheckpoint:K,getStore:()=>e,getCheckpointIds:()=>[[...I],r,[...O]],forEachCheckpoint:e=>{return t=e,a(B,((e,n)=>t(n,e)));var t},hasCheckpoint:N,getCheckpoint:e=>h(B,e),goBackward:()=>(D(),H(),Q),goForward:()=>(G(),H(),Q),goTo:e=>{const n=t(I,e)?D:t(O,e)?G:null;for(;!i(n)&&e!=r;)n();return H(),Q},addCheckpointIdsListener:e=>z(e,j),addCheckpointListener:(e,t)=>z(t,x,[e]),delListener:e=>(M(e),Q),clear:()=>(P(I),P(O),i(r)||F(r),r=void 0,L=0,J(),Q),destroy:()=>{e.delListener(q)},getListenerStats:()=>({})};return y(Q.clear())}));e.createCheckpoints=L,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseCheckpoints={});
